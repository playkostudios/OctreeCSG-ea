"use strict";(()=>{var In=Object.defineProperty;var oe=(e,r)=>{for(var n in r)In(e,n,{get:r[n],enumerable:!0})};var be=(e,r,n)=>new Promise((t,s)=>{var a=o=>{try{c(n.next(o))}catch(l){s(l)}},i=o=>{try{c(n.throw(o))}catch(l){s(l)}},c=o=>o.done?t(o.value):Promise.resolve(o.value).then(a,i);c((n=n.apply(e,r)).next())});var Sr=.3333333333333333,Si=Math.PI*2,wi=Math.PI/2;var S=1e-6,E=typeof Float32Array<"u"?Float32Array:Array,Y=Math.random;var Ri=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});var V={};oe(V,{add:()=>Kn,adjoint:()=>Fn,clone:()=>Nn,copy:()=>Tn,create:()=>De,determinant:()=>Yn,equals:()=>nt,exactEquals:()=>rt,frob:()=>Xn,fromMat2d:()=>Hn,fromMat4:()=>En,fromQuat:()=>Jn,fromRotation:()=>jn,fromScaling:()=>Wn,fromTranslation:()=>Un,fromValues:()=>zn,identity:()=>kn,invert:()=>Ln,mul:()=>tt,multiply:()=>wr,multiplyScalar:()=>Qn,multiplyScalarAndAdd:()=>et,normalFromMat4:()=>$n,projection:()=>Zn,rotate:()=>Dn,scale:()=>Bn,set:()=>Gn,str:()=>qn,sub:()=>st,subtract:()=>Ar,translate:()=>Vn,transpose:()=>_n});function De(){var e=new E(9);return E!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function En(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[4],e[4]=r[5],e[5]=r[6],e[6]=r[8],e[7]=r[9],e[8]=r[10],e}function Nn(e){var r=new E(9);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function Tn(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function zn(e,r,n,t,s,a,i,c,o){var l=new E(9);return l[0]=e,l[1]=r,l[2]=n,l[3]=t,l[4]=s,l[5]=a,l[6]=i,l[7]=c,l[8]=o,l}function Gn(e,r,n,t,s,a,i,c,o,l){return e[0]=r,e[1]=n,e[2]=t,e[3]=s,e[4]=a,e[5]=i,e[6]=c,e[7]=o,e[8]=l,e}function kn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function _n(e,r){if(e===r){var n=r[1],t=r[2],s=r[5];e[1]=r[3],e[2]=r[6],e[3]=n,e[5]=r[7],e[6]=t,e[7]=s}else e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8];return e}function Ln(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],p=h*i-c*l,v=-h*a+c*o,x=l*a-i*o,d=n*p+t*v+s*x;return d?(d=1/d,e[0]=p*d,e[1]=(-h*t+s*l)*d,e[2]=(c*t-s*i)*d,e[3]=v*d,e[4]=(h*n-s*o)*d,e[5]=(-c*n+s*a)*d,e[6]=x*d,e[7]=(-l*n+t*o)*d,e[8]=(i*n-t*a)*d,e):null}function Fn(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8];return e[0]=i*h-c*l,e[1]=s*l-t*h,e[2]=t*c-s*i,e[3]=c*o-a*h,e[4]=n*h-s*o,e[5]=s*a-n*c,e[6]=a*l-i*o,e[7]=t*o-n*l,e[8]=n*i-t*a,e}function Yn(e){var r=e[0],n=e[1],t=e[2],s=e[3],a=e[4],i=e[5],c=e[6],o=e[7],l=e[8];return r*(l*a-i*o)+n*(-l*s+i*c)+t*(o*s-a*c)}function wr(e,r,n){var t=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],p=r[8],v=n[0],x=n[1],d=n[2],m=n[3],y=n[4],g=n[5],w=n[6],b=n[7],P=n[8];return e[0]=v*t+x*i+d*l,e[1]=v*s+x*c+d*h,e[2]=v*a+x*o+d*p,e[3]=m*t+y*i+g*l,e[4]=m*s+y*c+g*h,e[5]=m*a+y*o+g*p,e[6]=w*t+b*i+P*l,e[7]=w*s+b*c+P*h,e[8]=w*a+b*o+P*p,e}function Vn(e,r,n){var t=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],p=r[8],v=n[0],x=n[1];return e[0]=t,e[1]=s,e[2]=a,e[3]=i,e[4]=c,e[5]=o,e[6]=v*t+x*i+l,e[7]=v*s+x*c+h,e[8]=v*a+x*o+p,e}function Dn(e,r,n){var t=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],p=r[8],v=Math.sin(n),x=Math.cos(n);return e[0]=x*t+v*i,e[1]=x*s+v*c,e[2]=x*a+v*o,e[3]=x*i-v*t,e[4]=x*c-v*s,e[5]=x*o-v*a,e[6]=l,e[7]=h,e[8]=p,e}function Bn(e,r,n){var t=n[0],s=n[1];return e[0]=t*r[0],e[1]=t*r[1],e[2]=t*r[2],e[3]=s*r[3],e[4]=s*r[4],e[5]=s*r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function Un(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=r[0],e[7]=r[1],e[8]=1,e}function jn(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=t,e[1]=n,e[2]=0,e[3]=-n,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Wn(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=r[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Hn(e,r){return e[0]=r[0],e[1]=r[1],e[2]=0,e[3]=r[2],e[4]=r[3],e[5]=0,e[6]=r[4],e[7]=r[5],e[8]=1,e}function Jn(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=n+n,c=t+t,o=s+s,l=n*i,h=t*i,p=t*c,v=s*i,x=s*c,d=s*o,m=a*i,y=a*c,g=a*o;return e[0]=1-p-d,e[3]=h-g,e[6]=v+y,e[1]=h+g,e[4]=1-l-d,e[7]=x-m,e[2]=v-y,e[5]=x+m,e[8]=1-l-p,e}function $n(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],p=r[9],v=r[10],x=r[11],d=r[12],m=r[13],y=r[14],g=r[15],w=n*c-t*i,b=n*o-s*i,P=n*l-a*i,O=t*o-s*c,u=t*l-a*c,k=s*l-a*o,T=h*m-p*d,z=h*y-v*d,N=h*g-x*d,_=p*y-v*m,G=p*g-x*m,L=v*g-x*y,A=w*L-b*G+P*_+O*N-u*z+k*T;return A?(A=1/A,e[0]=(c*L-o*G+l*_)*A,e[1]=(o*N-i*L-l*z)*A,e[2]=(i*G-c*N+l*T)*A,e[3]=(s*G-t*L-a*_)*A,e[4]=(n*L-s*N+a*z)*A,e[5]=(t*N-n*G-a*T)*A,e[6]=(m*k-y*u+g*O)*A,e[7]=(y*P-d*k-g*b)*A,e[8]=(d*u-m*P+g*w)*A,e):null}function Zn(e,r,n){return e[0]=2/r,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function qn(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Xn(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Kn(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e[3]=r[3]+n[3],e[4]=r[4]+n[4],e[5]=r[5]+n[5],e[6]=r[6]+n[6],e[7]=r[7]+n[7],e[8]=r[8]+n[8],e}function Ar(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e[3]=r[3]-n[3],e[4]=r[4]-n[4],e[5]=r[5]-n[5],e[6]=r[6]-n[6],e[7]=r[7]-n[7],e[8]=r[8]-n[8],e}function Qn(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*n,e[5]=r[5]*n,e[6]=r[6]*n,e[7]=r[7]*n,e[8]=r[8]*n,e}function et(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e[2]=r[2]+n[2]*t,e[3]=r[3]+n[3]*t,e[4]=r[4]+n[4]*t,e[5]=r[5]+n[5]*t,e[6]=r[6]+n[6]*t,e[7]=r[7]+n[7]*t,e[8]=r[8]+n[8]*t,e}function rt(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]}function nt(e,r){var n=e[0],t=e[1],s=e[2],a=e[3],i=e[4],c=e[5],o=e[6],l=e[7],h=e[8],p=r[0],v=r[1],x=r[2],d=r[3],m=r[4],y=r[5],g=r[6],w=r[7],b=r[8];return Math.abs(n-p)<=S*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(t-v)<=S*Math.max(1,Math.abs(t),Math.abs(v))&&Math.abs(s-x)<=S*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-d)<=S*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(i-m)<=S*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(c-y)<=S*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(o-g)<=S*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(h-b)<=S*Math.max(1,Math.abs(h),Math.abs(b))}var tt=wr,st=Ar;var de={};oe(de,{add:()=>Bt,adjoint:()=>pt,clone:()=>it,copy:()=>ct,create:()=>at,determinant:()=>vt,equals:()=>Ht,exactEquals:()=>Wt,frob:()=>Dt,fromQuat:()=>Nt,fromQuat2:()=>At,fromRotation:()=>ut,fromRotationTranslation:()=>Ir,fromRotationTranslationScale:()=>It,fromRotationTranslationScaleOrigin:()=>Et,fromScaling:()=>Pt,fromTranslation:()=>bt,fromValues:()=>ot,fromXRotation:()=>Ot,fromYRotation:()=>St,fromZRotation:()=>wt,frustum:()=>Tt,getRotation:()=>Ct,getScaling:()=>Er,getTranslation:()=>Rt,identity:()=>Rr,invert:()=>ht,lookAt:()=>Ft,mul:()=>Jt,multiply:()=>Cr,multiplyScalar:()=>Ut,multiplyScalarAndAdd:()=>jt,ortho:()=>_t,orthoNO:()=>Tr,orthoZO:()=>Lt,perspective:()=>zt,perspectiveFromFieldOfView:()=>kt,perspectiveNO:()=>Nr,perspectiveZO:()=>Gt,rotate:()=>dt,rotateX:()=>mt,rotateY:()=>gt,rotateZ:()=>Mt,scale:()=>yt,set:()=>lt,str:()=>Vt,sub:()=>$t,subtract:()=>zr,targetTo:()=>Yt,translate:()=>xt,transpose:()=>ft});function at(){var e=new E(16);return E!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function it(e){var r=new E(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function ct(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function ot(e,r,n,t,s,a,i,c,o,l,h,p,v,x,d,m){var y=new E(16);return y[0]=e,y[1]=r,y[2]=n,y[3]=t,y[4]=s,y[5]=a,y[6]=i,y[7]=c,y[8]=o,y[9]=l,y[10]=h,y[11]=p,y[12]=v,y[13]=x,y[14]=d,y[15]=m,y}function lt(e,r,n,t,s,a,i,c,o,l,h,p,v,x,d,m,y){return e[0]=r,e[1]=n,e[2]=t,e[3]=s,e[4]=a,e[5]=i,e[6]=c,e[7]=o,e[8]=l,e[9]=h,e[10]=p,e[11]=v,e[12]=x,e[13]=d,e[14]=m,e[15]=y,e}function Rr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ft(e,r){if(e===r){var n=r[1],t=r[2],s=r[3],a=r[6],i=r[7],c=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=n,e[6]=r[9],e[7]=r[13],e[8]=t,e[9]=a,e[11]=r[14],e[12]=s,e[13]=i,e[14]=c}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function ht(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],p=r[9],v=r[10],x=r[11],d=r[12],m=r[13],y=r[14],g=r[15],w=n*c-t*i,b=n*o-s*i,P=n*l-a*i,O=t*o-s*c,u=t*l-a*c,k=s*l-a*o,T=h*m-p*d,z=h*y-v*d,N=h*g-x*d,_=p*y-v*m,G=p*g-x*m,L=v*g-x*y,A=w*L-b*G+P*_+O*N-u*z+k*T;return A?(A=1/A,e[0]=(c*L-o*G+l*_)*A,e[1]=(s*G-t*L-a*_)*A,e[2]=(m*k-y*u+g*O)*A,e[3]=(v*u-p*k-x*O)*A,e[4]=(o*N-i*L-l*z)*A,e[5]=(n*L-s*N+a*z)*A,e[6]=(y*P-d*k-g*b)*A,e[7]=(h*k-v*P+x*b)*A,e[8]=(i*G-c*N+l*T)*A,e[9]=(t*N-n*G-a*T)*A,e[10]=(d*u-m*P+g*w)*A,e[11]=(p*P-h*u-x*w)*A,e[12]=(c*z-i*_-o*T)*A,e[13]=(n*_-t*z+s*T)*A,e[14]=(m*b-d*O-y*w)*A,e[15]=(h*O-p*b+v*w)*A,e):null}function pt(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],p=r[9],v=r[10],x=r[11],d=r[12],m=r[13],y=r[14],g=r[15];return e[0]=c*(v*g-x*y)-p*(o*g-l*y)+m*(o*x-l*v),e[1]=-(t*(v*g-x*y)-p*(s*g-a*y)+m*(s*x-a*v)),e[2]=t*(o*g-l*y)-c*(s*g-a*y)+m*(s*l-a*o),e[3]=-(t*(o*x-l*v)-c*(s*x-a*v)+p*(s*l-a*o)),e[4]=-(i*(v*g-x*y)-h*(o*g-l*y)+d*(o*x-l*v)),e[5]=n*(v*g-x*y)-h*(s*g-a*y)+d*(s*x-a*v),e[6]=-(n*(o*g-l*y)-i*(s*g-a*y)+d*(s*l-a*o)),e[7]=n*(o*x-l*v)-i*(s*x-a*v)+h*(s*l-a*o),e[8]=i*(p*g-x*m)-h*(c*g-l*m)+d*(c*x-l*p),e[9]=-(n*(p*g-x*m)-h*(t*g-a*m)+d*(t*x-a*p)),e[10]=n*(c*g-l*m)-i*(t*g-a*m)+d*(t*l-a*c),e[11]=-(n*(c*x-l*p)-i*(t*x-a*p)+h*(t*l-a*c)),e[12]=-(i*(p*y-v*m)-h*(c*y-o*m)+d*(c*v-o*p)),e[13]=n*(p*y-v*m)-h*(t*y-s*m)+d*(t*v-s*p),e[14]=-(n*(c*y-o*m)-i*(t*y-s*m)+d*(t*o-s*c)),e[15]=n*(c*v-o*p)-i*(t*v-s*p)+h*(t*o-s*c),e}function vt(e){var r=e[0],n=e[1],t=e[2],s=e[3],a=e[4],i=e[5],c=e[6],o=e[7],l=e[8],h=e[9],p=e[10],v=e[11],x=e[12],d=e[13],m=e[14],y=e[15],g=r*i-n*a,w=r*c-t*a,b=r*o-s*a,P=n*c-t*i,O=n*o-s*i,u=t*o-s*c,k=l*d-h*x,T=l*m-p*x,z=l*y-v*x,N=h*m-p*d,_=h*y-v*d,G=p*y-v*m;return g*G-w*_+b*N+P*z-O*T+u*k}function Cr(e,r,n){var t=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],p=r[8],v=r[9],x=r[10],d=r[11],m=r[12],y=r[13],g=r[14],w=r[15],b=n[0],P=n[1],O=n[2],u=n[3];return e[0]=b*t+P*c+O*p+u*m,e[1]=b*s+P*o+O*v+u*y,e[2]=b*a+P*l+O*x+u*g,e[3]=b*i+P*h+O*d+u*w,b=n[4],P=n[5],O=n[6],u=n[7],e[4]=b*t+P*c+O*p+u*m,e[5]=b*s+P*o+O*v+u*y,e[6]=b*a+P*l+O*x+u*g,e[7]=b*i+P*h+O*d+u*w,b=n[8],P=n[9],O=n[10],u=n[11],e[8]=b*t+P*c+O*p+u*m,e[9]=b*s+P*o+O*v+u*y,e[10]=b*a+P*l+O*x+u*g,e[11]=b*i+P*h+O*d+u*w,b=n[12],P=n[13],O=n[14],u=n[15],e[12]=b*t+P*c+O*p+u*m,e[13]=b*s+P*o+O*v+u*y,e[14]=b*a+P*l+O*x+u*g,e[15]=b*i+P*h+O*d+u*w,e}function xt(e,r,n){var t=n[0],s=n[1],a=n[2],i,c,o,l,h,p,v,x,d,m,y,g;return r===e?(e[12]=r[0]*t+r[4]*s+r[8]*a+r[12],e[13]=r[1]*t+r[5]*s+r[9]*a+r[13],e[14]=r[2]*t+r[6]*s+r[10]*a+r[14],e[15]=r[3]*t+r[7]*s+r[11]*a+r[15]):(i=r[0],c=r[1],o=r[2],l=r[3],h=r[4],p=r[5],v=r[6],x=r[7],d=r[8],m=r[9],y=r[10],g=r[11],e[0]=i,e[1]=c,e[2]=o,e[3]=l,e[4]=h,e[5]=p,e[6]=v,e[7]=x,e[8]=d,e[9]=m,e[10]=y,e[11]=g,e[12]=i*t+h*s+d*a+r[12],e[13]=c*t+p*s+m*a+r[13],e[14]=o*t+v*s+y*a+r[14],e[15]=l*t+x*s+g*a+r[15]),e}function yt(e,r,n){var t=n[0],s=n[1],a=n[2];return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=r[7]*s,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=r[11]*a,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function dt(e,r,n,t){var s=t[0],a=t[1],i=t[2],c=Math.hypot(s,a,i),o,l,h,p,v,x,d,m,y,g,w,b,P,O,u,k,T,z,N,_,G,L,A,J;return c<S?null:(c=1/c,s*=c,a*=c,i*=c,o=Math.sin(n),l=Math.cos(n),h=1-l,p=r[0],v=r[1],x=r[2],d=r[3],m=r[4],y=r[5],g=r[6],w=r[7],b=r[8],P=r[9],O=r[10],u=r[11],k=s*s*h+l,T=a*s*h+i*o,z=i*s*h-a*o,N=s*a*h-i*o,_=a*a*h+l,G=i*a*h+s*o,L=s*i*h+a*o,A=a*i*h-s*o,J=i*i*h+l,e[0]=p*k+m*T+b*z,e[1]=v*k+y*T+P*z,e[2]=x*k+g*T+O*z,e[3]=d*k+w*T+u*z,e[4]=p*N+m*_+b*G,e[5]=v*N+y*_+P*G,e[6]=x*N+g*_+O*G,e[7]=d*N+w*_+u*G,e[8]=p*L+m*A+b*J,e[9]=v*L+y*A+P*J,e[10]=x*L+g*A+O*J,e[11]=d*L+w*A+u*J,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function mt(e,r,n){var t=Math.sin(n),s=Math.cos(n),a=r[4],i=r[5],c=r[6],o=r[7],l=r[8],h=r[9],p=r[10],v=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=a*s+l*t,e[5]=i*s+h*t,e[6]=c*s+p*t,e[7]=o*s+v*t,e[8]=l*s-a*t,e[9]=h*s-i*t,e[10]=p*s-c*t,e[11]=v*s-o*t,e}function gt(e,r,n){var t=Math.sin(n),s=Math.cos(n),a=r[0],i=r[1],c=r[2],o=r[3],l=r[8],h=r[9],p=r[10],v=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*s-l*t,e[1]=i*s-h*t,e[2]=c*s-p*t,e[3]=o*s-v*t,e[8]=a*t+l*s,e[9]=i*t+h*s,e[10]=c*t+p*s,e[11]=o*t+v*s,e}function Mt(e,r,n){var t=Math.sin(n),s=Math.cos(n),a=r[0],i=r[1],c=r[2],o=r[3],l=r[4],h=r[5],p=r[6],v=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*s+l*t,e[1]=i*s+h*t,e[2]=c*s+p*t,e[3]=o*s+v*t,e[4]=l*s-a*t,e[5]=h*s-i*t,e[6]=p*s-c*t,e[7]=v*s-o*t,e}function bt(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Pt(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ut(e,r,n){var t=n[0],s=n[1],a=n[2],i=Math.hypot(t,s,a),c,o,l;return i<S?null:(i=1/i,t*=i,s*=i,a*=i,c=Math.sin(r),o=Math.cos(r),l=1-o,e[0]=t*t*l+o,e[1]=s*t*l+a*c,e[2]=a*t*l-s*c,e[3]=0,e[4]=t*s*l-a*c,e[5]=s*s*l+o,e[6]=a*s*l+t*c,e[7]=0,e[8]=t*a*l+s*c,e[9]=s*a*l-t*c,e[10]=a*a*l+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ot(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function St(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=t,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wt(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=t,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ir(e,r,n){var t=r[0],s=r[1],a=r[2],i=r[3],c=t+t,o=s+s,l=a+a,h=t*c,p=t*o,v=t*l,x=s*o,d=s*l,m=a*l,y=i*c,g=i*o,w=i*l;return e[0]=1-(x+m),e[1]=p+w,e[2]=v-g,e[3]=0,e[4]=p-w,e[5]=1-(h+m),e[6]=d+y,e[7]=0,e[8]=v+g,e[9]=d-y,e[10]=1-(h+x),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function At(e,r){var n=new E(3),t=-r[0],s=-r[1],a=-r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],p=t*t+s*s+a*a+i*i;return p>0?(n[0]=(c*i+h*t+o*a-l*s)*2/p,n[1]=(o*i+h*s+l*t-c*a)*2/p,n[2]=(l*i+h*a+c*s-o*t)*2/p):(n[0]=(c*i+h*t+o*a-l*s)*2,n[1]=(o*i+h*s+l*t-c*a)*2,n[2]=(l*i+h*a+c*s-o*t)*2),Ir(e,r,n),e}function Rt(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function Er(e,r){var n=r[0],t=r[1],s=r[2],a=r[4],i=r[5],c=r[6],o=r[8],l=r[9],h=r[10];return e[0]=Math.hypot(n,t,s),e[1]=Math.hypot(a,i,c),e[2]=Math.hypot(o,l,h),e}function Ct(e,r){var n=new E(3);Er(n,r);var t=1/n[0],s=1/n[1],a=1/n[2],i=r[0]*t,c=r[1]*s,o=r[2]*a,l=r[4]*t,h=r[5]*s,p=r[6]*a,v=r[8]*t,x=r[9]*s,d=r[10]*a,m=i+h+d,y=0;return m>0?(y=Math.sqrt(m+1)*2,e[3]=.25*y,e[0]=(p-x)/y,e[1]=(v-o)/y,e[2]=(c-l)/y):i>h&&i>d?(y=Math.sqrt(1+i-h-d)*2,e[3]=(p-x)/y,e[0]=.25*y,e[1]=(c+l)/y,e[2]=(v+o)/y):h>d?(y=Math.sqrt(1+h-i-d)*2,e[3]=(v-o)/y,e[0]=(c+l)/y,e[1]=.25*y,e[2]=(p+x)/y):(y=Math.sqrt(1+d-i-h)*2,e[3]=(c-l)/y,e[0]=(v+o)/y,e[1]=(p+x)/y,e[2]=.25*y),e}function It(e,r,n,t){var s=r[0],a=r[1],i=r[2],c=r[3],o=s+s,l=a+a,h=i+i,p=s*o,v=s*l,x=s*h,d=a*l,m=a*h,y=i*h,g=c*o,w=c*l,b=c*h,P=t[0],O=t[1],u=t[2];return e[0]=(1-(d+y))*P,e[1]=(v+b)*P,e[2]=(x-w)*P,e[3]=0,e[4]=(v-b)*O,e[5]=(1-(p+y))*O,e[6]=(m+g)*O,e[7]=0,e[8]=(x+w)*u,e[9]=(m-g)*u,e[10]=(1-(p+d))*u,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Et(e,r,n,t,s){var a=r[0],i=r[1],c=r[2],o=r[3],l=a+a,h=i+i,p=c+c,v=a*l,x=a*h,d=a*p,m=i*h,y=i*p,g=c*p,w=o*l,b=o*h,P=o*p,O=t[0],u=t[1],k=t[2],T=s[0],z=s[1],N=s[2],_=(1-(m+g))*O,G=(x+P)*O,L=(d-b)*O,A=(x-P)*u,J=(1-(v+g))*u,xe=(y+w)*u,ye=(d+b)*k,ur=(y-w)*k,Or=(1-(v+m))*k;return e[0]=_,e[1]=G,e[2]=L,e[3]=0,e[4]=A,e[5]=J,e[6]=xe,e[7]=0,e[8]=ye,e[9]=ur,e[10]=Or,e[11]=0,e[12]=n[0]+T-(_*T+A*z+ye*N),e[13]=n[1]+z-(G*T+J*z+ur*N),e[14]=n[2]+N-(L*T+xe*z+Or*N),e[15]=1,e}function Nt(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=n+n,c=t+t,o=s+s,l=n*i,h=t*i,p=t*c,v=s*i,x=s*c,d=s*o,m=a*i,y=a*c,g=a*o;return e[0]=1-p-d,e[1]=h+g,e[2]=v-y,e[3]=0,e[4]=h-g,e[5]=1-l-d,e[6]=x+m,e[7]=0,e[8]=v+y,e[9]=x-m,e[10]=1-l-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tt(e,r,n,t,s,a,i){var c=1/(n-r),o=1/(s-t),l=1/(a-i);return e[0]=a*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*o,e[6]=0,e[7]=0,e[8]=(n+r)*c,e[9]=(s+t)*o,e[10]=(i+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*a*2*l,e[15]=0,e}function Nr(e,r,n,t,s){var a=1/Math.tan(r/2),i;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(i=1/(t-s),e[10]=(s+t)*i,e[14]=2*s*t*i):(e[10]=-1,e[14]=-2*t),e}var zt=Nr;function Gt(e,r,n,t,s){var a=1/Math.tan(r/2),i;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(i=1/(t-s),e[10]=s*i,e[14]=s*t*i):(e[10]=-1,e[14]=-t),e}function kt(e,r,n,t){var s=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),i=Math.tan(r.leftDegrees*Math.PI/180),c=Math.tan(r.rightDegrees*Math.PI/180),o=2/(i+c),l=2/(s+a);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((i-c)*o*.5),e[9]=(s-a)*l*.5,e[10]=t/(n-t),e[11]=-1,e[12]=0,e[13]=0,e[14]=t*n/(n-t),e[15]=0,e}function Tr(e,r,n,t,s,a,i){var c=1/(r-n),o=1/(t-s),l=1/(a-i);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(r+n)*c,e[13]=(s+t)*o,e[14]=(i+a)*l,e[15]=1,e}var _t=Tr;function Lt(e,r,n,t,s,a,i){var c=1/(r-n),o=1/(t-s),l=1/(a-i);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(r+n)*c,e[13]=(s+t)*o,e[14]=a*l,e[15]=1,e}function Ft(e,r,n,t){var s,a,i,c,o,l,h,p,v,x,d=r[0],m=r[1],y=r[2],g=t[0],w=t[1],b=t[2],P=n[0],O=n[1],u=n[2];return Math.abs(d-P)<S&&Math.abs(m-O)<S&&Math.abs(y-u)<S?Rr(e):(h=d-P,p=m-O,v=y-u,x=1/Math.hypot(h,p,v),h*=x,p*=x,v*=x,s=w*v-b*p,a=b*h-g*v,i=g*p-w*h,x=Math.hypot(s,a,i),x?(x=1/x,s*=x,a*=x,i*=x):(s=0,a=0,i=0),c=p*i-v*a,o=v*s-h*i,l=h*a-p*s,x=Math.hypot(c,o,l),x?(x=1/x,c*=x,o*=x,l*=x):(c=0,o=0,l=0),e[0]=s,e[1]=c,e[2]=h,e[3]=0,e[4]=a,e[5]=o,e[6]=p,e[7]=0,e[8]=i,e[9]=l,e[10]=v,e[11]=0,e[12]=-(s*d+a*m+i*y),e[13]=-(c*d+o*m+l*y),e[14]=-(h*d+p*m+v*y),e[15]=1,e)}function Yt(e,r,n,t){var s=r[0],a=r[1],i=r[2],c=t[0],o=t[1],l=t[2],h=s-n[0],p=a-n[1],v=i-n[2],x=h*h+p*p+v*v;x>0&&(x=1/Math.sqrt(x),h*=x,p*=x,v*=x);var d=o*v-l*p,m=l*h-c*v,y=c*p-o*h;return x=d*d+m*m+y*y,x>0&&(x=1/Math.sqrt(x),d*=x,m*=x,y*=x),e[0]=d,e[1]=m,e[2]=y,e[3]=0,e[4]=p*y-v*m,e[5]=v*d-h*y,e[6]=h*m-p*d,e[7]=0,e[8]=h,e[9]=p,e[10]=v,e[11]=0,e[12]=s,e[13]=a,e[14]=i,e[15]=1,e}function Vt(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Dt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Bt(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e[3]=r[3]+n[3],e[4]=r[4]+n[4],e[5]=r[5]+n[5],e[6]=r[6]+n[6],e[7]=r[7]+n[7],e[8]=r[8]+n[8],e[9]=r[9]+n[9],e[10]=r[10]+n[10],e[11]=r[11]+n[11],e[12]=r[12]+n[12],e[13]=r[13]+n[13],e[14]=r[14]+n[14],e[15]=r[15]+n[15],e}function zr(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e[3]=r[3]-n[3],e[4]=r[4]-n[4],e[5]=r[5]-n[5],e[6]=r[6]-n[6],e[7]=r[7]-n[7],e[8]=r[8]-n[8],e[9]=r[9]-n[9],e[10]=r[10]-n[10],e[11]=r[11]-n[11],e[12]=r[12]-n[12],e[13]=r[13]-n[13],e[14]=r[14]-n[14],e[15]=r[15]-n[15],e}function Ut(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*n,e[5]=r[5]*n,e[6]=r[6]*n,e[7]=r[7]*n,e[8]=r[8]*n,e[9]=r[9]*n,e[10]=r[10]*n,e[11]=r[11]*n,e[12]=r[12]*n,e[13]=r[13]*n,e[14]=r[14]*n,e[15]=r[15]*n,e}function jt(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e[2]=r[2]+n[2]*t,e[3]=r[3]+n[3]*t,e[4]=r[4]+n[4]*t,e[5]=r[5]+n[5]*t,e[6]=r[6]+n[6]*t,e[7]=r[7]+n[7]*t,e[8]=r[8]+n[8]*t,e[9]=r[9]+n[9]*t,e[10]=r[10]+n[10]*t,e[11]=r[11]+n[11]*t,e[12]=r[12]+n[12]*t,e[13]=r[13]+n[13]*t,e[14]=r[14]+n[14]*t,e[15]=r[15]+n[15]*t,e}function Wt(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function Ht(e,r){var n=e[0],t=e[1],s=e[2],a=e[3],i=e[4],c=e[5],o=e[6],l=e[7],h=e[8],p=e[9],v=e[10],x=e[11],d=e[12],m=e[13],y=e[14],g=e[15],w=r[0],b=r[1],P=r[2],O=r[3],u=r[4],k=r[5],T=r[6],z=r[7],N=r[8],_=r[9],G=r[10],L=r[11],A=r[12],J=r[13],xe=r[14],ye=r[15];return Math.abs(n-w)<=S*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(t-b)<=S*Math.max(1,Math.abs(t),Math.abs(b))&&Math.abs(s-P)<=S*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(a-O)<=S*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(i-u)<=S*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(c-k)<=S*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(o-T)<=S*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-z)<=S*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(h-N)<=S*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(p-_)<=S*Math.max(1,Math.abs(p),Math.abs(_))&&Math.abs(v-G)<=S*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(x-L)<=S*Math.max(1,Math.abs(x),Math.abs(L))&&Math.abs(d-A)<=S*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(m-J)<=S*Math.max(1,Math.abs(m),Math.abs(J))&&Math.abs(y-xe)<=S*Math.max(1,Math.abs(y),Math.abs(xe))&&Math.abs(g-ye)<=S*Math.max(1,Math.abs(g),Math.abs(ye))}var Jt=Cr,$t=zr;var Re={};oe(Re,{add:()=>ya,calculateW:()=>sa,clone:()=>ha,conjugate:()=>oa,copy:()=>va,create:()=>rr,dot:()=>Qr,equals:()=>Pa,exactEquals:()=>ba,exp:()=>Zr,fromEuler:()=>la,fromMat3:()=>Xr,fromValues:()=>pa,getAngle:()=>ea,getAxisAngle:()=>Qs,identity:()=>Ks,invert:()=>ca,len:()=>ga,length:()=>en,lerp:()=>ma,ln:()=>qr,mul:()=>da,multiply:()=>$r,normalize:()=>nr,pow:()=>aa,random:()=>ia,rotateX:()=>ra,rotateY:()=>na,rotateZ:()=>ta,rotationTo:()=>ua,scale:()=>Kr,set:()=>xa,setAxes:()=>Sa,setAxisAngle:()=>Jr,slerp:()=>Ae,sqlerp:()=>Oa,sqrLen:()=>Ma,squaredLength:()=>rn,str:()=>fa});var f={};oe(f,{add:()=>Kt,angle:()=>gs,bezier:()=>fs,ceil:()=>Qt,clone:()=>Zt,copy:()=>qt,create:()=>Pe,cross:()=>me,dist:()=>As,distance:()=>Fr,div:()=>ws,divide:()=>Lr,dot:()=>Oe,equals:()=>us,exactEquals:()=>Ps,floor:()=>es,forEach:()=>Is,fromValues:()=>ue,hermite:()=>ls,inverse:()=>cs,len:()=>Ue,length:()=>Gr,lerp:()=>os,max:()=>ns,min:()=>rs,mul:()=>Ss,multiply:()=>_r,negate:()=>is,normalize:()=>Be,random:()=>hs,rotateX:()=>ys,rotateY:()=>ds,rotateZ:()=>ms,round:()=>ts,scale:()=>ss,scaleAndAdd:()=>as,set:()=>Xt,sqrDist:()=>Rs,sqrLen:()=>Cs,squaredDistance:()=>Yr,squaredLength:()=>Vr,str:()=>bs,sub:()=>Os,subtract:()=>kr,transformMat3:()=>vs,transformMat4:()=>ps,transformQuat:()=>xs,zero:()=>Ms});function Pe(){var e=new E(3);return E!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Zt(e){var r=new E(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function Gr(e){var r=e[0],n=e[1],t=e[2];return Math.hypot(r,n,t)}function ue(e,r,n){var t=new E(3);return t[0]=e,t[1]=r,t[2]=n,t}function qt(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Xt(e,r,n,t){return e[0]=r,e[1]=n,e[2]=t,e}function Kt(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e}function kr(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e}function _r(e,r,n){return e[0]=r[0]*n[0],e[1]=r[1]*n[1],e[2]=r[2]*n[2],e}function Lr(e,r,n){return e[0]=r[0]/n[0],e[1]=r[1]/n[1],e[2]=r[2]/n[2],e}function Qt(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function es(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function rs(e,r,n){return e[0]=Math.min(r[0],n[0]),e[1]=Math.min(r[1],n[1]),e[2]=Math.min(r[2],n[2]),e}function ns(e,r,n){return e[0]=Math.max(r[0],n[0]),e[1]=Math.max(r[1],n[1]),e[2]=Math.max(r[2],n[2]),e}function ts(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function ss(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e}function as(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e[2]=r[2]+n[2]*t,e}function Fr(e,r){var n=r[0]-e[0],t=r[1]-e[1],s=r[2]-e[2];return Math.hypot(n,t,s)}function Yr(e,r){var n=r[0]-e[0],t=r[1]-e[1],s=r[2]-e[2];return n*n+t*t+s*s}function Vr(e){var r=e[0],n=e[1],t=e[2];return r*r+n*n+t*t}function is(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function cs(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function Be(e,r){var n=r[0],t=r[1],s=r[2],a=n*n+t*t+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function Oe(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function me(e,r,n){var t=r[0],s=r[1],a=r[2],i=n[0],c=n[1],o=n[2];return e[0]=s*o-a*c,e[1]=a*i-t*o,e[2]=t*c-s*i,e}function os(e,r,n,t){var s=r[0],a=r[1],i=r[2];return e[0]=s+t*(n[0]-s),e[1]=a+t*(n[1]-a),e[2]=i+t*(n[2]-i),e}function ls(e,r,n,t,s,a){var i=a*a,c=i*(2*a-3)+1,o=i*(a-2)+a,l=i*(a-1),h=i*(3-2*a);return e[0]=r[0]*c+n[0]*o+t[0]*l+s[0]*h,e[1]=r[1]*c+n[1]*o+t[1]*l+s[1]*h,e[2]=r[2]*c+n[2]*o+t[2]*l+s[2]*h,e}function fs(e,r,n,t,s,a){var i=1-a,c=i*i,o=a*a,l=c*i,h=3*a*c,p=3*o*i,v=o*a;return e[0]=r[0]*l+n[0]*h+t[0]*p+s[0]*v,e[1]=r[1]*l+n[1]*h+t[1]*p+s[1]*v,e[2]=r[2]*l+n[2]*h+t[2]*p+s[2]*v,e}function hs(e,r){r=r||1;var n=Y()*2*Math.PI,t=Y()*2-1,s=Math.sqrt(1-t*t)*r;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=t*r,e}function ps(e,r,n){var t=r[0],s=r[1],a=r[2],i=n[3]*t+n[7]*s+n[11]*a+n[15];return i=i||1,e[0]=(n[0]*t+n[4]*s+n[8]*a+n[12])/i,e[1]=(n[1]*t+n[5]*s+n[9]*a+n[13])/i,e[2]=(n[2]*t+n[6]*s+n[10]*a+n[14])/i,e}function vs(e,r,n){var t=r[0],s=r[1],a=r[2];return e[0]=t*n[0]+s*n[3]+a*n[6],e[1]=t*n[1]+s*n[4]+a*n[7],e[2]=t*n[2]+s*n[5]+a*n[8],e}function xs(e,r,n){var t=n[0],s=n[1],a=n[2],i=n[3],c=r[0],o=r[1],l=r[2],h=s*l-a*o,p=a*c-t*l,v=t*o-s*c,x=s*v-a*p,d=a*h-t*v,m=t*p-s*h,y=i*2;return h*=y,p*=y,v*=y,x*=2,d*=2,m*=2,e[0]=c+h+x,e[1]=o+p+d,e[2]=l+v+m,e}function ys(e,r,n,t){var s=[],a=[];return s[0]=r[0]-n[0],s[1]=r[1]-n[1],s[2]=r[2]-n[2],a[0]=s[0],a[1]=s[1]*Math.cos(t)-s[2]*Math.sin(t),a[2]=s[1]*Math.sin(t)+s[2]*Math.cos(t),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function ds(e,r,n,t){var s=[],a=[];return s[0]=r[0]-n[0],s[1]=r[1]-n[1],s[2]=r[2]-n[2],a[0]=s[2]*Math.sin(t)+s[0]*Math.cos(t),a[1]=s[1],a[2]=s[2]*Math.cos(t)-s[0]*Math.sin(t),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function ms(e,r,n,t){var s=[],a=[];return s[0]=r[0]-n[0],s[1]=r[1]-n[1],s[2]=r[2]-n[2],a[0]=s[0]*Math.cos(t)-s[1]*Math.sin(t),a[1]=s[0]*Math.sin(t)+s[1]*Math.cos(t),a[2]=s[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function gs(e,r){var n=e[0],t=e[1],s=e[2],a=r[0],i=r[1],c=r[2],o=Math.sqrt(n*n+t*t+s*s),l=Math.sqrt(a*a+i*i+c*c),h=o*l,p=h&&Oe(e,r)/h;return Math.acos(Math.min(Math.max(p,-1),1))}function Ms(e){return e[0]=0,e[1]=0,e[2]=0,e}function bs(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ps(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function us(e,r){var n=e[0],t=e[1],s=e[2],a=r[0],i=r[1],c=r[2];return Math.abs(n-a)<=S*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(t-i)<=S*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(s-c)<=S*Math.max(1,Math.abs(s),Math.abs(c))}var Os=kr,Ss=_r,ws=Lr,As=Fr,Rs=Yr,Ue=Gr,Cs=Vr,Is=function(){var e=Pe();return function(r,n,t,s,a,i){var c,o;for(n||(n=3),t||(t=0),s?o=Math.min(s*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],a(e,e,i),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2];return r}}();var ne={};oe(ne,{add:()=>$e,ceil:()=>Es,clone:()=>je,copy:()=>He,create:()=>Dr,cross:()=>Fs,dist:()=>Js,distance:()=>Wr,div:()=>Hs,divide:()=>jr,dot:()=>Xe,equals:()=>er,exactEquals:()=>Qe,floor:()=>Ns,forEach:()=>Xs,fromValues:()=>We,inverse:()=>Ls,len:()=>Zs,length:()=>Se,lerp:()=>Ke,max:()=>zs,min:()=>Ts,mul:()=>Ws,multiply:()=>Ur,negate:()=>_s,normalize:()=>qe,random:()=>Ys,round:()=>Gs,scale:()=>Ze,scaleAndAdd:()=>ks,set:()=>Je,sqrDist:()=>$s,sqrLen:()=>qs,squaredDistance:()=>Hr,squaredLength:()=>we,str:()=>Us,sub:()=>js,subtract:()=>Br,transformMat4:()=>Vs,transformQuat:()=>Ds,zero:()=>Bs});function Dr(){var e=new E(4);return E!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function je(e){var r=new E(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function We(e,r,n,t){var s=new E(4);return s[0]=e,s[1]=r,s[2]=n,s[3]=t,s}function He(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function Je(e,r,n,t,s){return e[0]=r,e[1]=n,e[2]=t,e[3]=s,e}function $e(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e[3]=r[3]+n[3],e}function Br(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e[3]=r[3]-n[3],e}function Ur(e,r,n){return e[0]=r[0]*n[0],e[1]=r[1]*n[1],e[2]=r[2]*n[2],e[3]=r[3]*n[3],e}function jr(e,r,n){return e[0]=r[0]/n[0],e[1]=r[1]/n[1],e[2]=r[2]/n[2],e[3]=r[3]/n[3],e}function Es(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function Ns(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function Ts(e,r,n){return e[0]=Math.min(r[0],n[0]),e[1]=Math.min(r[1],n[1]),e[2]=Math.min(r[2],n[2]),e[3]=Math.min(r[3],n[3]),e}function zs(e,r,n){return e[0]=Math.max(r[0],n[0]),e[1]=Math.max(r[1],n[1]),e[2]=Math.max(r[2],n[2]),e[3]=Math.max(r[3],n[3]),e}function Gs(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function Ze(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e}function ks(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e[2]=r[2]+n[2]*t,e[3]=r[3]+n[3]*t,e}function Wr(e,r){var n=r[0]-e[0],t=r[1]-e[1],s=r[2]-e[2],a=r[3]-e[3];return Math.hypot(n,t,s,a)}function Hr(e,r){var n=r[0]-e[0],t=r[1]-e[1],s=r[2]-e[2],a=r[3]-e[3];return n*n+t*t+s*s+a*a}function Se(e){var r=e[0],n=e[1],t=e[2],s=e[3];return Math.hypot(r,n,t,s)}function we(e){var r=e[0],n=e[1],t=e[2],s=e[3];return r*r+n*n+t*t+s*s}function _s(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function Ls(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function qe(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=n*n+t*t+s*s+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=n*i,e[1]=t*i,e[2]=s*i,e[3]=a*i,e}function Xe(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function Fs(e,r,n,t){var s=n[0]*t[1]-n[1]*t[0],a=n[0]*t[2]-n[2]*t[0],i=n[0]*t[3]-n[3]*t[0],c=n[1]*t[2]-n[2]*t[1],o=n[1]*t[3]-n[3]*t[1],l=n[2]*t[3]-n[3]*t[2],h=r[0],p=r[1],v=r[2],x=r[3];return e[0]=p*l-v*o+x*c,e[1]=-(h*l)+v*i-x*a,e[2]=h*o-p*i+x*s,e[3]=-(h*c)+p*a-v*s,e}function Ke(e,r,n,t){var s=r[0],a=r[1],i=r[2],c=r[3];return e[0]=s+t*(n[0]-s),e[1]=a+t*(n[1]-a),e[2]=i+t*(n[2]-i),e[3]=c+t*(n[3]-c),e}function Ys(e,r){r=r||1;var n,t,s,a,i,c;do n=Y()*2-1,t=Y()*2-1,i=n*n+t*t;while(i>=1);do s=Y()*2-1,a=Y()*2-1,c=s*s+a*a;while(c>=1);var o=Math.sqrt((1-i)/c);return e[0]=r*n,e[1]=r*t,e[2]=r*s*o,e[3]=r*a*o,e}function Vs(e,r,n){var t=r[0],s=r[1],a=r[2],i=r[3];return e[0]=n[0]*t+n[4]*s+n[8]*a+n[12]*i,e[1]=n[1]*t+n[5]*s+n[9]*a+n[13]*i,e[2]=n[2]*t+n[6]*s+n[10]*a+n[14]*i,e[3]=n[3]*t+n[7]*s+n[11]*a+n[15]*i,e}function Ds(e,r,n){var t=r[0],s=r[1],a=r[2],i=n[0],c=n[1],o=n[2],l=n[3],h=l*t+c*a-o*s,p=l*s+o*t-i*a,v=l*a+i*s-c*t,x=-i*t-c*s-o*a;return e[0]=h*l+x*-i+p*-o-v*-c,e[1]=p*l+x*-c+v*-i-h*-o,e[2]=v*l+x*-o+h*-c-p*-i,e[3]=r[3],e}function Bs(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Us(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Qe(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function er(e,r){var n=e[0],t=e[1],s=e[2],a=e[3],i=r[0],c=r[1],o=r[2],l=r[3];return Math.abs(n-i)<=S*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(t-c)<=S*Math.max(1,Math.abs(t),Math.abs(c))&&Math.abs(s-o)<=S*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(a-l)<=S*Math.max(1,Math.abs(a),Math.abs(l))}var js=Br,Ws=Ur,Hs=jr,Js=Wr,$s=Hr,Zs=Se,qs=we,Xs=function(){var e=Dr();return function(r,n,t,s,a,i){var c,o;for(n||(n=4),t||(t=0),s?o=Math.min(s*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],e[3]=r[c+3],a(e,e,i),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2],r[c+3]=e[3];return r}}();function rr(){var e=new E(4);return E!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ks(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Jr(e,r,n){n=n*.5;var t=Math.sin(n);return e[0]=t*r[0],e[1]=t*r[1],e[2]=t*r[2],e[3]=Math.cos(n),e}function Qs(e,r){var n=Math.acos(r[3])*2,t=Math.sin(n/2);return t>S?(e[0]=r[0]/t,e[1]=r[1]/t,e[2]=r[2]/t):(e[0]=1,e[1]=0,e[2]=0),n}function ea(e,r){var n=Qr(e,r);return Math.acos(2*n*n-1)}function $r(e,r,n){var t=r[0],s=r[1],a=r[2],i=r[3],c=n[0],o=n[1],l=n[2],h=n[3];return e[0]=t*h+i*c+s*l-a*o,e[1]=s*h+i*o+a*c-t*l,e[2]=a*h+i*l+t*o-s*c,e[3]=i*h-t*c-s*o-a*l,e}function ra(e,r,n){n*=.5;var t=r[0],s=r[1],a=r[2],i=r[3],c=Math.sin(n),o=Math.cos(n);return e[0]=t*o+i*c,e[1]=s*o+a*c,e[2]=a*o-s*c,e[3]=i*o-t*c,e}function na(e,r,n){n*=.5;var t=r[0],s=r[1],a=r[2],i=r[3],c=Math.sin(n),o=Math.cos(n);return e[0]=t*o-a*c,e[1]=s*o+i*c,e[2]=a*o+t*c,e[3]=i*o-s*c,e}function ta(e,r,n){n*=.5;var t=r[0],s=r[1],a=r[2],i=r[3],c=Math.sin(n),o=Math.cos(n);return e[0]=t*o+s*c,e[1]=s*o-t*c,e[2]=a*o+i*c,e[3]=i*o-a*c,e}function sa(e,r){var n=r[0],t=r[1],s=r[2];return e[0]=n,e[1]=t,e[2]=s,e[3]=Math.sqrt(Math.abs(1-n*n-t*t-s*s)),e}function Zr(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=Math.sqrt(n*n+t*t+s*s),c=Math.exp(a),o=i>0?c*Math.sin(i)/i:0;return e[0]=n*o,e[1]=t*o,e[2]=s*o,e[3]=c*Math.cos(i),e}function qr(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=Math.sqrt(n*n+t*t+s*s),c=i>0?Math.atan2(i,a)/i:0;return e[0]=n*c,e[1]=t*c,e[2]=s*c,e[3]=.5*Math.log(n*n+t*t+s*s+a*a),e}function aa(e,r,n){return qr(e,r),Kr(e,e,n),Zr(e,e),e}function Ae(e,r,n,t){var s=r[0],a=r[1],i=r[2],c=r[3],o=n[0],l=n[1],h=n[2],p=n[3],v,x,d,m,y;return x=s*o+a*l+i*h+c*p,x<0&&(x=-x,o=-o,l=-l,h=-h,p=-p),1-x>S?(v=Math.acos(x),d=Math.sin(v),m=Math.sin((1-t)*v)/d,y=Math.sin(t*v)/d):(m=1-t,y=t),e[0]=m*s+y*o,e[1]=m*a+y*l,e[2]=m*i+y*h,e[3]=m*c+y*p,e}function ia(e){var r=Y(),n=Y(),t=Y(),s=Math.sqrt(1-r),a=Math.sqrt(r);return e[0]=s*Math.sin(2*Math.PI*n),e[1]=s*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*t),e[3]=a*Math.cos(2*Math.PI*t),e}function ca(e,r){var n=r[0],t=r[1],s=r[2],a=r[3],i=n*n+t*t+s*s+a*a,c=i?1/i:0;return e[0]=-n*c,e[1]=-t*c,e[2]=-s*c,e[3]=a*c,e}function oa(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=r[3],e}function Xr(e,r){var n=r[0]+r[4]+r[8],t;if(n>0)t=Math.sqrt(n+1),e[3]=.5*t,t=.5/t,e[0]=(r[5]-r[7])*t,e[1]=(r[6]-r[2])*t,e[2]=(r[1]-r[3])*t;else{var s=0;r[4]>r[0]&&(s=1),r[8]>r[s*3+s]&&(s=2);var a=(s+1)%3,i=(s+2)%3;t=Math.sqrt(r[s*3+s]-r[a*3+a]-r[i*3+i]+1),e[s]=.5*t,t=.5/t,e[3]=(r[a*3+i]-r[i*3+a])*t,e[a]=(r[a*3+s]+r[s*3+a])*t,e[i]=(r[i*3+s]+r[s*3+i])*t}return e}function la(e,r,n,t){var s=.5*Math.PI/180;r*=s,n*=s,t*=s;var a=Math.sin(r),i=Math.cos(r),c=Math.sin(n),o=Math.cos(n),l=Math.sin(t),h=Math.cos(t);return e[0]=a*o*h-i*c*l,e[1]=i*c*h+a*o*l,e[2]=i*o*l-a*c*h,e[3]=i*o*h+a*c*l,e}function fa(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var ha=je,pa=We,va=He,xa=Je,ya=$e,da=$r,Kr=Ze,Qr=Xe,ma=Ke,en=Se,ga=en,rn=we,Ma=rn,nr=qe,ba=Qe,Pa=er,ua=function(){var e=Pe(),r=ue(1,0,0),n=ue(0,1,0);return function(t,s,a){var i=Oe(s,a);return i<-.999999?(me(e,r,s),Ue(e)<1e-6&&me(e,n,s),Be(e,e),Jr(t,e,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(me(e,s,a),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1+i,nr(t,t))}}(),Oa=function(){var e=rr(),r=rr();return function(n,t,s,a,i,c){return Ae(e,t,i,c),Ae(r,s,a,c),Ae(n,e,r,2*c*(1-c)),n}}(),Sa=function(){var e=De();return function(r,n,t,s){return e[0]=t[0],e[3]=t[1],e[6]=t[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],nr(r,Xr(r,e))}}();var j={};oe(j,{add:()=>Ia,angle:()=>Za,ceil:()=>Ea,clone:()=>wa,copy:()=>Ra,create:()=>nn,cross:()=>Da,dist:()=>si,distance:()=>cn,div:()=>ti,divide:()=>an,dot:()=>Va,equals:()=>Qa,exactEquals:()=>Ka,floor:()=>Na,forEach:()=>ci,fromValues:()=>Aa,inverse:()=>Fa,len:()=>ei,length:()=>ln,lerp:()=>Ba,max:()=>za,min:()=>Ta,mul:()=>ni,multiply:()=>sn,negate:()=>La,normalize:()=>Ya,random:()=>Ua,rotate:()=>$a,round:()=>Ga,scale:()=>ka,scaleAndAdd:()=>_a,set:()=>Ca,sqrDist:()=>ai,sqrLen:()=>ii,squaredDistance:()=>on,squaredLength:()=>fn,str:()=>Xa,sub:()=>ri,subtract:()=>tn,transformMat2:()=>ja,transformMat2d:()=>Wa,transformMat3:()=>Ha,transformMat4:()=>Ja,zero:()=>qa});function nn(){var e=new E(2);return E!=Float32Array&&(e[0]=0,e[1]=0),e}function wa(e){var r=new E(2);return r[0]=e[0],r[1]=e[1],r}function Aa(e,r){var n=new E(2);return n[0]=e,n[1]=r,n}function Ra(e,r){return e[0]=r[0],e[1]=r[1],e}function Ca(e,r,n){return e[0]=r,e[1]=n,e}function Ia(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e}function tn(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e}function sn(e,r,n){return e[0]=r[0]*n[0],e[1]=r[1]*n[1],e}function an(e,r,n){return e[0]=r[0]/n[0],e[1]=r[1]/n[1],e}function Ea(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function Na(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Ta(e,r,n){return e[0]=Math.min(r[0],n[0]),e[1]=Math.min(r[1],n[1]),e}function za(e,r,n){return e[0]=Math.max(r[0],n[0]),e[1]=Math.max(r[1],n[1]),e}function Ga(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function ka(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e}function _a(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e}function cn(e,r){var n=r[0]-e[0],t=r[1]-e[1];return Math.hypot(n,t)}function on(e,r){var n=r[0]-e[0],t=r[1]-e[1];return n*n+t*t}function ln(e){var r=e[0],n=e[1];return Math.hypot(r,n)}function fn(e){var r=e[0],n=e[1];return r*r+n*n}function La(e,r){return e[0]=-r[0],e[1]=-r[1],e}function Fa(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function Ya(e,r){var n=r[0],t=r[1],s=n*n+t*t;return s>0&&(s=1/Math.sqrt(s)),e[0]=r[0]*s,e[1]=r[1]*s,e}function Va(e,r){return e[0]*r[0]+e[1]*r[1]}function Da(e,r,n){var t=r[0]*n[1]-r[1]*n[0];return e[0]=e[1]=0,e[2]=t,e}function Ba(e,r,n,t){var s=r[0],a=r[1];return e[0]=s+t*(n[0]-s),e[1]=a+t*(n[1]-a),e}function Ua(e,r){r=r||1;var n=Y()*2*Math.PI;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e}function ja(e,r,n){var t=r[0],s=r[1];return e[0]=n[0]*t+n[2]*s,e[1]=n[1]*t+n[3]*s,e}function Wa(e,r,n){var t=r[0],s=r[1];return e[0]=n[0]*t+n[2]*s+n[4],e[1]=n[1]*t+n[3]*s+n[5],e}function Ha(e,r,n){var t=r[0],s=r[1];return e[0]=n[0]*t+n[3]*s+n[6],e[1]=n[1]*t+n[4]*s+n[7],e}function Ja(e,r,n){var t=r[0],s=r[1];return e[0]=n[0]*t+n[4]*s+n[12],e[1]=n[1]*t+n[5]*s+n[13],e}function $a(e,r,n,t){var s=r[0]-n[0],a=r[1]-n[1],i=Math.sin(t),c=Math.cos(t);return e[0]=s*c-a*i+n[0],e[1]=s*i+a*c+n[1],e}function Za(e,r){var n=e[0],t=e[1],s=r[0],a=r[1],i=Math.sqrt(n*n+t*t)*Math.sqrt(s*s+a*a),c=i&&(n*s+t*a)/i;return Math.acos(Math.min(Math.max(c,-1),1))}function qa(e){return e[0]=0,e[1]=0,e}function Xa(e){return"vec2("+e[0]+", "+e[1]+")"}function Ka(e,r){return e[0]===r[0]&&e[1]===r[1]}function Qa(e,r){var n=e[0],t=e[1],s=r[0],a=r[1];return Math.abs(n-s)<=S*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(t-a)<=S*Math.max(1,Math.abs(t),Math.abs(a))}var ei=ln,ri=tn,ni=sn,ti=an,si=cn,ai=on,ii=fn,ci=function(){var e=nn();return function(r,n,t,s,a,i){var c,o;for(n||(n=2),t||(t=0),s?o=Math.min(s*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],a(e,e,i),r[c]=e[0],r[c+1]=e[1];return r}}();var te=f.create(),se=f.create(),ae=f.create(),Ce=f.create(),sr=[f.fromValues(1e-5,0,0),f.fromValues(0,1e-5,0),f.fromValues(0,0,1e-5),f.fromValues(-1e-5,0,0),f.fromValues(0,-1e-5,0),f.fromValues(0,0,-1e-5)],hn=V.create(),oi=4*Math.PI;function tr(e,r){return e.slice(r,r+3)}function pn(e,r){let n=0,t=e.length;for(let s=0;s<t;s+=9){f.sub(te,tr(e,s),r),f.sub(se,tr(e,s+3),r),f.sub(ae,tr(e,s+6),r);let a=f.length(te),i=f.length(se),c=f.length(ae);V.set(hn,te[0],se[0],ae[0],te[1],se[1],ae[1],te[2],se[2],ae[2]),n+=2*Math.atan2(V.determinant(hn),a*i*c+f.dot(te,se)*c+f.dot(se,ae)*a+f.dot(te,ae)*i)}return Math.round(n/oi)}function vn(e,r,n){if(f.copy(Ce,r),pn(e,Ce)!==0)return!0;if(n){for(let t of sr)if(f.add(Ce,r,t),pn(e,Ce)!==0)return!0}return!1}function ge(e){let r=new Float32Array(e.length*3*3),n=0;for(let t of e){let s=t.triangle;r.set(s.a,n),n+=3,r.set(s.b,n),n+=3,r.set(s.c,n),n+=3}return r}function li(e){let r=new Float32Array(e.length*3*3),n=0;for(let t of e)r.set(t.vertices[0].normal,n),n+=3,r.set(t.vertices[1].normal,n),n+=3,r.set(t.vertices[2].normal,n),n+=3;return r}function ar(e,r){let n=e.getPolygons(),t=ge(n);r.push(t.buffer);let s=li(n);return r.push(s.buffer),[t,s]}var M=f.create(),C=f.create(),fe=f.create();function fi(e,r,n={coplanar:!1,source:f.create(),target:f.create()}){let t=n,s=e.a,a=e.b,i=e.c,c=r.a,o=r.b,l=r.c;f.sub(M,c,l),f.sub(C,o,l);let h=f.cross(f.create(),M,C);f.sub(M,s,l);let p=f.dot(M,h);f.sub(M,a,l);let v=f.dot(M,h);f.sub(M,i,l);let x=f.dot(M,h);if(p*v>0&&p*x>0)return!1;f.sub(M,a,s),f.sub(C,i,s);let d=f.cross(f.create(),M,C);f.sub(M,c,i);let m=f.dot(M,d);f.sub(M,o,i);let y=f.dot(M,d);f.sub(M,l,i);let g=f.dot(M,d);return m*y>0&&m*g>0?!1:(t.N2=h,t.N1=d,p>0?v>0?W(i,s,a,c,l,o,m,g,y,t):x>0?W(a,i,s,c,l,o,m,g,y,t):W(s,a,i,c,o,l,m,y,g,t):p<0?v<0?W(i,s,a,c,o,l,m,y,g,t):x<0?W(a,i,s,c,o,l,m,y,g,t):W(s,a,i,c,l,o,m,g,y,t):v<0?x>=0?W(a,i,s,c,l,o,m,g,y,t):W(s,a,i,c,o,l,m,y,g,t):v>0?x>0?W(s,a,i,c,l,o,m,g,y,t):W(a,i,s,c,o,l,m,y,g,t):x>0?W(i,s,a,c,o,l,m,y,g,t):x<0?W(i,s,a,c,l,o,m,g,y,t):(t.coplanar=!0,yn(s,a,i,c,o,l,d)))}function W(e,r,n,t,s,a,i,c,o,l){return i>0?c>0?H(e,n,r,a,t,s,l):o>0?H(e,n,r,s,a,t,l):H(e,r,n,t,s,a,l):i<0?c<0?H(e,r,n,a,t,s,l):o<0?H(e,r,n,s,a,t,l):H(e,n,r,t,s,a,l):c<0?o>=0?H(e,n,r,s,a,t,l):H(e,r,n,t,s,a,l):c>0?o>0?H(e,n,r,t,s,a,l):H(e,r,n,s,a,t,l):o>0?H(e,r,n,a,t,s,l):o<0?H(e,n,r,a,t,s,l):(l.coplanar=!0,yn(e,r,n,t,s,a,l.N1))}function yn(e,r,n,t,s,a,i){let c=j.create(),o=j.create(),l=j.create(),h=j.create(),p=j.create(),v=j.create(),x=i[0]<0?-i[0]:i[0],d=i[1]<0?-i[1]:i[1],m=i[2]<0?-i[2]:i[2];return x>m&&x>=d?(c[0]=r[2],c[1]=r[1],o[0]=e[2],o[1]=e[1],l[0]=n[2],l[1]=n[1],h[0]=s[2],h[1]=s[1],p[0]=t[2],p[1]=t[1],v[0]=a[2],v[1]=a[1]):d>m&&d>=x?(c[0]=r[0],c[1]=r[2],o[0]=e[0],o[1]=e[2],l[0]=n[0],l[1]=n[2],h[0]=s[0],h[1]=s[2],p[0]=t[0],p[1]=t[2],v[0]=a[0],v[1]=a[2]):(c[0]=e[0],c[1]=e[1],o[0]=r[0],o[1]=r[1],l[0]=n[0],l[1]=n[1],h[0]=t[0],h[1]=t[1],p[0]=s[0],p[1]=s[1],v[0]=a[0],v[1]=a[1]),hi(c,o,l,h,p,v)}function hi(e,r,n,t,s,a){return I(e,r,n)<0?I(t,s,a)<0?Ie(e,n,r,t,a,s):Ie(e,n,r,t,s,a):I(t,s,a)<0?Ie(e,r,n,t,a,s):Ie(e,r,n,t,s,a)}function I(e,r,n){return(e[0]-n[0])*(r[1]-n[1])-(e[1]-n[1])*(r[0]-n[1])}function Ie(e,r,n,t,s,a){return I(t,s,e)>=0?I(s,a,e)>=0?I(a,t,e)>=0?!0:ir(e,r,n,t,a):I(a,t,e)>=0?ir(e,r,n,a,s):cr(e,r,n,t,s,a):I(s,a,e)>=0?I(a,t,e)>=0?ir(e,r,a,s,t):cr(e,r,n,s,a,t):cr(e,r,n,a,t,s)}function ir(e,r,n,t,s){if(I(s,t,r)>=0){if(I(e,t,r)>=0)return I(e,r,s)>=0;if(I(r,n,t)>=0)return I(n,e,t)>=0}else if(I(s,t,n)>=0&&I(e,t,n)>=0)return I(e,n,s)>=0||I(r,n,s)>=0;return!1}function cr(e,r,n,t,s,a){if(I(a,t,r)>=0){if(I(a,s,r)<=0){if(I(e,t,r)>0)return I(e,s,r)<=0;if(I(e,t,n)>=0)return I(r,n,t)>=0}else if(I(e,s,r)<=0&&I(a,s,n)<=0)return I(r,n,s)>=0}else if(I(a,t,n)>=0){if(I(r,n,a)>=0)return I(e,t,n)>=0;if(I(r,n,s)>=0)return I(a,n,s)>=0}return!1}function H(e,r,n,t,s,a,i){let c;f.sub(M,r,e),f.sub(C,a,e);let o=f.cross(f.create(),M,C);if(f.sub(fe,t,e),f.dot(fe,o)>0){if(f.sub(M,n,e),f.cross(o,M,C),f.dot(fe,o)<=0)return f.sub(C,s,e),f.cross(o,M,C),f.dot(fe,o)>0?(f.sub(M,e,t),f.sub(C,e,n),c=f.dot(M,i.N2)/f.dot(C,i.N2),f.scale(M,C,c),f.sub(i.source,e,M),f.sub(M,t,e),f.sub(C,t,a),c=f.dot(M,i.N1)/f.dot(C,i.N1),f.scale(M,C,c),f.sub(i.target,t,M)):(f.sub(M,t,e),f.sub(C,t,s),c=f.dot(M,i.N1)/f.dot(C,i.N1),f.scale(M,C,c),f.sub(i.source,t,M),f.sub(M,t,e),f.sub(C,t,a),c=f.dot(M,i.N1)/f.dot(C,i.N1),f.scale(M,C,c),f.sub(i.target,t,M)),!0}else if(f.sub(C,s,e),f.cross(o,M,C),f.dot(fe,o)>=0)return f.sub(M,n,e),f.cross(o,M,C),f.dot(fe,o)>=0?(f.sub(M,e,t),f.sub(C,e,n),c=f.dot(M,i.N2)/f.dot(C,i.N2),f.scale(M,C,c),f.sub(i.source,e,M),f.sub(M,e,t),f.sub(C,e,r),c=f.dot(M,i.N2)/f.dot(C,i.N2),f.scale(M,C,c),f.sub(i.target,e,M)):(f.sub(M,t,e),f.sub(C,t,s),c=f.dot(M,i.N1)/f.dot(C,i.N1),f.scale(M,C,c),f.sub(i.source,t,M),f.sub(M,e,t),f.sub(C,e,r),c=f.dot(M,i.N2)/f.dot(C,i.N2),f.scale(M,C,c),f.sub(i.target,e,M)),!0;return!1}function pi(e,r,n){let t=f.sub(f.create(),e.end,e.start),s=f.sub(f.create(),r.end,r.start),a=f.sub(f.create(),e.start,r.start),i=f.dot(a,t),c=f.dot(a,s),o=f.dot(t,s),l=f.dot(t,t),h=f.dot(s,s),p=l*h-o*o,x=(c*o-i*h)/p,d=(c+x*o)/h,m=f.scaleAndAdd(t,e.start,t,x),y=f.scaleAndAdd(s,r.start,s,d),g=!1,w=!1;return 0<=x&&x<=1&&0<=d&&d<=1&&(g=!0),f.distance(m,y)<=1e-5&&(w=!0),w&&g?(n&&n.push(m,y),!0):!1}function xn(e){return[{start:e.a,end:e.b},{start:e.b,end:e.c},{start:e.c,end:e.a}]}function dn(e,r,n={coplanar:!1,source:f.create(),target:f.create()}){let t=fi(e,r,n);if(!t&&n.coplanar){let s=xn(e),a=xn(r);for(let i=0;i<3;i++)for(let c=0;c<3;c++)if(pi(s[i],a[c]))return!0;return!1}return t}var he=class{constructor(r,n,t){this.a=r;this.b=n;this.c=t}static copyAuxValues(r,n){r._midpoint&&(n._midpoint?f.copy(n._midpoint,r._midpoint):n._midpoint=f.clone(r._midpoint)),r._hash&&(n._hash=r._hash)}set(r,n,t){this.a=r,this.b=n,this.c=t,this._midpoint=void 0,this._hash=void 0}get midpoint(){return this._midpoint?this._midpoint:(this._midpoint=f.clone(this.a),f.add(this._midpoint,this._midpoint,this.b),f.add(this._midpoint,this._midpoint,this.c),f.scale(this._midpoint,this._midpoint,Sr))}equals(r){return f.equals(this.a,r.a)&&f.equals(this.b,r.b)&&f.equals(this.c,r.c)}murmur_32_scramble(r){return r*=3432918353,r=r<<15|r>>17,r*=461845907,r&4294967295}murmur3_32(r,n){let t=n,s=new Uint32Array(r.buffer);for(let a of s)t^=this.murmur_32_scramble(a),t=t<<13&4294967295|t>>19,t=t*5+3864292196&4294967295;return t^=s.byteLength,t^=t>>16,t=t*2246822507&4294967295,t^=t>>13,t=t*3266489909&4294967295,t^=t>>16,t}get hash(){if(this._hash!==void 0)return this._hash;let r=new Float32Array([this.a[0]*1e5,this.a[1]*1e5,this.a[2]*1e5,this.b[0]*1e5,this.b[1]*1e5,this.b[2]*1e5,this.c[0]*1e5,this.c[1]*1e5,this.c[2]*1e5]);return this._hash=this.murmur3_32(r,3935228948),this._hash}};var q=f.create(),or=f.create(),Vi=f.create(),Ee=V.create(),Di=de.create(),Bi=de.create(),Ui=j.create(),ji=j.create(),Wi=Re.create();var D=class{constructor(r){this.buffer=r}static fromNormal(r,n){let t=ne.create();return f.copy(t,r),t[3]=n,new D(t)}get w(){return this.buffer[3]}set w(r){this.buffer[3]=r}get unsafeNormal(){return this.buffer}clone(){return new D(ne.clone(this.buffer))}flip(){f.negate(this.buffer,this.buffer),this.w=-this.w}delete(){this.buffer=void 0}equals(r){return ne.equals(this.buffer,r.buffer)}static calculateNormal(r,n,t){return f.sub(q,n,r),f.sub(or,t,r),f.cross(q,q,or),f.normalize(q,q),f.clone(q)}static fromPoints(r,n,t){let s=D.calculateNormal(r,n,t);return D.fromNormal(s,f.dot(s,r))}};var vi=0;var Z=class{constructor(r,n){this.intersects=!1;this.state=0;this.previousState=0;this.previousStates=[];this.valid=!0;this.coplanar=!1;this.originalValid=!1;this.newPolygon=!1;this.id=vi++,this.vertices=r.map(t=>t.clone()),this.shared=n,this.plane=D.fromPoints(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos),this.triangle=new he(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos)}get midpoint(){return this.triangle.midpoint}applyMatrix(r,n){let t=n||V.normalFromMat4(Ee,r);this.vertices.forEach(s=>{f.transformMat4(s.pos,s.pos,r),f.transformMat3(s.normal,s.normal,t)}),this.plane.delete(),this.plane=D.fromPoints(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos),this.triangle.set(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos)}reset(r=!0){this.intersects=!1,this.state=0,this.previousState=0,this.previousStates.length=0,this.valid=!0,this.coplanar=!1,r&&(this.originalValid=!1),this.newPolygon=!1}setState(r,n){this.state!==n&&(this.previousState=this.state,this.state!==0&&this.previousStates.push(this.state),this.state=r)}checkAllStates(r){if(this.state!==r||this.previousState!==r&&this.previousState!==0)return!1;for(let n of this.previousStates)if(n!==r)return!1;return!0}setInvalid(){this.valid=!1}setValid(){this.valid=!0}clone(){let r=new Z(this.vertices.map(n=>n.clone()),this.shared);return r.intersects=this.intersects,r.valid=this.valid,r.coplanar=this.coplanar,r.state=this.state,r.originalValid=this.originalValid,r.newPolygon=this.newPolygon,r.previousState=this.previousState,r.previousStates=this.previousStates.slice(),he.copyAuxValues(this.triangle,r.triangle),r}flip(){this.vertices.reverse().forEach(n=>n.flip());let r=this.triangle.a;this.triangle.a=this.triangle.c,this.triangle.c=r,this.plane.flip()}delete(){this.vertices.forEach(r=>r.delete()),this.vertices.length=0,this.plane&&(this.plane.delete(),this.plane=void 0),this.triangle=void 0,this.shared=void 0,this.setInvalid()}};var B=(a=>(a[a.Undecided=0]="Undecided",a[a.Back=void 0]="Back",a[a.Front=void 0]="Front",a[a.CoplanarBack=3]="CoplanarBack",a[a.CoplanarFront=4]="CoplanarFront",a))(B||{}),mn=0,lr=1,Ne=2,gn=3;function Pn(e,r,n=[]){let t={polygon:e,type:B.Undecided},s=0,a=[];for(let i of e.vertices){let c=f.dot(r.unsafeNormal,i.pos)-r.w,o=c<-1e-5?Ne:c>1e-5?lr:mn;s|=o,a.push(o)}switch(s){case mn:t.type=f.dot(r.unsafeNormal,e.plane.unsafeNormal)>0?B.CoplanarFront:B.CoplanarBack,n.push(t);break;case lr:t.type=B.Front,n.push(t);break;case Ne:t.type=B.Back,n.push(t);break;case gn:{let i=[],c=[],o=e.vertices.length;for(let l=0;l<o;l++){let h=(l+1)%o,p=a[l],v=a[h],x=e.vertices[l],d=e.vertices[h];if(p!==Ne&&i.push(x),p!==lr&&c.push(p!=Ne?x.clone():x),(p|v)===gn){f.sub(q,d.pos,x.pos);let m=(r.w-f.dot(r.unsafeNormal,x.pos))/f.dot(r.unsafeNormal,q),y=x.interpolate(d,m);i.push(y),c.push(y.clone())}}if(i.length>3)for(let l of Mn(i))n.push({polygon:new Z(l,e.shared),type:B.Front});else i.length===3&&n.push({polygon:new Z(i,e.shared),type:B.Front});if(c.length>3)for(let l of Mn(c))n.push({polygon:new Z(l,e.shared),type:B.Back});else c.length===3&&n.push({polygon:new Z(c,e.shared),type:B.Back});break}}return n.length==0&&n.push(t),n}function Mn(e){let r=[];if(e.length>4){console.warn(`[splitPolygonArr] arr.length (${e.length}) > 4`);for(let n=3;n<=e.length;n++)r.push([e[0].clone(),e[n-2].clone(),e[n-1].clone()])}else f.squaredDistance(e[0].pos,e[2].pos)<=f.squaredDistance(e[1].pos,e[3].pos)?r.push([e[0].clone(),e[1].clone(),e[2].clone()],[e[0].clone(),e[2].clone(),e[3].clone()]):r.push([e[0].clone(),e[1].clone(),e[3].clone()],[e[1].clone(),e[2].clone(),e[3].clone()]);return r}var fr=f.create(),hr=f.create(),pr=f.create(),vr=f.create(),xr=f.create(),yr=1e-7;function dr(e,r,n=f.create()){f.sub(fr,r.b,r.a),f.sub(hr,r.c,r.a),f.cross(pr,e.direction,hr);let t=f.dot(fr,pr);if(t>-yr&&t<yr)return null;f.sub(vr,e.origin,r.a);let s=1/t,a=s*f.dot(vr,pr);if(a<0||a>1)return null;f.cross(xr,vr,fr);let i=s*f.dot(e.direction,xr);if(i<0||a+i>1)return null;let c=s*f.dot(hr,xr);return c>yr?f.scaleAndAdd(n,e.origin,e.direction,c):null}function mr(e,r=15){return e[0]=+e[0].toFixed(r),e[1]=+e[1].toFixed(r),e[2]=+e[2].toFixed(r),e}var U=f.create(),Q=f.create(),gr=f.create(),Te=f.fromValues(1,0,0),ze=f.fromValues(0,1,0),Ge=f.fromValues(0,0,1),xi=f.create(),yi=f.create(),di=f.create(),mi=f.create(),gi=f.create(),Mi=f.create(),bi=f.create(),Pi=f.create(),ke=f.create(),_e=f.create(),Le=f.create(),ee=class{constructor(r=f.create(),n=f.create()){this.min=r;this.max=n}clone(){return new ee(f.clone(this.min),f.clone(this.max))}expandByPoint(r){f.min(this.min,this.min,r),f.max(this.max,this.max,r)}expandByScalar(r){f.set(U,r,r,r),f.sub(this.min,this.min,U),f.add(this.max,this.max,U)}_project(r,n){let t=r.length,s=f.dot(r[0],n),a=s;for(let i=1;i<t;i++){let c=f.dot(r[i],n);s=Math.min(s,c),a=Math.max(a,c)}return[s,a]}_testNormal(r,n,t,s){let[a,i]=this._project(s,t);return i<r||a>n}_testECP(r,n,t,s){let a=f.cross(U,r,n),[i,c]=this._project(s,a),[o,l]=this._project(t,a);return c<o||i>l}intersectsTriangle(r){let n=[r.a,r.b,r.c];if(this._testNormal(this.min[0],this.max[0],Te,n)||this._testNormal(this.min[1],this.max[1],ze,n)||this._testNormal(this.min[2],this.max[2],Ge,n))return!1;let t=D.calculateNormal(r.a,r.b,r.c),s=f.dot(t,r.a),a=[f.set(xi,this.min[0],this.max[1],this.min[2]),f.set(yi,this.max[0],this.max[1],this.min[2]),f.set(di,this.min[0],this.max[1],this.max[2]),f.set(mi,this.max[0],this.max[1],this.max[2]),f.set(gi,this.min[0],this.min[1],this.min[2]),f.set(Mi,this.max[0],this.min[1],this.min[2]),f.set(bi,this.min[0],this.min[1],this.max[2]),f.set(Pi,this.max[0],this.min[1],this.max[2])],[i,c]=this._project(a,t);return c<s||i>s?!1:(f.sub(ke,r.a,r.b),f.sub(_e,r.b,r.c),f.sub(Le,r.c,r.a),!(this._testECP(ke,Te,n,a)||this._testECP(ke,ze,n,a)||this._testECP(ke,Ge,n,a)||this._testECP(_e,Te,n,a)||this._testECP(_e,ze,n,a)||this._testECP(_e,Ge,n,a)||this._testECP(Le,Te,n,a)||this._testECP(Le,ze,n,a)||this._testECP(Le,Ge,n,a)))}intersectsBox(r){return!(this.min[0]>r.max[0]||this.max[0]<r.min[0]||this.min[1]>r.max[1]||this.max[1]<r.min[1]||this.min[2]>r.max[2]||this.max[2]<r.min[2])}intersectsRay(r){f.inverse(gr,r.direction),f.sub(U,this.min,r.origin),f.mul(U,U,gr),f.sub(Q,this.max,r.origin),f.mul(Q,Q,gr);let n=Math.max(U[0],Q[0],U[1],Q[1],U[2],Q[2]);return n<0?!1:Math.min(U[0],Q[0],U[1],Q[1],U[2],Q[2])<=n}containsPoint(r){return r[0]>=this.min[0]&&r[0]<=this.max[0]&&r[1]>=this.min[1]&&r[1]<=this.max[1]&&r[2]>=this.min[2]&&r[2]<=this.max[2]}makeEmpty(){f.set(this.min,0,0,0),f.set(this.max,0,0,0)}};var Me=class{constructor(){this.origin=f.create();this.direction=f.fromValues(0,0,-1)}};var re=class extends Error{constructor(n,t){let s;switch(n){case 0:s="Job failed (worker creation failed)";break;case 1:s="Job failed (operation exception)";break;default:s="Job failed (decode failure)"}super(`${s}: ${t}`);this.failReason=n;this.originalError=t}static WorkerCreationFailure(n){return new re(0,""+n)}static OperationFailure(n){return new re(1,""+n)}static DecodeFailure(n){return new re(2,""+n)}};var ie=class{constructor(){this.buckets=new Map}isUnique(r){let n=r.hash,t=this.buckets.get(n);if(t){for(let s of t)if(r.equals(s))return!1;t.push(r)}else t=[r];return!0}clear(){this.buckets.clear()}};var ce={union:{a:[{array:!0,rule:[1,3]},{array:!1,rule:1}],b:[{array:!0,rule:[1,3]},{array:!0,rule:[1,4]},{array:!1,rule:1}]},subtract:{a:[{array:!0,rule:[1,3]},{array:!0,rule:[1,4]},{array:!1,rule:1}],b:[{array:!0,rule:[2,3]},{array:!0,rule:[2,4]},{array:!0,rule:[1,4]},{array:!1,rule:2}]},intersect:{a:[{array:!0,rule:[1,3]},{array:!0,rule:[2,4]},{array:!0,rule:[2,3]},{array:!1,rule:2}],b:[{array:!0,rule:[1,4]},{array:!0,rule:[1,3]},{array:!0,rule:[2,4]},{array:!0,rule:[2,3]},{array:!1,rule:2}]}};var un=f.create(),Fe=f.create(),On=f.create(),pe=new Me,Ye=f.fromValues(0,0,1);let r;var R=class{constructor(n,t=null){this.polygons=[],this.replacedPolygons=[],this.box=n,this.subTrees=[],this.parent=t,this.level=0,this.polygonArrays=[],this.addPolygonsArrayToRoot(this.polygons)}clone(){return new R().copy(this)}copy(n){var t;this.deletePolygonsArrayFromRoot(this.polygons),this.polygons=n.polygons.map(s=>s.clone()),this.addPolygonsArrayToRoot(this.polygons),this.replacedPolygons=n.replacedPolygons.map(s=>s.clone()),this.box=(t=n.box)==null?void 0:t.clone(),this.level=n.level;for(let s of n.subTrees)this.subTrees.push(new R(void 0,this).copy(s));return this}addPolygonsArrayToRoot(n){this.parent?this.parent.addPolygonsArrayToRoot(n):this.polygonArrays.push(n)}deletePolygonsArrayFromRoot(n){if(this.parent)this.parent.deletePolygonsArrayFromRoot(n);else{let t=this.polygonArrays.indexOf(n);t>-1&&this.polygonArrays.splice(t,1)}}isEmpty(){return this.polygons.length===0}addPolygon(n,t){let s=n.triangle;return t&&!t.isUnique(s)?this:(this.box?(this.box.min[0]=Math.min(this.box.min[0],s.a[0],s.b[0],s.c[0]),this.box.min[1]=Math.min(this.box.min[1],s.a[1],s.b[1],s.c[1]),this.box.min[2]=Math.min(this.box.min[2],s.a[2],s.b[2],s.c[2]),this.box.max[0]=Math.max(this.box.max[0],s.a[0],s.b[0],s.c[0]),this.box.max[1]=Math.max(this.box.max[1],s.a[1],s.b[1],s.c[1]),this.box.max[2]=Math.max(this.box.max[2],s.a[2],s.b[2],s.c[2])):(this.box=new ee,this.box.min[0]=Math.min(s.a[0],s.b[0],s.c[0]),this.box.min[1]=Math.min(s.a[1],s.b[1],s.c[1]),this.box.min[2]=Math.min(s.a[2],s.b[2],s.c[2]),this.box.max[0]=Math.max(s.a[0],s.b[0],s.c[0]),this.box.max[1]=Math.max(s.a[1],s.b[1],s.c[1]),this.box.max[2]=Math.max(s.a[2],s.b[2],s.c[2])),this.polygons.push(n),this)}split(n){if(!this.box)throw new Error("Octree has no box");let t=[];f.sub(Fe,this.box.max,this.box.min);let s=f.scale(Fe,Fe,.5);for(let i=0;i<2;i++)for(let c=0;c<2;c++)for(let o=0;o<2;o++){let l=new ee,h=f.set(un,i,c,o);f.multiply(On,h,s),f.add(l.min,this.box.min,On),f.add(l.max,l.min,s),l.expandByScalar(1e-5),t.push(new R(l,this))}let a;for(;a=this.polygons.pop();){let i=!1;for(let c=0;c<t.length;c++){let o=t[c],l=o.box;if(!l)throw new Error("Subtree has no box");l.containsPoint(a.midpoint)&&(o.polygons.push(a),i=!0)}if(!i)throw console.error("ERROR: unable to find subtree for:",a.triangle),new Error(`Unable to find subtree for triangle at level ${n}`)}for(let i of t)i.level=n+1,i.polygons.length>R.polygonsPerTree&&n<R.maxLevel&&i.split(n+1),this.subTrees.push(i);return this}buildTree(){return this.split(0),this.processTree(),this}processTree(){if(!this.isEmpty()){this.box||(this.box=new ee);let t=this.polygons[0].triangle.a;f.copy(this.box.min,t),f.copy(this.box.max,t);for(let s of this.polygons)this.box.expandByPoint(s.triangle.a),this.box.expandByPoint(s.triangle.b),this.box.expandByPoint(s.triangle.c);this.expandParentBox()}for(let n of this.subTrees)n.processTree()}expandParentBox(){if(this.parent){if(!this.box)throw new Error("Octree has no box");if(!this.parent.box)throw new Error("Octree's parent has no box");this.parent.box.expandByPoint(this.box.min),this.parent.box.expandByPoint(this.box.max),this.parent.expandParentBox()}}getPolygonsIntersectingPolygon(n,t=[]){if(!this.box)throw new Error("Octree has no box");this.polygons.length>0&&this.box.intersectsTriangle(n.triangle)&&(wn(n,t,this.polygons),wn(n,t,this.replacedPolygons));for(let s of this.subTrees)s.getPolygonsIntersectingPolygon(n,t);return t}getRayPolygons(n,t){if(t)for(let s of this.replacedPolygons)t.add(s);else t=new Set(this.replacedPolygons);for(let s of this.polygons)s.valid&&s.originalValid&&t.add(s);for(let s of this.subTrees)s.box.intersectsRay(n)&&s.getRayPolygons(n,t);return t}rayIntersect(n,t=[]){if(f.squaredLength(n.direction)===0)return[];let s=1e100;for(let a of this.getRayPolygons(n)){let i=dr(n,a.triangle,un);if(i){let c=f.distance(i,n.origin);s>c&&(s=c),s<1e100&&t.push({distance:s,polygon:a,position:f.add(f.create(),i,n.origin)})}}return t.length&&t.sort(ui),t}getIntersectingPolygons(n=[]){for(let t of this.polygonArrays)for(let s of t)s.valid&&s.intersects&&n.push(s);return n}getPolygons(n=[]){for(let t of this.polygonArrays)for(let s of t)s.valid&&n.indexOf(s)===-1&&n.push(s);return n}invert(){for(let n of this.polygonArrays)for(let t of n)t.valid&&t.flip()}replacePolygon(n,t){if(Array.isArray(t)||(t=[t]),this.polygons.length>0){let s=this.polygons.indexOf(n);s>-1&&(n.originalValid?this.replacedPolygons.push(n):n.setInvalid(),this.polygons.splice(s,1,...t))}for(let s of this.subTrees)s.replacePolygon(n,t)}deletePolygonsByStateRules(n,t=!0){for(let s of this.polygonArrays)if(s.length!==0)for(let a of s.slice()){if(!a.valid||!a.intersects)continue;let i=!1;for(let c of n)if(c.array){let o=c.rule;if(o.includes(a.state)&&(a.previousState!==0&&o.includes(a.previousState)||a.previousState===0)){i=!0;let l=new Set;for(let h of o)l.add(h);l.delete(a.state);for(let h of a.previousStates)if(o.includes(h))l.delete(h);else{i=!1;break}if(i)if(l.size>0)i=!1;else break}}else if(a.checkAllStates(c.rule)){i=!0;break}if(i){let c=s.indexOf(a);c>-1&&(a.setInvalid(),s.splice(c,1)),t&&a.delete()}}}deletePolygonsByIntersection(n,t=!0){for(let s of this.polygonArrays)if(s.length!==0){for(let a of s.slice())if(a.valid&&a.intersects===n){let i=s.indexOf(a);i>-1&&(a.setInvalid(),s.splice(i,1)),t&&a.delete()}}}isPolygonIntersecting(n){if(!this.box)throw new Error("Octree has no box");return this.box.intersectsTriangle(n.triangle)}markIntersectingPolygons(n){for(let t of this.polygonArrays)for(let s of t)s.intersects=n.isPolygonIntersecting(s)}resetPolygons(n=!0){for(let t of this.polygonArrays)for(let s of t)s.reset(n)}handleIntersectingPolygons(n,t){if(R.useWindingNumber&&!t)throw new Error("targetOctreeBuffer must be set if using winding number");if(this.polygons.length>0){let s=this.polygons.filter(c=>c.valid&&c.intersects&&c.state===0),a;for(;a=s.pop();){if(a.state!==0||!a.valid)continue;let c=n.getPolygonsIntersectingPolygon(a);for(let o of c){let l=Pn(a,o.plane);if(l.length>1){for(let h of l){let p=h.polygon;p.intersects=a.intersects,p.newPolygon=!0,s.push(p)}this.replacePolygon(a,l.map(h=>h.polygon));break}else{let h=l[0];if(a.id!==h.polygon.id){h.polygon.intersects=a.intersects,h.polygon.newPolygon=!0,s.push(h.polygon),this.replacePolygon(a,h.polygon);break}else(h.type===B.CoplanarFront||h.type===B.CoplanarBack)&&(a.setState(h.type),a.coplanar=!0)}}}s=this.polygons.filter(c=>c.valid&&c.intersects);let i=!1;for(;a=s.pop();)if(!!a.valid){if(!n.box)throw new Error("Octree has no box");if(i=!1,n.box.containsPoint(a.midpoint))if(R.useWindingNumber)i=vn(t,a.midpoint,a.coplanar);else{let c=mr(f.copy(Fe,a.midpoint));f.copy(pe.origin,c),f.copy(Ye,a.plane.unsafeNormal),f.copy(pe.direction,a.plane.unsafeNormal);let o=n.rayIntersect(pe);if(o.length>0&&f.dot(Ye,o[0].polygon.plane.unsafeNormal)>0)i=!0;else if(a.coplanar){for(let l of sr)if(f.add(pe.origin,c,l),f.copy(Ye,a.plane.unsafeNormal),f.copy(pe.direction,a.plane.unsafeNormal),o=n.rayIntersect(pe),o.length>0&&f.dot(Ye,o[0].polygon.plane.unsafeNormal)>0){i=!0;break}}}a.setState(i?1:2)}}for(let s of this.subTrees)s.handleIntersectingPolygons(n,t)}delete(n=!0){if(this.polygons.length>0&&n){for(let t of this.polygons)t.delete();this.polygons.length=0}if(this.replacedPolygons.length>0&&n){for(let t of this.replacedPolygons)t.delete();this.replacedPolygons.length=0}if(this.polygonArrays&&(this.polygonArrays.length=0),this.subTrees.length){for(let t of this.subTrees)t.delete(n);this.subTrees.length=0}this.box=void 0,this.parent=null,this.level=0}dispose(n=!0){this.delete(n)}getPolygonCloneCallback(n,t){for(let s of this.polygonArrays)for(let a of s)a.valid&&n(a.clone(),t)}deleteReplacedPolygons(){if(this.replacedPolygons.length>0){for(let n of this.replacedPolygons)n.delete();this.replacedPolygons.length=0}for(let n of this.subTrees)n.deleteReplacedPolygons()}markPolygonsAsOriginal(){for(let n of this.polygonArrays)for(let t of n)t.originalValid=!0}applyMatrix(n,t,s=!0){this.box&&(this.box=void 0),t||(t=V.normalFromMat4(Ee,n));for(let a of this.polygons)a.valid&&a.applyMatrix(n,t);for(let a of this.subTrees)a.applyMatrix(n,t,!1);s&&this.processTree()}setPolygonIndex(n){if(n!==void 0)for(let t of this.polygonArrays)for(let s of t)s.shared=n}getTriangles(n=[]){for(let t of this.getPolygons())n.push(t.triangle);return n}getRayTriangles(n,t=[]){for(let s of this.getRayPolygons(n))t.push(s.triangle);return t}static union(n,t,s=!0){n.box||n.buildTree(),t.box||t.buildTree();let a=new R,i=new ie;return n.box.intersectsBox(t.box)&&(n.resetPolygons(!1),t.resetPolygons(!1),n.markIntersectingPolygons(t),t.markIntersectingPolygons(n),R.handleIntersectingOctrees(n,t),n.deleteReplacedPolygons(),t.deleteReplacedPolygons(),n.deletePolygonsByStateRules(ce.union.a),t.deletePolygonsByStateRules(ce.union.b)),n.getPolygonCloneCallback(a.addPolygon.bind(a),i),t.getPolygonCloneCallback(a.addPolygon.bind(a),i),i.clear(),a.markPolygonsAsOriginal(),s&&a.buildTree(),a}static subtract(n,t,s=!0){n.box||n.buildTree(),t.box||t.buildTree();let a=new R,i=new ie;return n.box.intersectsBox(t.box)?(n.resetPolygons(!1),t.resetPolygons(!1),n.markIntersectingPolygons(t),t.markIntersectingPolygons(n),R.handleIntersectingOctrees(n,t),n.deleteReplacedPolygons(),t.deleteReplacedPolygons(),n.deletePolygonsByStateRules(ce.subtract.a),t.deletePolygonsByStateRules(ce.subtract.b),t.deletePolygonsByIntersection(!1),t.invert(),n.getPolygonCloneCallback(a.addPolygon.bind(a),i),t.getPolygonCloneCallback(a.addPolygon.bind(a),i)):n.getPolygonCloneCallback(a.addPolygon.bind(a),i),i.clear(),a.markPolygonsAsOriginal(),s&&a.buildTree(),a}static intersect(n,t,s=!0){n.box||n.buildTree(),t.box||t.buildTree();let a=new R,i=new ie;return n.box.intersectsBox(t.box)&&(n.resetPolygons(!1),t.resetPolygons(!1),n.markIntersectingPolygons(t),t.markIntersectingPolygons(n),R.handleIntersectingOctrees(n,t),n.deleteReplacedPolygons(),t.deleteReplacedPolygons(),n.deletePolygonsByStateRules(ce.intersect.a),t.deletePolygonsByStateRules(ce.intersect.b),n.deletePolygonsByIntersection(!1),t.deletePolygonsByIntersection(!1),n.getPolygonCloneCallback(a.addPolygon.bind(a),i),t.getPolygonCloneCallback(a.addPolygon.bind(a),i)),i.clear(),a.markPolygonsAsOriginal(),s&&a.buildTree(),a}static unionArray(n,t=1/0){return An(R.union,n,t)}static subtractArray(n,t=1/0){let s=n.length;if(s===0)throw new Error("Unable to find any result octree");return s===1?n[0]:s===2?R.subtract(n[0],n[1]):R.subtract(n[0],R.unionArray(n.slice(1),t))}static intersectArray(n,t=1/0){return An(R.intersect,n,t)}static operation(n,t=!0){let s;switch(n.op){case"union":case"subtract":case"intersect":{let a=Ve(n.objA,t),i=Ve(n.objB,t);switch(n.op){case"union":s=R.union(a,i,t);break;case"subtract":s=R.subtract(a,i,t);break;default:s=R.intersect(a,i,t)}ve(a,i);break}case"unionArray":case"subtractArray":case"intersectArray":{let a=new Array;for(let i of n.objs)a.push(Ve(i,t));switch(n.op){case"unionArray":s=R.unionArray(a);break;case"subtractArray":s=R.subtractArray(a);break;default:s=R.intersectArray(a)}ve(...a);break}default:throw new Error(`Unknown operation: ${n.op}`)}return s}static handleIntersectingOctrees(n,t,s=!0,a,i){R.useWindingNumber&&(s&&!a&&(a=ge(n.getPolygons())),i||(i=ge(t.getPolygons()))),n.handleIntersectingPolygons(t,i),s&&t.handleIntersectingPolygons(n,a),a!==void 0&&(a=void 0,i=void 0)}},F=R;F.disposeOctree=!0,F.useWindingNumber=!1,F.maxLevel=16,F.polygonsPerTree=100,F.async={batchSize:100,union(n,t,s=!0){return be(this,null,function*(){return Mr("union",R.union,n,t,s)})},subtract(n,t,s=!0){return Mr("subtract",R.subtract,n,t,s)},intersect(n,t,s=!0){return Mr("intersect",R.intersect,n,t,s)},unionArray(n,t=1/0){return Rn(R.async.union,R.async.unionArray,n,t)},subtractArray(n,t=1/0){return be(this,null,function*(){let s=n.length;if(s===0)throw new Error("Unable to find any result octree");return s===1?n[0]:s===2?yield R.async.subtract(n[0],n[1]):yield R.async.subtract(n[0],yield R.async.unionArray(n.slice(1),t))})},intersectArray(n,t=1/0){return Rn(R.async.intersect,R.async.intersectArray,n,t)},operation(n,t=!0){return new Promise((s,a)=>{try{switch(n.op){case"union":case"subtract":case"intersect":{let i,c,o=[];n.objA&&o.push(Sn(n.objA,t,0)),n.objB&&o.push(Sn(n.objB,t,1)),Promise.allSettled(o).then(l=>{for(let p of l)if(p.status==="fulfilled"){let[v,x]=p.value;x===0?i=v:x===1&&(c=v)}let h;switch(n.op){case"union":h=R.async.union(i,c,t);break;case"subtract":h=R.async.subtract(i,c,t);break;default:h=R.async.intersect(i,c,t)}h.then(p=>{s(p),ve(i,c)}).catch(p=>a(p))});break}case"unionArray":case"subtractArray":case"intersectArray":{let i=new Array;for(let o of n.objs)i.push(Ve(o,t));let c;switch(n.op){case"unionArray":c=R.async.unionArray(i);break;case"subtractArray":c=R.async.subtractArray(i);break;default:c=R.async.intersectArray(i)}ve(...i),c.then(o=>s(o));break}default:throw new Error(`Unknown operation: ${n.op}`)}}catch(i){a(i)}})}};function ui(e,r){return e.distance-r.distance}function Ve(e,r){if(e instanceof F)return e;if(e.op)return F.operation(e,r);throw new Error("Invalid OctreeCSG operation object")}function Sn(e,r,n){return new Promise((t,s)=>{try{if(e instanceof F)t([e,n]);else if(e.op)F.async.operation(e,r).then(a=>{t([a,n])});else throw new Error("Invalid OctreeCSG operation object")}catch(a){s(a)}})}function ve(...e){if(F.disposeOctree)for(let r of e)r.delete()}function wn(e,r,n){for(let t of n)t.originalValid&&t.valid&&t.intersects&&dn(e.triangle,t.triangle)&&r.push(t)}function An(e,r,n){let t=new Array,s=r.length;for(let a=0;a<s;a++){let i=r[a];i.setPolygonIndex(a>n?n:a),t.push(i)}for(;t.length>1;){let a=t.length,i=new Array,c=0;for(;c+1<a;c+=2){let o=t[c],l=t[c+1],h=e(o,l);ve(o,l),i.push(h)}c<a&&i.push(t[c]),t=i}if(t.length===0)throw new Error("Unable to find any result octree");return t[0]}function Mr(e,r,n,t,s=!0){return be(this,null,function*(){if(globalThis.globalOctreeCSGJobDispatcher)try{return yield globalThis.globalOctreeCSGJobDispatcher.dispatch({op:e,objA:n,objB:t})}catch(i){let c=!0;if(i instanceof re&&i.failReason===0&&(console.warn("Queued job failed due to worker creation failure. Retrying synchronously"),c=!1),c)throw i}let a=r(n,t,s);return ve(n,t),a})}function Rn(e,r,n,t){return new Promise((s,a)=>{try{let i=F.async.batchSize>4&&F.async.batchSize<n.length,c,o=!1,l=[];if(i){let h=[],p=0;for(;p<n.length;)h.push(n.slice(p,p+F.async.batchSize)),p+=F.async.batchSize;let v;for(;v=h.shift();)l.push(r(v,0));o=!0,n.length=0}else{let h=[],p=n.length;for(let d=0;d<p;d++){let m=n[d];t>-1&&m.setPolygonIndex(d>t?t:d),h.push(m)}c=h.shift();let v,x=h.length;for(let d=0;d<x;d+=2){if(d+1>=x){v=h[d];break}l.push(e(h[d],h[d+1]))}v&&(l.push(e(c,v)),o=!0)}Promise.allSettled(l).then(h=>{let p=new Array;for(let v of h)v.status==="fulfilled"&&p.push(v.value);o||p.unshift(c),p.length<=0?a("Unable to find any result octree"):p.length===1?s(p[0]):p.length>3?r(p,i?0:-1).then(v=>{s(v)}).catch(v=>a(v)):e(p[0],p[1]).then(v=>{p.length===3?e(v,p[2]).then(x=>{s(x)}).catch(x=>a(x)):s(v)}).catch(v=>a(v))})}catch(i){a(i)}})}var X=class{constructor(r,n){this.pos=r;this.normal=n}clone(){return new X(f.clone(this.pos),f.clone(this.normal))}flip(){f.negate(this.normal,this.normal)}delete(){this.pos=void 0,this.normal=void 0}interpolate(r,n){return new X(f.lerp(f.create(),this.pos,r.pos,n),f.lerp(f.create(),this.normal,r.normal,n))}};function br(e,r){let n=e.length;if(n%9!==0)throw new Error("Vertex buffer length is not a multiple of 9");if(r.length%9!==0)throw new Error("Normal buffer length is not a multiple of 9");let t=new F;for(let s=0;s<n;){let a=new X(e.slice(s,s+3),r.slice(s,s+3));s+=3;let i=new X(e.slice(s,s+3),r.slice(s,s+3));s+=3;let c=new X(e.slice(s,s+3),r.slice(s,s+3));s+=3;let o=new Z([a,i,c]);o.originalValid=!0,t.addPolygon(o)}return t}function Cn(e){switch(e.op){case"union":case"subtract":case"intersect":return{op:e.op,objA:Pr(e.objA),objB:Pr(e.objB)};case"unionArray":case"subtractArray":case"intersectArray":{let r=new Array;for(let n of e.objs)r.push(Pr(n));return{op:e.op,objs:r}}default:throw new Error(`Unknown operation: ${e.op}`)}}function Pr(e){return Array.isArray(e)?br(...e):Cn(e)}globalThis.onmessage=function(e){switch(e.data.type){case"operation":{try{let r=F.operation(Cn(e.data.operation),!1),n=new Array,[t,s]=ar(r,n);postMessage({success:!0,jobIndex:e.data.jobIndex,vertices:t,normals:s})}catch(r){postMessage({success:!1,jobIndex:e.data.jobIndex,error:r})}break}default:console.error(`Unknown worker request type: ${e.data.type}`)}};postMessage("initialized");})();
//# sourceMappingURL=OctreeCSG-ea.worker.min.js.map
