"use strict";(()=>{var Ut=Object.defineProperty;var kr=Math.pow;var pe=(e,r)=>{for(var t in r)Ut(e,t,{get:r[t],enumerable:!0})};var Ke=(e,r,t)=>new Promise((n,s)=>{var a=o=>{try{c(t.next(o))}catch(l){s(l)}},i=o=>{try{c(t.throw(o))}catch(l){s(l)}},c=o=>o.done?n(o.value):Promise.resolve(o.value).then(a,i);c((t=t.apply(e,r)).next())});var Vr=.3333333333333333,Bi=Math.PI*2,Ui=Math.PI/2;var w=1e-6,T=typeof Float32Array<"u"?Float32Array:Array,Y=Math.random;var ji=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});var $={};pe($,{add:()=>xn,adjoint:()=>Kt,clone:()=>jt,copy:()=>Wt,create:()=>Qe,determinant:()=>Qt,equals:()=>dn,exactEquals:()=>mn,frob:()=>pn,fromMat2d:()=>cn,fromMat4:()=>$t,fromQuat:()=>on,fromRotation:()=>sn,fromScaling:()=>an,fromTranslation:()=>nn,fromValues:()=>Ht,identity:()=>qt,invert:()=>Xt,mul:()=>gn,multiply:()=>Dr,multiplyScalar:()=>vn,multiplyScalarAndAdd:()=>yn,normalFromMat4:()=>ln,projection:()=>fn,rotate:()=>rn,scale:()=>tn,set:()=>Jt,str:()=>hn,sub:()=>Mn,subtract:()=>Fr,translate:()=>en,transpose:()=>Zt});function Qe(){var e=new T(9);return T!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function $t(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[4],e[4]=r[5],e[5]=r[6],e[6]=r[8],e[7]=r[9],e[8]=r[10],e}function jt(e){var r=new T(9);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function Wt(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function Ht(e,r,t,n,s,a,i,c,o){var l=new T(9);return l[0]=e,l[1]=r,l[2]=t,l[3]=n,l[4]=s,l[5]=a,l[6]=i,l[7]=c,l[8]=o,l}function Jt(e,r,t,n,s,a,i,c,o,l){return e[0]=r,e[1]=t,e[2]=n,e[3]=s,e[4]=a,e[5]=i,e[6]=c,e[7]=o,e[8]=l,e}function qt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Zt(e,r){if(e===r){var t=r[1],n=r[2],s=r[5];e[1]=r[3],e[2]=r[6],e[3]=t,e[5]=r[7],e[6]=n,e[7]=s}else e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8];return e}function Xt(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],x=h*i-c*l,v=-h*a+c*o,p=l*a-i*o,m=t*x+n*v+s*p;return m?(m=1/m,e[0]=x*m,e[1]=(-h*n+s*l)*m,e[2]=(c*n-s*i)*m,e[3]=v*m,e[4]=(h*t-s*o)*m,e[5]=(-c*t+s*a)*m,e[6]=p*m,e[7]=(-l*t+n*o)*m,e[8]=(i*t-n*a)*m,e):null}function Kt(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8];return e[0]=i*h-c*l,e[1]=s*l-n*h,e[2]=n*c-s*i,e[3]=c*o-a*h,e[4]=t*h-s*o,e[5]=s*a-t*c,e[6]=a*l-i*o,e[7]=n*o-t*l,e[8]=t*i-n*a,e}function Qt(e){var r=e[0],t=e[1],n=e[2],s=e[3],a=e[4],i=e[5],c=e[6],o=e[7],l=e[8];return r*(l*a-i*o)+t*(-l*s+i*c)+n*(o*s-a*c)}function Dr(e,r,t){var n=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],x=r[8],v=t[0],p=t[1],m=t[2],d=t[3],y=t[4],g=t[5],O=t[6],M=t[7],u=t[8];return e[0]=v*n+p*i+m*l,e[1]=v*s+p*c+m*h,e[2]=v*a+p*o+m*x,e[3]=d*n+y*i+g*l,e[4]=d*s+y*c+g*h,e[5]=d*a+y*o+g*x,e[6]=O*n+M*i+u*l,e[7]=O*s+M*c+u*h,e[8]=O*a+M*o+u*x,e}function en(e,r,t){var n=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],x=r[8],v=t[0],p=t[1];return e[0]=n,e[1]=s,e[2]=a,e[3]=i,e[4]=c,e[5]=o,e[6]=v*n+p*i+l,e[7]=v*s+p*c+h,e[8]=v*a+p*o+x,e}function rn(e,r,t){var n=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],x=r[8],v=Math.sin(t),p=Math.cos(t);return e[0]=p*n+v*i,e[1]=p*s+v*c,e[2]=p*a+v*o,e[3]=p*i-v*n,e[4]=p*c-v*s,e[5]=p*o-v*a,e[6]=l,e[7]=h,e[8]=x,e}function tn(e,r,t){var n=t[0],s=t[1];return e[0]=n*r[0],e[1]=n*r[1],e[2]=n*r[2],e[3]=s*r[3],e[4]=s*r[4],e[5]=s*r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function nn(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=r[0],e[7]=r[1],e[8]=1,e}function sn(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=-t,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function an(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=r[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function cn(e,r){return e[0]=r[0],e[1]=r[1],e[2]=0,e[3]=r[2],e[4]=r[3],e[5]=0,e[6]=r[4],e[7]=r[5],e[8]=1,e}function on(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=t+t,c=n+n,o=s+s,l=t*i,h=n*i,x=n*c,v=s*i,p=s*c,m=s*o,d=a*i,y=a*c,g=a*o;return e[0]=1-x-m,e[3]=h-g,e[6]=v+y,e[1]=h+g,e[4]=1-l-m,e[7]=p-d,e[2]=v-y,e[5]=p+d,e[8]=1-l-x,e}function ln(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],x=r[9],v=r[10],p=r[11],m=r[12],d=r[13],y=r[14],g=r[15],O=t*c-n*i,M=t*o-s*i,u=t*l-a*i,S=n*o-s*c,P=n*l-a*c,G=s*l-a*o,N=h*d-x*m,z=h*y-v*m,E=h*g-p*m,V=x*y-v*d,k=x*g-p*d,D=v*g-p*y,A=O*D-M*k+u*V+S*E-P*z+G*N;return A?(A=1/A,e[0]=(c*D-o*k+l*V)*A,e[1]=(o*E-i*D-l*z)*A,e[2]=(i*k-c*E+l*N)*A,e[3]=(s*k-n*D-a*V)*A,e[4]=(t*D-s*E+a*z)*A,e[5]=(n*E-t*k-a*N)*A,e[6]=(d*G-y*P+g*S)*A,e[7]=(y*u-m*G-g*M)*A,e[8]=(m*P-d*u+g*O)*A,e):null}function fn(e,r,t){return e[0]=2/r,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/t,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function hn(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function pn(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function xn(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e}function Fr(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e}function vn(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e}function yn(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e}function mn(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]}function dn(e,r){var t=e[0],n=e[1],s=e[2],a=e[3],i=e[4],c=e[5],o=e[6],l=e[7],h=e[8],x=r[0],v=r[1],p=r[2],m=r[3],d=r[4],y=r[5],g=r[6],O=r[7],M=r[8];return Math.abs(t-x)<=w*Math.max(1,Math.abs(t),Math.abs(x))&&Math.abs(n-v)<=w*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(s-p)<=w*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-m)<=w*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(i-d)<=w*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(c-y)<=w*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(o-g)<=w*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-O)<=w*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(h-M)<=w*Math.max(1,Math.abs(h),Math.abs(M))}var gn=Dr,Mn=Fr;var ue={};pe(ue,{add:()=>ns,adjoint:()=>Cn,clone:()=>un,copy:()=>Pn,create:()=>bn,determinant:()=>Rn,equals:()=>cs,exactEquals:()=>is,frob:()=>ts,fromQuat:()=>Wn,fromQuat2:()=>Yn,fromRotation:()=>Dn,fromRotationTranslation:()=>Yr,fromRotationTranslationScale:()=>$n,fromRotationTranslationScaleOrigin:()=>jn,fromScaling:()=>Vn,fromTranslation:()=>kn,fromValues:()=>On,fromXRotation:()=>Fn,fromYRotation:()=>_n,fromZRotation:()=>Ln,frustum:()=>Hn,getRotation:()=>Un,getScaling:()=>Br,getTranslation:()=>Bn,identity:()=>_r,invert:()=>An,lookAt:()=>Qn,mul:()=>os,multiply:()=>Lr,multiplyScalar:()=>ss,multiplyScalarAndAdd:()=>as,ortho:()=>Xn,orthoNO:()=>$r,orthoZO:()=>Kn,perspective:()=>Jn,perspectiveFromFieldOfView:()=>Zn,perspectiveNO:()=>Ur,perspectiveZO:()=>qn,rotate:()=>Gn,rotateX:()=>En,rotateY:()=>Nn,rotateZ:()=>zn,scale:()=>Tn,set:()=>Sn,str:()=>rs,sub:()=>ls,subtract:()=>jr,targetTo:()=>es,translate:()=>In,transpose:()=>wn});function bn(){var e=new T(16);return T!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function un(e){var r=new T(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Pn(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function On(e,r,t,n,s,a,i,c,o,l,h,x,v,p,m,d){var y=new T(16);return y[0]=e,y[1]=r,y[2]=t,y[3]=n,y[4]=s,y[5]=a,y[6]=i,y[7]=c,y[8]=o,y[9]=l,y[10]=h,y[11]=x,y[12]=v,y[13]=p,y[14]=m,y[15]=d,y}function Sn(e,r,t,n,s,a,i,c,o,l,h,x,v,p,m,d,y){return e[0]=r,e[1]=t,e[2]=n,e[3]=s,e[4]=a,e[5]=i,e[6]=c,e[7]=o,e[8]=l,e[9]=h,e[10]=x,e[11]=v,e[12]=p,e[13]=m,e[14]=d,e[15]=y,e}function _r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wn(e,r){if(e===r){var t=r[1],n=r[2],s=r[3],a=r[6],i=r[7],c=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=a,e[11]=r[14],e[12]=s,e[13]=i,e[14]=c}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function An(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],x=r[9],v=r[10],p=r[11],m=r[12],d=r[13],y=r[14],g=r[15],O=t*c-n*i,M=t*o-s*i,u=t*l-a*i,S=n*o-s*c,P=n*l-a*c,G=s*l-a*o,N=h*d-x*m,z=h*y-v*m,E=h*g-p*m,V=x*y-v*d,k=x*g-p*d,D=v*g-p*y,A=O*D-M*k+u*V+S*E-P*z+G*N;return A?(A=1/A,e[0]=(c*D-o*k+l*V)*A,e[1]=(s*k-n*D-a*V)*A,e[2]=(d*G-y*P+g*S)*A,e[3]=(v*P-x*G-p*S)*A,e[4]=(o*E-i*D-l*z)*A,e[5]=(t*D-s*E+a*z)*A,e[6]=(y*u-m*G-g*M)*A,e[7]=(h*G-v*u+p*M)*A,e[8]=(i*k-c*E+l*N)*A,e[9]=(n*E-t*k-a*N)*A,e[10]=(m*P-d*u+g*O)*A,e[11]=(x*u-h*P-p*O)*A,e[12]=(c*z-i*V-o*N)*A,e[13]=(t*V-n*z+s*N)*A,e[14]=(d*M-m*S-y*O)*A,e[15]=(h*S-x*M+v*O)*A,e):null}function Cn(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=r[4],c=r[5],o=r[6],l=r[7],h=r[8],x=r[9],v=r[10],p=r[11],m=r[12],d=r[13],y=r[14],g=r[15];return e[0]=c*(v*g-p*y)-x*(o*g-l*y)+d*(o*p-l*v),e[1]=-(n*(v*g-p*y)-x*(s*g-a*y)+d*(s*p-a*v)),e[2]=n*(o*g-l*y)-c*(s*g-a*y)+d*(s*l-a*o),e[3]=-(n*(o*p-l*v)-c*(s*p-a*v)+x*(s*l-a*o)),e[4]=-(i*(v*g-p*y)-h*(o*g-l*y)+m*(o*p-l*v)),e[5]=t*(v*g-p*y)-h*(s*g-a*y)+m*(s*p-a*v),e[6]=-(t*(o*g-l*y)-i*(s*g-a*y)+m*(s*l-a*o)),e[7]=t*(o*p-l*v)-i*(s*p-a*v)+h*(s*l-a*o),e[8]=i*(x*g-p*d)-h*(c*g-l*d)+m*(c*p-l*x),e[9]=-(t*(x*g-p*d)-h*(n*g-a*d)+m*(n*p-a*x)),e[10]=t*(c*g-l*d)-i*(n*g-a*d)+m*(n*l-a*c),e[11]=-(t*(c*p-l*x)-i*(n*p-a*x)+h*(n*l-a*c)),e[12]=-(i*(x*y-v*d)-h*(c*y-o*d)+m*(c*v-o*x)),e[13]=t*(x*y-v*d)-h*(n*y-s*d)+m*(n*v-s*x),e[14]=-(t*(c*y-o*d)-i*(n*y-s*d)+m*(n*o-s*c)),e[15]=t*(c*v-o*x)-i*(n*v-s*x)+h*(n*o-s*c),e}function Rn(e){var r=e[0],t=e[1],n=e[2],s=e[3],a=e[4],i=e[5],c=e[6],o=e[7],l=e[8],h=e[9],x=e[10],v=e[11],p=e[12],m=e[13],d=e[14],y=e[15],g=r*i-t*a,O=r*c-n*a,M=r*o-s*a,u=t*c-n*i,S=t*o-s*i,P=n*o-s*c,G=l*m-h*p,N=l*d-x*p,z=l*y-v*p,E=h*d-x*m,V=h*y-v*m,k=x*y-v*d;return g*k-O*V+M*E+u*z-S*N+P*G}function Lr(e,r,t){var n=r[0],s=r[1],a=r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],x=r[8],v=r[9],p=r[10],m=r[11],d=r[12],y=r[13],g=r[14],O=r[15],M=t[0],u=t[1],S=t[2],P=t[3];return e[0]=M*n+u*c+S*x+P*d,e[1]=M*s+u*o+S*v+P*y,e[2]=M*a+u*l+S*p+P*g,e[3]=M*i+u*h+S*m+P*O,M=t[4],u=t[5],S=t[6],P=t[7],e[4]=M*n+u*c+S*x+P*d,e[5]=M*s+u*o+S*v+P*y,e[6]=M*a+u*l+S*p+P*g,e[7]=M*i+u*h+S*m+P*O,M=t[8],u=t[9],S=t[10],P=t[11],e[8]=M*n+u*c+S*x+P*d,e[9]=M*s+u*o+S*v+P*y,e[10]=M*a+u*l+S*p+P*g,e[11]=M*i+u*h+S*m+P*O,M=t[12],u=t[13],S=t[14],P=t[15],e[12]=M*n+u*c+S*x+P*d,e[13]=M*s+u*o+S*v+P*y,e[14]=M*a+u*l+S*p+P*g,e[15]=M*i+u*h+S*m+P*O,e}function In(e,r,t){var n=t[0],s=t[1],a=t[2],i,c,o,l,h,x,v,p,m,d,y,g;return r===e?(e[12]=r[0]*n+r[4]*s+r[8]*a+r[12],e[13]=r[1]*n+r[5]*s+r[9]*a+r[13],e[14]=r[2]*n+r[6]*s+r[10]*a+r[14],e[15]=r[3]*n+r[7]*s+r[11]*a+r[15]):(i=r[0],c=r[1],o=r[2],l=r[3],h=r[4],x=r[5],v=r[6],p=r[7],m=r[8],d=r[9],y=r[10],g=r[11],e[0]=i,e[1]=c,e[2]=o,e[3]=l,e[4]=h,e[5]=x,e[6]=v,e[7]=p,e[8]=m,e[9]=d,e[10]=y,e[11]=g,e[12]=i*n+h*s+m*a+r[12],e[13]=c*n+x*s+d*a+r[13],e[14]=o*n+v*s+y*a+r[14],e[15]=l*n+p*s+g*a+r[15]),e}function Tn(e,r,t){var n=t[0],s=t[1],a=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=r[7]*s,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=r[11]*a,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Gn(e,r,t,n){var s=n[0],a=n[1],i=n[2],c=Math.hypot(s,a,i),o,l,h,x,v,p,m,d,y,g,O,M,u,S,P,G,N,z,E,V,k,D,A,K;return c<w?null:(c=1/c,s*=c,a*=c,i*=c,o=Math.sin(t),l=Math.cos(t),h=1-l,x=r[0],v=r[1],p=r[2],m=r[3],d=r[4],y=r[5],g=r[6],O=r[7],M=r[8],u=r[9],S=r[10],P=r[11],G=s*s*h+l,N=a*s*h+i*o,z=i*s*h-a*o,E=s*a*h-i*o,V=a*a*h+l,k=i*a*h+s*o,D=s*i*h+a*o,A=a*i*h-s*o,K=i*i*h+l,e[0]=x*G+d*N+M*z,e[1]=v*G+y*N+u*z,e[2]=p*G+g*N+S*z,e[3]=m*G+O*N+P*z,e[4]=x*E+d*V+M*k,e[5]=v*E+y*V+u*k,e[6]=p*E+g*V+S*k,e[7]=m*E+O*V+P*k,e[8]=x*D+d*A+M*K,e[9]=v*D+y*A+u*K,e[10]=p*D+g*A+S*K,e[11]=m*D+O*A+P*K,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function En(e,r,t){var n=Math.sin(t),s=Math.cos(t),a=r[4],i=r[5],c=r[6],o=r[7],l=r[8],h=r[9],x=r[10],v=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=a*s+l*n,e[5]=i*s+h*n,e[6]=c*s+x*n,e[7]=o*s+v*n,e[8]=l*s-a*n,e[9]=h*s-i*n,e[10]=x*s-c*n,e[11]=v*s-o*n,e}function Nn(e,r,t){var n=Math.sin(t),s=Math.cos(t),a=r[0],i=r[1],c=r[2],o=r[3],l=r[8],h=r[9],x=r[10],v=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*s-l*n,e[1]=i*s-h*n,e[2]=c*s-x*n,e[3]=o*s-v*n,e[8]=a*n+l*s,e[9]=i*n+h*s,e[10]=c*n+x*s,e[11]=o*n+v*s,e}function zn(e,r,t){var n=Math.sin(t),s=Math.cos(t),a=r[0],i=r[1],c=r[2],o=r[3],l=r[4],h=r[5],x=r[6],v=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*s+l*n,e[1]=i*s+h*n,e[2]=c*s+x*n,e[3]=o*s+v*n,e[4]=l*s-a*n,e[5]=h*s-i*n,e[6]=x*s-c*n,e[7]=v*s-o*n,e}function kn(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Vn(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dn(e,r,t){var n=t[0],s=t[1],a=t[2],i=Math.hypot(n,s,a),c,o,l;return i<w?null:(i=1/i,n*=i,s*=i,a*=i,c=Math.sin(r),o=Math.cos(r),l=1-o,e[0]=n*n*l+o,e[1]=s*n*l+a*c,e[2]=a*n*l-s*c,e[3]=0,e[4]=n*s*l-a*c,e[5]=s*s*l+o,e[6]=a*s*l+n*c,e[7]=0,e[8]=n*a*l+s*c,e[9]=s*a*l-n*c,e[10]=a*a*l+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Fn(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _n(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ln(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yr(e,r,t){var n=r[0],s=r[1],a=r[2],i=r[3],c=n+n,o=s+s,l=a+a,h=n*c,x=n*o,v=n*l,p=s*o,m=s*l,d=a*l,y=i*c,g=i*o,O=i*l;return e[0]=1-(p+d),e[1]=x+O,e[2]=v-g,e[3]=0,e[4]=x-O,e[5]=1-(h+d),e[6]=m+y,e[7]=0,e[8]=v+g,e[9]=m-y,e[10]=1-(h+p),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Yn(e,r){var t=new T(3),n=-r[0],s=-r[1],a=-r[2],i=r[3],c=r[4],o=r[5],l=r[6],h=r[7],x=n*n+s*s+a*a+i*i;return x>0?(t[0]=(c*i+h*n+o*a-l*s)*2/x,t[1]=(o*i+h*s+l*n-c*a)*2/x,t[2]=(l*i+h*a+c*s-o*n)*2/x):(t[0]=(c*i+h*n+o*a-l*s)*2,t[1]=(o*i+h*s+l*n-c*a)*2,t[2]=(l*i+h*a+c*s-o*n)*2),Yr(e,r,t),e}function Bn(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function Br(e,r){var t=r[0],n=r[1],s=r[2],a=r[4],i=r[5],c=r[6],o=r[8],l=r[9],h=r[10];return e[0]=Math.hypot(t,n,s),e[1]=Math.hypot(a,i,c),e[2]=Math.hypot(o,l,h),e}function Un(e,r){var t=new T(3);Br(t,r);var n=1/t[0],s=1/t[1],a=1/t[2],i=r[0]*n,c=r[1]*s,o=r[2]*a,l=r[4]*n,h=r[5]*s,x=r[6]*a,v=r[8]*n,p=r[9]*s,m=r[10]*a,d=i+h+m,y=0;return d>0?(y=Math.sqrt(d+1)*2,e[3]=.25*y,e[0]=(x-p)/y,e[1]=(v-o)/y,e[2]=(c-l)/y):i>h&&i>m?(y=Math.sqrt(1+i-h-m)*2,e[3]=(x-p)/y,e[0]=.25*y,e[1]=(c+l)/y,e[2]=(v+o)/y):h>m?(y=Math.sqrt(1+h-i-m)*2,e[3]=(v-o)/y,e[0]=(c+l)/y,e[1]=.25*y,e[2]=(x+p)/y):(y=Math.sqrt(1+m-i-h)*2,e[3]=(c-l)/y,e[0]=(v+o)/y,e[1]=(x+p)/y,e[2]=.25*y),e}function $n(e,r,t,n){var s=r[0],a=r[1],i=r[2],c=r[3],o=s+s,l=a+a,h=i+i,x=s*o,v=s*l,p=s*h,m=a*l,d=a*h,y=i*h,g=c*o,O=c*l,M=c*h,u=n[0],S=n[1],P=n[2];return e[0]=(1-(m+y))*u,e[1]=(v+M)*u,e[2]=(p-O)*u,e[3]=0,e[4]=(v-M)*S,e[5]=(1-(x+y))*S,e[6]=(d+g)*S,e[7]=0,e[8]=(p+O)*P,e[9]=(d-g)*P,e[10]=(1-(x+m))*P,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function jn(e,r,t,n,s){var a=r[0],i=r[1],c=r[2],o=r[3],l=a+a,h=i+i,x=c+c,v=a*l,p=a*h,m=a*x,d=i*h,y=i*x,g=c*x,O=o*l,M=o*h,u=o*x,S=n[0],P=n[1],G=n[2],N=s[0],z=s[1],E=s[2],V=(1-(d+g))*S,k=(p+u)*S,D=(m-M)*S,A=(p-u)*P,K=(1-(v+g))*P,Me=(y+O)*P,be=(m+M)*G,Nr=(y-O)*G,zr=(1-(v+d))*G;return e[0]=V,e[1]=k,e[2]=D,e[3]=0,e[4]=A,e[5]=K,e[6]=Me,e[7]=0,e[8]=be,e[9]=Nr,e[10]=zr,e[11]=0,e[12]=t[0]+N-(V*N+A*z+be*E),e[13]=t[1]+z-(k*N+K*z+Nr*E),e[14]=t[2]+E-(D*N+Me*z+zr*E),e[15]=1,e}function Wn(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=t+t,c=n+n,o=s+s,l=t*i,h=n*i,x=n*c,v=s*i,p=s*c,m=s*o,d=a*i,y=a*c,g=a*o;return e[0]=1-x-m,e[1]=h+g,e[2]=v-y,e[3]=0,e[4]=h-g,e[5]=1-l-m,e[6]=p+d,e[7]=0,e[8]=v+y,e[9]=p-d,e[10]=1-l-x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hn(e,r,t,n,s,a,i){var c=1/(t-r),o=1/(s-n),l=1/(a-i);return e[0]=a*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*o,e[6]=0,e[7]=0,e[8]=(t+r)*c,e[9]=(s+n)*o,e[10]=(i+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*a*2*l,e[15]=0,e}function Ur(e,r,t,n,s){var a=1/Math.tan(r/2),i;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(i=1/(n-s),e[10]=(s+n)*i,e[14]=2*s*n*i):(e[10]=-1,e[14]=-2*n),e}var Jn=Ur;function qn(e,r,t,n,s){var a=1/Math.tan(r/2),i;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(i=1/(n-s),e[10]=s*i,e[14]=s*n*i):(e[10]=-1,e[14]=-n),e}function Zn(e,r,t,n){var s=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),i=Math.tan(r.leftDegrees*Math.PI/180),c=Math.tan(r.rightDegrees*Math.PI/180),o=2/(i+c),l=2/(s+a);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((i-c)*o*.5),e[9]=(s-a)*l*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function $r(e,r,t,n,s,a,i){var c=1/(r-t),o=1/(n-s),l=1/(a-i);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(r+t)*c,e[13]=(s+n)*o,e[14]=(i+a)*l,e[15]=1,e}var Xn=$r;function Kn(e,r,t,n,s,a,i){var c=1/(r-t),o=1/(n-s),l=1/(a-i);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(r+t)*c,e[13]=(s+n)*o,e[14]=a*l,e[15]=1,e}function Qn(e,r,t,n){var s,a,i,c,o,l,h,x,v,p,m=r[0],d=r[1],y=r[2],g=n[0],O=n[1],M=n[2],u=t[0],S=t[1],P=t[2];return Math.abs(m-u)<w&&Math.abs(d-S)<w&&Math.abs(y-P)<w?_r(e):(h=m-u,x=d-S,v=y-P,p=1/Math.hypot(h,x,v),h*=p,x*=p,v*=p,s=O*v-M*x,a=M*h-g*v,i=g*x-O*h,p=Math.hypot(s,a,i),p?(p=1/p,s*=p,a*=p,i*=p):(s=0,a=0,i=0),c=x*i-v*a,o=v*s-h*i,l=h*a-x*s,p=Math.hypot(c,o,l),p?(p=1/p,c*=p,o*=p,l*=p):(c=0,o=0,l=0),e[0]=s,e[1]=c,e[2]=h,e[3]=0,e[4]=a,e[5]=o,e[6]=x,e[7]=0,e[8]=i,e[9]=l,e[10]=v,e[11]=0,e[12]=-(s*m+a*d+i*y),e[13]=-(c*m+o*d+l*y),e[14]=-(h*m+x*d+v*y),e[15]=1,e)}function es(e,r,t,n){var s=r[0],a=r[1],i=r[2],c=n[0],o=n[1],l=n[2],h=s-t[0],x=a-t[1],v=i-t[2],p=h*h+x*x+v*v;p>0&&(p=1/Math.sqrt(p),h*=p,x*=p,v*=p);var m=o*v-l*x,d=l*h-c*v,y=c*x-o*h;return p=m*m+d*d+y*y,p>0&&(p=1/Math.sqrt(p),m*=p,d*=p,y*=p),e[0]=m,e[1]=d,e[2]=y,e[3]=0,e[4]=x*y-v*d,e[5]=v*m-h*y,e[6]=h*d-x*m,e[7]=0,e[8]=h,e[9]=x,e[10]=v,e[11]=0,e[12]=s,e[13]=a,e[14]=i,e[15]=1,e}function rs(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ts(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ns(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function jr(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function ss(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function as(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function is(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function cs(e,r){var t=e[0],n=e[1],s=e[2],a=e[3],i=e[4],c=e[5],o=e[6],l=e[7],h=e[8],x=e[9],v=e[10],p=e[11],m=e[12],d=e[13],y=e[14],g=e[15],O=r[0],M=r[1],u=r[2],S=r[3],P=r[4],G=r[5],N=r[6],z=r[7],E=r[8],V=r[9],k=r[10],D=r[11],A=r[12],K=r[13],Me=r[14],be=r[15];return Math.abs(t-O)<=w*Math.max(1,Math.abs(t),Math.abs(O))&&Math.abs(n-M)<=w*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(s-u)<=w*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-S)<=w*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(i-P)<=w*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(c-G)<=w*Math.max(1,Math.abs(c),Math.abs(G))&&Math.abs(o-N)<=w*Math.max(1,Math.abs(o),Math.abs(N))&&Math.abs(l-z)<=w*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(h-E)<=w*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(x-V)<=w*Math.max(1,Math.abs(x),Math.abs(V))&&Math.abs(v-k)<=w*Math.max(1,Math.abs(v),Math.abs(k))&&Math.abs(p-D)<=w*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(m-A)<=w*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(d-K)<=w*Math.max(1,Math.abs(d),Math.abs(K))&&Math.abs(y-Me)<=w*Math.max(1,Math.abs(y),Math.abs(Me))&&Math.abs(g-be)<=w*Math.max(1,Math.abs(g),Math.abs(be))}var os=Lr,ls=jr;var Ne={};pe(Ne,{add:()=>Ta,calculateW:()=>Ma,clone:()=>Aa,conjugate:()=>Oa,copy:()=>Ra,create:()=>xr,dot:()=>ht,equals:()=>Va,exactEquals:()=>ka,exp:()=>ct,fromEuler:()=>Sa,fromMat3:()=>lt,fromValues:()=>Ca,getAngle:()=>ya,getAxisAngle:()=>va,identity:()=>xa,invert:()=>Pa,len:()=>Na,length:()=>pt,lerp:()=>Ea,ln:()=>ot,mul:()=>Ga,multiply:()=>it,normalize:()=>vr,pow:()=>ba,random:()=>ua,rotateX:()=>ma,rotateY:()=>da,rotateZ:()=>ga,rotationTo:()=>Da,scale:()=>ft,set:()=>Ia,setAxes:()=>_a,setAxisAngle:()=>at,slerp:()=>Ee,sqlerp:()=>Fa,sqrLen:()=>za,squaredLength:()=>xt,str:()=>wa});var f={};pe(f,{add:()=>xs,angle:()=>Ns,bezier:()=>ws,ceil:()=>vs,clone:()=>fs,copy:()=>hs,create:()=>Ce,cross:()=>Pe,dist:()=>Ys,distance:()=>Zr,div:()=>Ls,divide:()=>qr,dot:()=>Ie,equals:()=>Ds,exactEquals:()=>Vs,floor:()=>ys,forEach:()=>$s,fromValues:()=>Re,hermite:()=>Ss,inverse:()=>Ps,len:()=>rr,length:()=>Wr,lerp:()=>Os,max:()=>ds,min:()=>ms,mul:()=>_s,multiply:()=>Jr,negate:()=>us,normalize:()=>er,random:()=>As,rotateX:()=>Ts,rotateY:()=>Gs,rotateZ:()=>Es,round:()=>gs,scale:()=>Ms,scaleAndAdd:()=>bs,set:()=>ps,sqrDist:()=>Bs,sqrLen:()=>Us,squaredDistance:()=>Xr,squaredLength:()=>Kr,str:()=>ks,sub:()=>Fs,subtract:()=>Hr,transformMat3:()=>Rs,transformMat4:()=>Cs,transformQuat:()=>Is,zero:()=>zs});function Ce(){var e=new T(3);return T!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function fs(e){var r=new T(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function Wr(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function Re(e,r,t){var n=new T(3);return n[0]=e,n[1]=r,n[2]=t,n}function hs(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function ps(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function xs(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function Hr(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function Jr(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function qr(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function vs(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function ys(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function ms(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function ds(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function gs(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function Ms(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function bs(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function Zr(e,r){var t=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];return Math.hypot(t,n,s)}function Xr(e,r){var t=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];return t*t+n*n+s*s}function Kr(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function us(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function Ps(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function er(e,r){var t=r[0],n=r[1],s=r[2],a=t*t+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function Ie(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function Pe(e,r,t){var n=r[0],s=r[1],a=r[2],i=t[0],c=t[1],o=t[2];return e[0]=s*o-a*c,e[1]=a*i-n*o,e[2]=n*c-s*i,e}function Os(e,r,t,n){var s=r[0],a=r[1],i=r[2];return e[0]=s+n*(t[0]-s),e[1]=a+n*(t[1]-a),e[2]=i+n*(t[2]-i),e}function Ss(e,r,t,n,s,a){var i=a*a,c=i*(2*a-3)+1,o=i*(a-2)+a,l=i*(a-1),h=i*(3-2*a);return e[0]=r[0]*c+t[0]*o+n[0]*l+s[0]*h,e[1]=r[1]*c+t[1]*o+n[1]*l+s[1]*h,e[2]=r[2]*c+t[2]*o+n[2]*l+s[2]*h,e}function ws(e,r,t,n,s,a){var i=1-a,c=i*i,o=a*a,l=c*i,h=3*a*c,x=3*o*i,v=o*a;return e[0]=r[0]*l+t[0]*h+n[0]*x+s[0]*v,e[1]=r[1]*l+t[1]*h+n[1]*x+s[1]*v,e[2]=r[2]*l+t[2]*h+n[2]*x+s[2]*v,e}function As(e,r){r=r||1;var t=Y()*2*Math.PI,n=Y()*2-1,s=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*s,e[1]=Math.sin(t)*s,e[2]=n*r,e}function Cs(e,r,t){var n=r[0],s=r[1],a=r[2],i=t[3]*n+t[7]*s+t[11]*a+t[15];return i=i||1,e[0]=(t[0]*n+t[4]*s+t[8]*a+t[12])/i,e[1]=(t[1]*n+t[5]*s+t[9]*a+t[13])/i,e[2]=(t[2]*n+t[6]*s+t[10]*a+t[14])/i,e}function Rs(e,r,t){var n=r[0],s=r[1],a=r[2];return e[0]=n*t[0]+s*t[3]+a*t[6],e[1]=n*t[1]+s*t[4]+a*t[7],e[2]=n*t[2]+s*t[5]+a*t[8],e}function Is(e,r,t){var n=t[0],s=t[1],a=t[2],i=t[3],c=r[0],o=r[1],l=r[2],h=s*l-a*o,x=a*c-n*l,v=n*o-s*c,p=s*v-a*x,m=a*h-n*v,d=n*x-s*h,y=i*2;return h*=y,x*=y,v*=y,p*=2,m*=2,d*=2,e[0]=c+h+p,e[1]=o+x+m,e[2]=l+v+d,e}function Ts(e,r,t,n){var s=[],a=[];return s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2],a[0]=s[0],a[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),a[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Gs(e,r,t,n){var s=[],a=[];return s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2],a[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),a[1]=s[1],a[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Es(e,r,t,n){var s=[],a=[];return s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2],a[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),a[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),a[2]=s[2],e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Ns(e,r){var t=e[0],n=e[1],s=e[2],a=r[0],i=r[1],c=r[2],o=Math.sqrt(t*t+n*n+s*s),l=Math.sqrt(a*a+i*i+c*c),h=o*l,x=h&&Ie(e,r)/h;return Math.acos(Math.min(Math.max(x,-1),1))}function zs(e){return e[0]=0,e[1]=0,e[2]=0,e}function ks(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Vs(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Ds(e,r){var t=e[0],n=e[1],s=e[2],a=r[0],i=r[1],c=r[2];return Math.abs(t-a)<=w*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-i)<=w*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(s-c)<=w*Math.max(1,Math.abs(s),Math.abs(c))}var Fs=Hr,_s=Jr,Ls=qr,Ys=Zr,Bs=Xr,rr=Wr,Us=Kr,$s=function(){var e=Ce();return function(r,t,n,s,a,i){var c,o;for(t||(t=3),n||(n=0),s?o=Math.min(s*t+n,r.length):o=r.length,c=n;c<o;c+=t)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],a(e,e,i),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2];return r}}();var B={};pe(B,{add:()=>ir,ceil:()=>js,clone:()=>tr,copy:()=>sr,create:()=>Qr,cross:()=>Qs,dist:()=>oa,distance:()=>nt,div:()=>ca,divide:()=>tt,dot:()=>lr,equals:()=>pr,exactEquals:()=>hr,floor:()=>Ws,forEach:()=>pa,fromValues:()=>nr,inverse:()=>Ks,len:()=>fa,length:()=>Te,lerp:()=>fr,max:()=>Js,min:()=>Hs,mul:()=>ia,multiply:()=>rt,negate:()=>Xs,normalize:()=>or,random:()=>ea,round:()=>qs,scale:()=>cr,scaleAndAdd:()=>Zs,set:()=>ar,sqrDist:()=>la,sqrLen:()=>ha,squaredDistance:()=>st,squaredLength:()=>Ge,str:()=>sa,sub:()=>aa,subtract:()=>et,transformMat4:()=>ra,transformQuat:()=>ta,zero:()=>na});function Qr(){var e=new T(4);return T!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function tr(e){var r=new T(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function nr(e,r,t,n){var s=new T(4);return s[0]=e,s[1]=r,s[2]=t,s[3]=n,s}function sr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function ar(e,r,t,n,s){return e[0]=r,e[1]=t,e[2]=n,e[3]=s,e}function ir(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function et(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function rt(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function tt(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function js(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function Ws(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function Hs(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function Js(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function qs(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function cr(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function Zs(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function nt(e,r){var t=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2],a=r[3]-e[3];return Math.hypot(t,n,s,a)}function st(e,r){var t=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2],a=r[3]-e[3];return t*t+n*n+s*s+a*a}function Te(e){var r=e[0],t=e[1],n=e[2],s=e[3];return Math.hypot(r,t,n,s)}function Ge(e){var r=e[0],t=e[1],n=e[2],s=e[3];return r*r+t*t+n*n+s*s}function Xs(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function Ks(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function or(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=t*t+n*n+s*s+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=t*i,e[1]=n*i,e[2]=s*i,e[3]=a*i,e}function lr(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function Qs(e,r,t,n){var s=t[0]*n[1]-t[1]*n[0],a=t[0]*n[2]-t[2]*n[0],i=t[0]*n[3]-t[3]*n[0],c=t[1]*n[2]-t[2]*n[1],o=t[1]*n[3]-t[3]*n[1],l=t[2]*n[3]-t[3]*n[2],h=r[0],x=r[1],v=r[2],p=r[3];return e[0]=x*l-v*o+p*c,e[1]=-(h*l)+v*i-p*a,e[2]=h*o-x*i+p*s,e[3]=-(h*c)+x*a-v*s,e}function fr(e,r,t,n){var s=r[0],a=r[1],i=r[2],c=r[3];return e[0]=s+n*(t[0]-s),e[1]=a+n*(t[1]-a),e[2]=i+n*(t[2]-i),e[3]=c+n*(t[3]-c),e}function ea(e,r){r=r||1;var t,n,s,a,i,c;do t=Y()*2-1,n=Y()*2-1,i=t*t+n*n;while(i>=1);do s=Y()*2-1,a=Y()*2-1,c=s*s+a*a;while(c>=1);var o=Math.sqrt((1-i)/c);return e[0]=r*t,e[1]=r*n,e[2]=r*s*o,e[3]=r*a*o,e}function ra(e,r,t){var n=r[0],s=r[1],a=r[2],i=r[3];return e[0]=t[0]*n+t[4]*s+t[8]*a+t[12]*i,e[1]=t[1]*n+t[5]*s+t[9]*a+t[13]*i,e[2]=t[2]*n+t[6]*s+t[10]*a+t[14]*i,e[3]=t[3]*n+t[7]*s+t[11]*a+t[15]*i,e}function ta(e,r,t){var n=r[0],s=r[1],a=r[2],i=t[0],c=t[1],o=t[2],l=t[3],h=l*n+c*a-o*s,x=l*s+o*n-i*a,v=l*a+i*s-c*n,p=-i*n-c*s-o*a;return e[0]=h*l+p*-i+x*-o-v*-c,e[1]=x*l+p*-c+v*-i-h*-o,e[2]=v*l+p*-o+h*-c-x*-i,e[3]=r[3],e}function na(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function sa(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function hr(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function pr(e,r){var t=e[0],n=e[1],s=e[2],a=e[3],i=r[0],c=r[1],o=r[2],l=r[3];return Math.abs(t-i)<=w*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(n-c)<=w*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-o)<=w*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(a-l)<=w*Math.max(1,Math.abs(a),Math.abs(l))}var aa=et,ia=rt,ca=tt,oa=nt,la=st,fa=Te,ha=Ge,pa=function(){var e=Qr();return function(r,t,n,s,a,i){var c,o;for(t||(t=4),n||(n=0),s?o=Math.min(s*t+n,r.length):o=r.length,c=n;c<o;c+=t)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],e[3]=r[c+3],a(e,e,i),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2],r[c+3]=e[3];return r}}();function xr(){var e=new T(4);return T!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function xa(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function at(e,r,t){t=t*.5;var n=Math.sin(t);return e[0]=n*r[0],e[1]=n*r[1],e[2]=n*r[2],e[3]=Math.cos(t),e}function va(e,r){var t=Math.acos(r[3])*2,n=Math.sin(t/2);return n>w?(e[0]=r[0]/n,e[1]=r[1]/n,e[2]=r[2]/n):(e[0]=1,e[1]=0,e[2]=0),t}function ya(e,r){var t=ht(e,r);return Math.acos(2*t*t-1)}function it(e,r,t){var n=r[0],s=r[1],a=r[2],i=r[3],c=t[0],o=t[1],l=t[2],h=t[3];return e[0]=n*h+i*c+s*l-a*o,e[1]=s*h+i*o+a*c-n*l,e[2]=a*h+i*l+n*o-s*c,e[3]=i*h-n*c-s*o-a*l,e}function ma(e,r,t){t*=.5;var n=r[0],s=r[1],a=r[2],i=r[3],c=Math.sin(t),o=Math.cos(t);return e[0]=n*o+i*c,e[1]=s*o+a*c,e[2]=a*o-s*c,e[3]=i*o-n*c,e}function da(e,r,t){t*=.5;var n=r[0],s=r[1],a=r[2],i=r[3],c=Math.sin(t),o=Math.cos(t);return e[0]=n*o-a*c,e[1]=s*o+i*c,e[2]=a*o+n*c,e[3]=i*o-s*c,e}function ga(e,r,t){t*=.5;var n=r[0],s=r[1],a=r[2],i=r[3],c=Math.sin(t),o=Math.cos(t);return e[0]=n*o+s*c,e[1]=s*o-n*c,e[2]=a*o+i*c,e[3]=i*o-a*c,e}function Ma(e,r){var t=r[0],n=r[1],s=r[2];return e[0]=t,e[1]=n,e[2]=s,e[3]=Math.sqrt(Math.abs(1-t*t-n*n-s*s)),e}function ct(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=Math.sqrt(t*t+n*n+s*s),c=Math.exp(a),o=i>0?c*Math.sin(i)/i:0;return e[0]=t*o,e[1]=n*o,e[2]=s*o,e[3]=c*Math.cos(i),e}function ot(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=Math.sqrt(t*t+n*n+s*s),c=i>0?Math.atan2(i,a)/i:0;return e[0]=t*c,e[1]=n*c,e[2]=s*c,e[3]=.5*Math.log(t*t+n*n+s*s+a*a),e}function ba(e,r,t){return ot(e,r),ft(e,e,t),ct(e,e),e}function Ee(e,r,t,n){var s=r[0],a=r[1],i=r[2],c=r[3],o=t[0],l=t[1],h=t[2],x=t[3],v,p,m,d,y;return p=s*o+a*l+i*h+c*x,p<0&&(p=-p,o=-o,l=-l,h=-h,x=-x),1-p>w?(v=Math.acos(p),m=Math.sin(v),d=Math.sin((1-n)*v)/m,y=Math.sin(n*v)/m):(d=1-n,y=n),e[0]=d*s+y*o,e[1]=d*a+y*l,e[2]=d*i+y*h,e[3]=d*c+y*x,e}function ua(e){var r=Y(),t=Y(),n=Y(),s=Math.sqrt(1-r),a=Math.sqrt(r);return e[0]=s*Math.sin(2*Math.PI*t),e[1]=s*Math.cos(2*Math.PI*t),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e}function Pa(e,r){var t=r[0],n=r[1],s=r[2],a=r[3],i=t*t+n*n+s*s+a*a,c=i?1/i:0;return e[0]=-t*c,e[1]=-n*c,e[2]=-s*c,e[3]=a*c,e}function Oa(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=r[3],e}function lt(e,r){var t=r[0]+r[4]+r[8],n;if(t>0)n=Math.sqrt(t+1),e[3]=.5*n,n=.5/n,e[0]=(r[5]-r[7])*n,e[1]=(r[6]-r[2])*n,e[2]=(r[1]-r[3])*n;else{var s=0;r[4]>r[0]&&(s=1),r[8]>r[s*3+s]&&(s=2);var a=(s+1)%3,i=(s+2)%3;n=Math.sqrt(r[s*3+s]-r[a*3+a]-r[i*3+i]+1),e[s]=.5*n,n=.5/n,e[3]=(r[a*3+i]-r[i*3+a])*n,e[a]=(r[a*3+s]+r[s*3+a])*n,e[i]=(r[i*3+s]+r[s*3+i])*n}return e}function Sa(e,r,t,n){var s=.5*Math.PI/180;r*=s,t*=s,n*=s;var a=Math.sin(r),i=Math.cos(r),c=Math.sin(t),o=Math.cos(t),l=Math.sin(n),h=Math.cos(n);return e[0]=a*o*h-i*c*l,e[1]=i*c*h+a*o*l,e[2]=i*o*l-a*c*h,e[3]=i*o*h+a*c*l,e}function wa(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Aa=tr,Ca=nr,Ra=sr,Ia=ar,Ta=ir,Ga=it,ft=cr,ht=lr,Ea=fr,pt=Te,Na=pt,xt=Ge,za=xt,vr=or,ka=hr,Va=pr,Da=function(){var e=Ce(),r=Re(1,0,0),t=Re(0,1,0);return function(n,s,a){var i=Ie(s,a);return i<-.999999?(Pe(e,r,s),rr(e)<1e-6&&Pe(e,t,s),er(e,e),at(n,e,Math.PI),n):i>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Pe(e,s,a),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+i,vr(n,n))}}(),Fa=function(){var e=xr(),r=xr();return function(t,n,s,a,i,c){return Ee(e,n,i,c),Ee(r,s,a,c),Ee(t,e,r,2*c*(1-c)),t}}(),_a=function(){var e=Qe();return function(r,t,n,s){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-t[0],e[5]=-t[1],e[8]=-t[2],vr(r,lt(r,e))}}();var _={};pe(_,{add:()=>$a,angle:()=>fi,ceil:()=>ja,clone:()=>La,copy:()=>Ba,create:()=>vt,cross:()=>ti,dist:()=>Mi,distance:()=>gt,div:()=>gi,divide:()=>dt,dot:()=>ri,equals:()=>vi,exactEquals:()=>xi,floor:()=>Wa,forEach:()=>Pi,fromValues:()=>Ya,inverse:()=>Qa,len:()=>yi,length:()=>bt,lerp:()=>ni,max:()=>Ja,min:()=>Ha,mul:()=>di,multiply:()=>mt,negate:()=>Ka,normalize:()=>ei,random:()=>si,rotate:()=>li,round:()=>qa,scale:()=>Za,scaleAndAdd:()=>Xa,set:()=>Ua,sqrDist:()=>bi,sqrLen:()=>ui,squaredDistance:()=>Mt,squaredLength:()=>ut,str:()=>pi,sub:()=>mi,subtract:()=>yt,transformMat2:()=>ai,transformMat2d:()=>ii,transformMat3:()=>ci,transformMat4:()=>oi,zero:()=>hi});function vt(){var e=new T(2);return T!=Float32Array&&(e[0]=0,e[1]=0),e}function La(e){var r=new T(2);return r[0]=e[0],r[1]=e[1],r}function Ya(e,r){var t=new T(2);return t[0]=e,t[1]=r,t}function Ba(e,r){return e[0]=r[0],e[1]=r[1],e}function Ua(e,r,t){return e[0]=r,e[1]=t,e}function $a(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function yt(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e}function mt(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e}function dt(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e}function ja(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function Wa(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Ha(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e}function Ja(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e}function qa(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function Za(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e}function Xa(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e}function gt(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.hypot(t,n)}function Mt(e,r){var t=r[0]-e[0],n=r[1]-e[1];return t*t+n*n}function bt(e){var r=e[0],t=e[1];return Math.hypot(r,t)}function ut(e){var r=e[0],t=e[1];return r*r+t*t}function Ka(e,r){return e[0]=-r[0],e[1]=-r[1],e}function Qa(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function ei(e,r){var t=r[0],n=r[1],s=t*t+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=r[0]*s,e[1]=r[1]*s,e}function ri(e,r){return e[0]*r[0]+e[1]*r[1]}function ti(e,r,t){var n=r[0]*t[1]-r[1]*t[0];return e[0]=e[1]=0,e[2]=n,e}function ni(e,r,t,n){var s=r[0],a=r[1];return e[0]=s+n*(t[0]-s),e[1]=a+n*(t[1]-a),e}function si(e,r){r=r||1;var t=Y()*2*Math.PI;return e[0]=Math.cos(t)*r,e[1]=Math.sin(t)*r,e}function ai(e,r,t){var n=r[0],s=r[1];return e[0]=t[0]*n+t[2]*s,e[1]=t[1]*n+t[3]*s,e}function ii(e,r,t){var n=r[0],s=r[1];return e[0]=t[0]*n+t[2]*s+t[4],e[1]=t[1]*n+t[3]*s+t[5],e}function ci(e,r,t){var n=r[0],s=r[1];return e[0]=t[0]*n+t[3]*s+t[6],e[1]=t[1]*n+t[4]*s+t[7],e}function oi(e,r,t){var n=r[0],s=r[1];return e[0]=t[0]*n+t[4]*s+t[12],e[1]=t[1]*n+t[5]*s+t[13],e}function li(e,r,t,n){var s=r[0]-t[0],a=r[1]-t[1],i=Math.sin(n),c=Math.cos(n);return e[0]=s*c-a*i+t[0],e[1]=s*i+a*c+t[1],e}function fi(e,r){var t=e[0],n=e[1],s=r[0],a=r[1],i=Math.sqrt(t*t+n*n)*Math.sqrt(s*s+a*a),c=i&&(t*s+n*a)/i;return Math.acos(Math.min(Math.max(c,-1),1))}function hi(e){return e[0]=0,e[1]=0,e}function pi(e){return"vec2("+e[0]+", "+e[1]+")"}function xi(e,r){return e[0]===r[0]&&e[1]===r[1]}function vi(e,r){var t=e[0],n=e[1],s=r[0],a=r[1];return Math.abs(t-s)<=w*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(n-a)<=w*Math.max(1,Math.abs(n),Math.abs(a))}var yi=bt,mi=yt,di=mt,gi=dt,Mi=gt,bi=Mt,ui=ut,Pi=function(){var e=vt();return function(r,t,n,s,a,i){var c,o;for(t||(t=2),n||(n=0),s?o=Math.min(s*t+n,r.length):o=r.length,c=n;c<o;c+=t)e[0]=r[c],e[1]=r[c+1],a(e,e,i),r[c]=e[0],r[c+1]=e[1];return r}}();var ae=f.create(),ie=f.create(),ce=f.create(),ze=f.create(),mr=[f.fromValues(1e-5,0,0),f.fromValues(0,1e-5,0),f.fromValues(0,0,1e-5),f.fromValues(-1e-5,0,0),f.fromValues(0,-1e-5,0),f.fromValues(0,0,-1e-5)],Pt=$.create(),Oi=4*Math.PI;function yr(e,r){return e.slice(r,r+3)}function Ot(e,r){let t=0,n=e.length;for(let s=0;s<n;s+=9){f.sub(ae,yr(e,s),r),f.sub(ie,yr(e,s+3),r),f.sub(ce,yr(e,s+6),r);let a=f.length(ae),i=f.length(ie),c=f.length(ce);$.set(Pt,ae[0],ie[0],ce[0],ae[1],ie[1],ce[1],ae[2],ie[2],ce[2]),t+=2*Math.atan2($.determinant(Pt),a*i*c+f.dot(ae,ie)*c+f.dot(ie,ce)*a+f.dot(ae,ce)*i)}return Math.round(t/Oi)}function St(e,r,t){if(f.copy(ze,r),Ot(e,ze)!==0)return!0;if(t){for(let n of mr)if(f.add(ze,r,n),Ot(e,ze)!==0)return!0}return!1}function dr(e){let r=new Float32Array(e.length*3*3),t=0;for(let n of e){let s=n.triangle;r.set(s.a,t),t+=3,r.set(s.b,t),t+=3,r.set(s.c,t),t+=3}return r}var b=f.create(),R=f.create(),ve=f.create();function Si(e,r,t={coplanar:!1,source:f.create(),target:f.create()}){let n=t,s=e.a,a=e.b,i=e.c,c=r.a,o=r.b,l=r.c;f.sub(b,c,l),f.sub(R,o,l);let h=f.cross(f.create(),b,R);f.sub(b,s,l);let x=f.dot(b,h);f.sub(b,a,l);let v=f.dot(b,h);f.sub(b,i,l);let p=f.dot(b,h);if(x*v>0&&x*p>0)return!1;f.sub(b,a,s),f.sub(R,i,s);let m=f.cross(f.create(),b,R);f.sub(b,c,i);let d=f.dot(b,m);f.sub(b,o,i);let y=f.dot(b,m);f.sub(b,l,i);let g=f.dot(b,m);return d*y>0&&d*g>0?!1:(n.N2=h,n.N1=m,x>0?v>0?J(i,s,a,c,l,o,d,g,y,n):p>0?J(a,i,s,c,l,o,d,g,y,n):J(s,a,i,c,o,l,d,y,g,n):x<0?v<0?J(i,s,a,c,o,l,d,y,g,n):p<0?J(a,i,s,c,o,l,d,y,g,n):J(s,a,i,c,l,o,d,g,y,n):v<0?p>=0?J(a,i,s,c,l,o,d,g,y,n):J(s,a,i,c,o,l,d,y,g,n):v>0?p>0?J(s,a,i,c,l,o,d,g,y,n):J(a,i,s,c,o,l,d,y,g,n):p>0?J(i,s,a,c,o,l,d,y,g,n):p<0?J(i,s,a,c,l,o,d,g,y,n):(n.coplanar=!0,At(s,a,i,c,o,l,m)))}function J(e,r,t,n,s,a,i,c,o,l){return i>0?c>0?q(e,t,r,a,n,s,l):o>0?q(e,t,r,s,a,n,l):q(e,r,t,n,s,a,l):i<0?c<0?q(e,r,t,a,n,s,l):o<0?q(e,r,t,s,a,n,l):q(e,t,r,n,s,a,l):c<0?o>=0?q(e,t,r,s,a,n,l):q(e,r,t,n,s,a,l):c>0?o>0?q(e,t,r,n,s,a,l):q(e,r,t,s,a,n,l):o>0?q(e,r,t,a,n,s,l):o<0?q(e,t,r,a,n,s,l):(l.coplanar=!0,At(e,r,t,n,s,a,l.N1))}function At(e,r,t,n,s,a,i){let c=_.create(),o=_.create(),l=_.create(),h=_.create(),x=_.create(),v=_.create(),p=i[0]<0?-i[0]:i[0],m=i[1]<0?-i[1]:i[1],d=i[2]<0?-i[2]:i[2];return p>d&&p>=m?(c[0]=r[2],c[1]=r[1],o[0]=e[2],o[1]=e[1],l[0]=t[2],l[1]=t[1],h[0]=s[2],h[1]=s[1],x[0]=n[2],x[1]=n[1],v[0]=a[2],v[1]=a[1]):m>d&&m>=p?(c[0]=r[0],c[1]=r[2],o[0]=e[0],o[1]=e[2],l[0]=t[0],l[1]=t[2],h[0]=s[0],h[1]=s[2],x[0]=n[0],x[1]=n[2],v[0]=a[0],v[1]=a[2]):(c[0]=e[0],c[1]=e[1],o[0]=r[0],o[1]=r[1],l[0]=t[0],l[1]=t[1],h[0]=n[0],h[1]=n[1],x[0]=s[0],x[1]=s[1],v[0]=a[0],v[1]=a[1]),wi(c,o,l,h,x,v)}function wi(e,r,t,n,s,a){return I(e,r,t)<0?I(n,s,a)<0?ke(e,t,r,n,a,s):ke(e,t,r,n,s,a):I(n,s,a)<0?ke(e,r,t,n,a,s):ke(e,r,t,n,s,a)}function I(e,r,t){return(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[1])}function ke(e,r,t,n,s,a){return I(n,s,e)>=0?I(s,a,e)>=0?I(a,n,e)>=0?!0:gr(e,r,t,n,a):I(a,n,e)>=0?gr(e,r,t,a,s):Mr(e,r,t,n,s,a):I(s,a,e)>=0?I(a,n,e)>=0?gr(e,r,a,s,n):Mr(e,r,t,s,a,n):Mr(e,r,t,a,n,s)}function gr(e,r,t,n,s){if(I(s,n,r)>=0){if(I(e,n,r)>=0)return I(e,r,s)>=0;if(I(r,t,n)>=0)return I(t,e,n)>=0}else if(I(s,n,t)>=0&&I(e,n,t)>=0)return I(e,t,s)>=0||I(r,t,s)>=0;return!1}function Mr(e,r,t,n,s,a){if(I(a,n,r)>=0){if(I(a,s,r)<=0){if(I(e,n,r)>0)return I(e,s,r)<=0;if(I(e,n,t)>=0)return I(r,t,n)>=0}else if(I(e,s,r)<=0&&I(a,s,t)<=0)return I(r,t,s)>=0}else if(I(a,n,t)>=0){if(I(r,t,a)>=0)return I(e,n,t)>=0;if(I(r,t,s)>=0)return I(a,t,s)>=0}return!1}function q(e,r,t,n,s,a,i){let c;f.sub(b,r,e),f.sub(R,a,e);let o=f.cross(f.create(),b,R);if(f.sub(ve,n,e),f.dot(ve,o)>0){if(f.sub(b,t,e),f.cross(o,b,R),f.dot(ve,o)<=0)return f.sub(R,s,e),f.cross(o,b,R),f.dot(ve,o)>0?(f.sub(b,e,n),f.sub(R,e,t),c=f.dot(b,i.N2)/f.dot(R,i.N2),f.scale(b,R,c),f.sub(i.source,e,b),f.sub(b,n,e),f.sub(R,n,a),c=f.dot(b,i.N1)/f.dot(R,i.N1),f.scale(b,R,c),f.sub(i.target,n,b)):(f.sub(b,n,e),f.sub(R,n,s),c=f.dot(b,i.N1)/f.dot(R,i.N1),f.scale(b,R,c),f.sub(i.source,n,b),f.sub(b,n,e),f.sub(R,n,a),c=f.dot(b,i.N1)/f.dot(R,i.N1),f.scale(b,R,c),f.sub(i.target,n,b)),!0}else if(f.sub(R,s,e),f.cross(o,b,R),f.dot(ve,o)>=0)return f.sub(b,t,e),f.cross(o,b,R),f.dot(ve,o)>=0?(f.sub(b,e,n),f.sub(R,e,t),c=f.dot(b,i.N2)/f.dot(R,i.N2),f.scale(b,R,c),f.sub(i.source,e,b),f.sub(b,e,n),f.sub(R,e,r),c=f.dot(b,i.N2)/f.dot(R,i.N2),f.scale(b,R,c),f.sub(i.target,e,b)):(f.sub(b,n,e),f.sub(R,n,s),c=f.dot(b,i.N1)/f.dot(R,i.N1),f.scale(b,R,c),f.sub(i.source,n,b),f.sub(b,e,n),f.sub(R,e,r),c=f.dot(b,i.N2)/f.dot(R,i.N2),f.scale(b,R,c),f.sub(i.target,e,b)),!0;return!1}function Ai(e,r,t){let n=f.sub(f.create(),e.end,e.start),s=f.sub(f.create(),r.end,r.start),a=f.sub(f.create(),e.start,r.start),i=f.dot(a,n),c=f.dot(a,s),o=f.dot(n,s),l=f.dot(n,n),h=f.dot(s,s),x=l*h-o*o,p=(c*o-i*h)/x,m=(c+p*o)/h,d=f.scaleAndAdd(n,e.start,n,p),y=f.scaleAndAdd(s,r.start,s,m),g=!1,O=!1;return 0<=p&&p<=1&&0<=m&&m<=1&&(g=!0),f.distance(d,y)<=1e-5&&(O=!0),O&&g?(t&&t.push(d,y),!0):!1}function wt(e){return[{start:e.a,end:e.b},{start:e.b,end:e.c},{start:e.c,end:e.a}]}function Ct(e,r,t={coplanar:!1,source:f.create(),target:f.create()}){if(t.coplanar){let n=wt(e),s=wt(r);for(let a=0;a<3;a++)for(let i=0;i<3;i++)if(Ai(n[a],s[i]))return!0}return Si(e,r,t)}var ye=class{constructor(r,t,n){this.a=r;this.b=t;this.c=n}static copyAuxValues(r,t){r._midpoint&&(t._midpoint?f.copy(t._midpoint,r._midpoint):t._midpoint=f.clone(r._midpoint)),r._hash&&(t._hash=r._hash)}set(r,t,n){this.a=r,this.b=t,this.c=n,this._midpoint=void 0,this._hash=void 0}get midpoint(){return this._midpoint?this._midpoint:(this._midpoint=f.clone(this.a),f.add(this._midpoint,this._midpoint,this.b),f.add(this._midpoint,this._midpoint,this.c),f.scale(this._midpoint,this._midpoint,Vr))}equals(r){return f.equals(this.a,r.a)&&f.equals(this.b,r.b)&&f.equals(this.c,r.c)}murmur_32_scramble(r){return r*=3432918353,r=r<<15|r>>17,r*=461845907,r&4294967295}murmur3_32(r,t){let n=t,s=new Uint32Array(r.buffer);for(let a of s)n^=this.murmur_32_scramble(a),n=n<<13&4294967295|n>>19,n=n*5+3864292196&4294967295;return n^=s.byteLength,n^=n>>16,n=n*2246822507&4294967295,n^=n>>13,n=n*3266489909&4294967295,n^=n>>16,n}get hash(){if(this._hash!==void 0)return this._hash;let r=new Float32Array([this.a[0]*1e5,this.a[1]*1e5,this.a[2]*1e5,this.b[0]*1e5,this.b[1]*1e5,this.b[2]*1e5,this.c[0]*1e5,this.c[1]*1e5,this.c[2]*1e5]);return this._hash=this.murmur3_32(r,3935228948),this._hash}};var j=f.create(),br=f.create(),tc=f.create(),Ve=$.create(),nc=ue.create(),sc=ue.create(),ac=_.create(),ic=_.create(),cc=Ne.create();var W=class{constructor(r){this.buffer=r}static fromNormal(r,t){let n=B.create();return f.copy(n,r),n[3]=t,new W(n)}get w(){return this.buffer[3]}set w(r){this.buffer[3]=r}get unsafeNormal(){return this.buffer}clone(){return new W(B.clone(this.buffer))}flip(){f.negate(this.buffer,this.buffer),this.w=-this.w}delete(){this.buffer=void 0}equals(r){return B.equals(this.buffer,r.buffer)}static calculateNormal(r,t,n){return f.sub(j,t,r),f.sub(br,n,r),f.cross(j,j,br),f.normalize(j,j),f.clone(j)}static fromPoints(r,t,n){let s=W.calculateNormal(r,t,n);return W.fromNormal(s,f.dot(s,r))}};var Ci=0;var Q=class{constructor(r,t=0){this.intersects=!1;this.state=0;this.previousState=0;this.previousStates=[];this.valid=!0;this.coplanar=!1;this.originalValid=!1;this.newPolygon=!1;this.id=Ci++,this.vertices=r.map(n=>n.clone()),this.shared=t,this.plane=W.fromPoints(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos),this.triangle=new ye(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos)}get midpoint(){return this.triangle.midpoint}applyMatrixNoAuto(r,t,n){this.vertices.forEach(s=>{f.transformMat4(s.pos,s.pos,t),n&&s.applyMatrix(t,n,r)}),this.plane.delete(),this.plane=W.fromPoints(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos),this.triangle.set(this.vertices[0].pos,this.vertices[1].pos,this.vertices[2].pos)}applyMatrix(r,t,n){let s,a=r.get(this.shared);if(a){for(let i of a)if(i.transformable===1){s=n||$.normalFromMat4(Ve,t);break}}this.applyMatrixNoAuto(a,t,s)}reset(r=!0){this.intersects=!1,this.state=0,this.previousState=0,this.previousStates.length=0,this.valid=!0,this.coplanar=!1,r&&(this.originalValid=!1),this.newPolygon=!1}setState(r,t){this.state!==t&&(this.previousState=this.state,this.state!==0&&this.previousStates.push(this.state),this.state=r)}checkAllStates(r){if(this.state!==r||this.previousState!==r&&this.previousState!==0)return!1;for(let t of this.previousStates)if(t!==r)return!1;return!0}setInvalid(){this.valid=!1}setValid(){this.valid=!0}clone(){let r=new Q(this.vertices.map(t=>t.clone()),this.shared);return r.intersects=this.intersects,r.valid=this.valid,r.coplanar=this.coplanar,r.state=this.state,r.originalValid=this.originalValid,r.newPolygon=this.newPolygon,r.previousState=this.previousState,r.previousStates=this.previousStates.slice(),ye.copyAuxValues(this.triangle,r.triangle),r}flip(r){let t=r.get(this.shared);this.vertices.reverse().forEach(s=>s.flip(t));let n=this.triangle.a;this.triangle.a=this.triangle.c,this.triangle.c=n,this.plane.flip()}delete(){this.vertices.forEach(r=>r.delete()),this.vertices.length=0,this.plane&&(this.plane.delete(),this.plane=void 0),this.triangle=void 0,this.shared=0,this.setInvalid()}};var H=(a=>(a[a.Undecided=0]="Undecided",a[a.Back=void 0]="Back",a[a.Front=void 0]="Front",a[a.CoplanarBack=3]="CoplanarBack",a[a.CoplanarFront=4]="CoplanarFront",a))(H||{}),It=0,ur=1,De=2,Tt=3;function Nt(e,r,t,n=[]){let s=t.get(e.shared),a={polygon:e,type:H.Undecided},i=0,c=[];for(let o of e.vertices){let l=f.dot(r.unsafeNormal,o.pos)-r.w,h=l<-1e-5?De:l>1e-5?ur:It;i|=h,c.push(h)}switch(i){case It:a.type=f.dot(r.unsafeNormal,e.plane.unsafeNormal)>0?H.CoplanarFront:H.CoplanarBack,n.push(a);break;case ur:a.type=H.Front,n.push(a);break;case De:a.type=H.Back,n.push(a);break;case Tt:{let o=[],l=[],h=e.vertices.length;for(let x=0;x<h;x++){let v=(x+1)%h,p=c[x],m=c[v],d=e.vertices[x],y=e.vertices[v];if(p!==De&&o.push(d),p!==ur&&l.push(p!=De?d.clone():d),(p|m)===Tt){f.sub(j,y.pos,d.pos);let g=(r.w-f.dot(r.unsafeNormal,d.pos))/f.dot(r.unsafeNormal,j),O=d.interpolate(y,g,s);o.push(O),l.push(O.clone())}}if(o.length>3)for(let x of Gt(o))n.push({polygon:new Q(x,e.shared),type:H.Front});else o.length===3&&n.push({polygon:new Q(o,e.shared),type:H.Front});if(l.length>3)for(let x of Gt(l))n.push({polygon:new Q(x,e.shared),type:H.Back});else l.length===3&&n.push({polygon:new Q(l,e.shared),type:H.Back});break}}return n.length==0&&n.push(a),n}function Gt(e){let r=[];if(e.length>4){console.warn(`[splitPolygonArr] arr.length (${e.length}) > 4`);for(let t=3;t<=e.length;t++)r.push([e[0].clone(),e[t-2].clone(),e[t-1].clone()])}else f.squaredDistance(e[0].pos,e[2].pos)<=f.squaredDistance(e[1].pos,e[3].pos)?r.push([e[0].clone(),e[1].clone(),e[2].clone()],[e[0].clone(),e[2].clone(),e[3].clone()]):r.push([e[0].clone(),e[1].clone(),e[3].clone()],[e[1].clone(),e[2].clone(),e[3].clone()]);return r}var Pr=[0,0,0],Or=[0,0,0],Sr=[0,0,0],wr=[0,0,0],Ar=[0,0,0],Cr=1e-8;function Fe(e,r,t=f.create()){f.sub(Pr,r.b,r.a),f.sub(Or,r.c,r.a),f.cross(Sr,e.direction,Or);let n=f.dot(Pr,Sr);if(n>-Cr&&n<Cr)return null;f.sub(wr,e.origin,r.a);let s=1/n,a=s*f.dot(wr,Sr);if(a<0||a>1)return null;f.cross(Ar,wr,Pr);let i=s*f.dot(e.direction,Ar);if(i<0||a+i>1)return null;let c=s*f.dot(Or,Ar);return c>Cr?f.scaleAndAdd(t,e.origin,e.direction,c):null}var F=f.create(),L=f.create(),me=f.create(),_e=f.fromValues(1,0,0),Le=f.fromValues(0,1,0),Ye=f.fromValues(0,0,1),Ri=f.create(),Ii=f.create(),Ti=f.create(),Gi=f.create(),Ei=f.create(),Ni=f.create(),zi=f.create(),ki=f.create(),Be=f.create(),Ue=f.create(),$e=f.create();function Z(e,r){return e<r?e:r}function X(e,r){return e>r?e:r}var ee=class{constructor(r=f.create(),t=f.create()){this.min=r;this.max=t}clone(){return new ee(f.clone(this.min),f.clone(this.max))}expandByPoint(r){f.min(this.min,this.min,r),f.max(this.max,this.max,r)}expandByScalar(r){f.set(F,r,r,r),f.sub(this.min,this.min,F),f.add(this.max,this.max,F)}_project(r,t){let n=r.length,s=f.dot(r[0],t),a=s;for(let i=1;i<n;i++){let c=f.dot(r[i],t);s=Math.min(s,c),a=Math.max(a,c)}return[s,a]}_testNormal(r,t,n,s){let[a,i]=this._project(s,n);return i<r||a>t}_testECP(r,t,n,s){let a=f.cross(F,r,t),[i,c]=this._project(s,a),[o,l]=this._project(n,a);return c<o||i>l}intersectsTriangle(r){let t=[r.a,r.b,r.c];if(this._testNormal(this.min[0],this.max[0],_e,t)||this._testNormal(this.min[1],this.max[1],Le,t)||this._testNormal(this.min[2],this.max[2],Ye,t))return!1;let n=W.calculateNormal(r.a,r.b,r.c),s=f.dot(n,r.a),a=[f.set(Ri,this.min[0],this.max[1],this.min[2]),f.set(Ii,this.max[0],this.max[1],this.min[2]),f.set(Ti,this.min[0],this.max[1],this.max[2]),f.set(Gi,this.max[0],this.max[1],this.max[2]),f.set(Ei,this.min[0],this.min[1],this.min[2]),f.set(Ni,this.max[0],this.min[1],this.min[2]),f.set(zi,this.min[0],this.min[1],this.max[2]),f.set(ki,this.max[0],this.min[1],this.max[2])],[i,c]=this._project(a,n);return c<s||i>s?!1:(f.sub(Be,r.a,r.b),f.sub(Ue,r.b,r.c),f.sub($e,r.c,r.a),!(this._testECP(Be,_e,t,a)||this._testECP(Be,Le,t,a)||this._testECP(Be,Ye,t,a)||this._testECP(Ue,_e,t,a)||this._testECP(Ue,Le,t,a)||this._testECP(Ue,Ye,t,a)||this._testECP($e,_e,t,a)||this._testECP($e,Le,t,a)||this._testECP($e,Ye,t,a)))}intersectsBox(r){return!(this.min[0]>r.max[0]||this.max[0]<r.min[0]||this.min[1]>r.max[1]||this.max[1]<r.min[1]||this.min[2]>r.max[2]||this.max[2]<r.min[2])}intersectsRay(r){f.inverse(me,r.direction),f.sub(F,this.min,r.origin),f.mul(F,F,me),f.sub(L,this.max,r.origin),f.mul(L,L,me);let t=Math.max(Z(F[0],1/0),Z(L[0],1/0));t=Math.max(Z(F[1],t),Z(L[1],t)),t=Math.max(Z(F[2],t),Z(L[2],t));let n=Math.min(X(F[0],0),X(L[0],0));return n=Math.min(X(F[1],n),X(L[1],n)),n=Math.min(X(F[2],n),X(L[2],n)),n<t}rayIntersection(r,t){f.inverse(me,r.direction),f.sub(F,this.min,r.origin),f.mul(F,F,me),f.sub(L,this.max,r.origin),f.mul(L,L,me);let n=Math.max(Z(F[0],1/0),Z(L[0],1/0));n=Math.max(Z(F[1],n),Z(L[1],n)),n=Math.max(Z(F[2],n),Z(L[2],n));let s=Math.min(X(F[0],0),X(L[0],0));return s=Math.min(X(F[1],s),X(L[1],s)),s=Math.min(X(F[2],s),X(L[2],s)),s>=n?!1:(f.scaleAndAdd(t,r.origin,r.direction,s<0?n:s),!0)}containsPoint(r){return r[0]>=this.min[0]&&r[0]<=this.max[0]&&r[1]>=this.min[1]&&r[1]<=this.max[1]&&r[2]>=this.min[2]&&r[2]<=this.max[2]}makeEmpty(){f.set(this.min,0,0,0),f.set(this.max,0,0,0)}};var Oe=class{constructor(){this.origin=f.create();this.direction=f.fromValues(0,0,-1)}};function oe(e){switch(e){case 0:return 4;case 1:return 8;case 2:return 12;case 3:return 16}throw new Error(`Unknown vertex property type ID (${e})`)}function Se(e,r,t,n){switch(r){case 0:t.setFloat32(n,e);break;case 1:{let s=e;t.setFloat32(n,s[0]),n+=4,t.setFloat32(n,s[1]);break}case 2:{let s=e;t.setFloat32(n,s[0]),n+=4,t.setFloat32(n,s[1]),n+=4,t.setFloat32(n,s[2]);break}case 3:{let s=e;t.setFloat32(n,s[0]),n+=4,t.setFloat32(n,s[1]),n+=4,t.setFloat32(n,s[2]),n+=4,t.setFloat32(n,s[3]);break}}}function We(e,r,t,n){if(Se(e.pos,2,t,n),n+=12,r){let s=0;for(let a of r)e.extra&&Se(e.extra[s++],a.valueType,t,n),n+=oe(a.valueType)}return n}var ne=class extends Error{constructor(t,n){let s;switch(t){case 0:s="Job failed (worker creation failed)";break;case 1:s="Job failed (operation exception)";break;default:s="Job failed (decode failure)"}super(`${s}: ${n}`);this.failReason=t;this.originalError=n}static WorkerCreationFailure(t){return new ne(0,""+t)}static OperationFailure(t){return new ne(1,""+t)}static DecodeFailure(t){return new ne(2,""+t)}};var le=class{constructor(){this.buckets=new Map}isUnique(r){let t=r.hash,n=this.buckets.get(t);if(n){for(let s of n)if(r.equals(s))return!1;n.push(r)}else n=[r];return!0}clear(){this.buckets.clear()}};var fe={union:{a:[{array:!0,rule:[1,3]},{array:!1,rule:1}],b:[{array:!0,rule:[1,3]},{array:!0,rule:[1,4]},{array:!1,rule:1}]},subtract:{a:[{array:!0,rule:[1,3]},{array:!0,rule:[1,4]},{array:!1,rule:1}],b:[{array:!0,rule:[2,3]},{array:!0,rule:[2,4]},{array:!0,rule:[1,4]},{array:!1,rule:2}]},intersect:{a:[{array:!0,rule:[1,3]},{array:!0,rule:[2,4]},{array:!0,rule:[2,3]},{array:!1,rule:2}],b:[{array:!0,rule:[1,4]},{array:!0,rule:[1,3]},{array:!0,rule:[2,4]},{array:!0,rule:[2,3]},{array:!1,rule:2}]}};function He(e,r){let t=0;if(e){let n=e.get(r);if(n)for(let s of n)t+=oe(s.valueType)}return t}function Rr(e,r,t){return e+t*(r-e)}var se=class{constructor(r,t){this.pos=r;this.extra=t}clone(){let r;if(this.extra){let t=this.extra.length;r=new Array(t);for(let n=0;n<t;n++){let s=this.extra[n];typeof s=="number"?r[n]=s:r[n]=s.slice()}}return new se(f.clone(this.pos),r)}flip(r){if(r&&this.extra){let t=this.extra.length;for(let n=0;n<t;n++){let s=r[n];if(s.flippable)switch(s.valueType){case 0:this.extra[n]=-this.extra[n];break;case 1:_.negate(this.extra[n],this.extra[n]);break;case 2:f.negate(this.extra[n],this.extra[n]);break;case 3:B.negate(this.extra[n],this.extra[n]);break}}}}applyMatrix(r,t,n){if(n&&this.extra){let s=this.extra.length;for(let a=0;a<s;a++){let i=n[a],c=i.transformable;if(c!==null)if(c===0)switch(i.valueType){case 2:f.transformMat4(this.extra[a],this.extra[a],r);break;case 3:B.transformMat4(this.extra[a],this.extra[a],r);break;default:throw new Error("Can't transform this vertex attribute with a model matrix; must be a vec3 or vec4")}else{if(i.valueType!==2)throw new Error("Can't transform this vertex attribute with a normal matrix; must be a vec3");if(t===void 0)throw new Error("Missing normal matrix");let o=this.extra[a];f.transformMat3(o,o,t),f.normalize(o,o)}}}}delete(){this.pos=void 0,this.extra=void 0}interpolate(r,t,n){let s;if(n&&this.extra){let a=this.extra.length;s=new Array(a);for(let i=0;i<a;i++){let c=this.extra[i],o=r.extra[i];switch(n[i].valueType){case 0:s[i]=Rr(c,o,t);break;case 1:s[i]=_.lerp(_.create(),c,o,t);break;case 2:s[i]=f.lerp(f.create(),c,o,t);break;case 3:s[i]=B.lerp(B.create(),c,o,t);break}}}return new se(f.lerp(f.create(),this.pos,r.pos,t),s)}};function we(e,r,t){switch(e){case 0:return r.getFloat32(t);case 1:{let n=r.getFloat32(t);t+=4;let s=r.getFloat32(t);return _.fromValues(n,s)}case 2:{let n=r.getFloat32(t);t+=4;let s=r.getFloat32(t);t+=4;let a=r.getFloat32(t);return f.fromValues(n,s,a)}case 3:{let n=r.getFloat32(t);t+=4;let s=r.getFloat32(t);t+=4;let a=r.getFloat32(t);t+=4;let i=r.getFloat32(t);return B.fromValues(n,s,a,i)}}}function Je(e,r,t){let n=we(2,r,t);t+=12;let s;if(e){s=[];for(let a of e)s.push(we(a.valueType,r,t)),t+=oe(a.valueType)}return new se(n,s)}var zt="Incompatible material definitions for material ID ",Vi=["type","valueType","transformable","flippable"];function kt(e,r,t){let n=r.length;if(n!==t.length)throw new Error(`${zt}${e}; extra attributes count doesn't match`);for(let s=0;s<n;s++){let a=r[s],i=t[s];for(let c of Vi)if(a[c]!==i[c])throw new Error(`${zt}${e}; attribute ${s}'s ${c} doesn't match`)}}function he(e,r){if(e===r)return e;if(e.size===r.size){let n=!0;for(let[s,a]of e){let i=r.get(s);if(!i){n=!1;break}kt(s,a,i)}if(n)return e}let t=new Map;for(let[n,s]of e){let a=r.get(n);a&&kt(n,s,a),t.set(n,s)}for(let[n,s]of r)e.has(n)||t.set(n,s);return t}var Ir=f.create(),Ae=f.create(),Vt=f.create(),de=new Oe,qe=f.fromValues(0,0,1),Dt=kr(2,32)-1,Tr=!1,Di=100,Fi=16,_i=100;let r;var C=class{constructor(t,n,s=null){this.materials=t;this.needsRebuild=!0;this.polygons=[],this.replacedPolygons=[],this.box=n,this.subTrees=[],this.parent=s,this.level=0,this.polygonArrays=[],this.addPolygonsArrayToRoot(this.polygons)}clone(){return new C(this.materials).copy(this)}copy(t){var n;this.deletePolygonsArrayFromRoot(this.polygons),this.polygons=t.polygons.map(s=>s.clone()),this.addPolygonsArrayToRoot(this.polygons),this.replacedPolygons=t.replacedPolygons.map(s=>s.clone()),this.box=(n=t.box)==null?void 0:n.clone(),this.level=t.level,this.needsRebuild=t.needsRebuild;for(let s of t.subTrees)this.subTrees.push(new C(this.materials,void 0,this).copy(s));return this}addPolygonsArrayToRoot(t){this.parent?this.parent.addPolygonsArrayToRoot(t):this.polygonArrays.push(t)}deletePolygonsArrayFromRoot(t){if(this.parent)this.parent.deletePolygonsArrayFromRoot(t);else{let n=this.polygonArrays.indexOf(t);n>-1&&this.polygonArrays.splice(n,1)}}isEmpty(){return this.polygons.length===0}addPolygon(t,n){let s=t.triangle;return n&&!n.isUnique(s)?this:(this.box?(this.box.min[0]=Math.min(this.box.min[0],s.a[0],s.b[0],s.c[0]),this.box.min[1]=Math.min(this.box.min[1],s.a[1],s.b[1],s.c[1]),this.box.min[2]=Math.min(this.box.min[2],s.a[2],s.b[2],s.c[2]),this.box.max[0]=Math.max(this.box.max[0],s.a[0],s.b[0],s.c[0]),this.box.max[1]=Math.max(this.box.max[1],s.a[1],s.b[1],s.c[1]),this.box.max[2]=Math.max(this.box.max[2],s.a[2],s.b[2],s.c[2])):(this.box=new ee,this.box.min[0]=Math.min(s.a[0],s.b[0],s.c[0]),this.box.min[1]=Math.min(s.a[1],s.b[1],s.c[1]),this.box.min[2]=Math.min(s.a[2],s.b[2],s.c[2]),this.box.max[0]=Math.max(s.a[0],s.b[0],s.c[0]),this.box.max[1]=Math.max(s.a[1],s.b[1],s.c[1]),this.box.max[2]=Math.max(s.a[2],s.b[2],s.c[2])),this.polygons.push(t),this)}getSubtreeIdx(t,n){return(n[0]>=t[0]?4:0)|(n[1]>=t[1]?2:0)|(n[2]>=t[2]?1:0)}split(t,n,s){if(this.polygons.length<=s||t>=n)return;if(!this.box)throw new Error("Octree has no box");let a=[];f.sub(Ae,this.box.max,this.box.min);let i=f.scale(Ae,Ae,.5);for(let l=0;l<2;l++)for(let h=0;h<2;h++)for(let x=0;x<2;x++){let v=new ee,p=f.set(Ir,l,h,x);f.multiply(Vt,p,i),f.add(v.min,this.box.min,Vt),f.add(v.max,v.min,i),a.push(new C(this.materials,v,this))}let c=f.add(Ae,this.box.max,this.box.min);f.scale(c,c,.5);let o=[];for(let l of this.polygons){let h=this.getSubtreeIdx(c,l.midpoint),x=a[h],v=x.box,[p,m,d]=l.vertices;v.containsPoint(p.pos)&&v.containsPoint(m.pos)&&v.containsPoint(d.pos)?x.polygons.push(l):o.push(l)}this.polygons.splice(0,this.polygons.length,...o);for(let l of a){let h=t+1;l.level=h,l.split(h,n,s),this.subTrees.push(l)}return this}buildTree(t,n){if(this.subTrees.length>0){console.warn("Octree is already built, but buildTree was called. A rebuild will occur");let s=this.getPolygons();for(let a of this.subTrees)a.delete(!1);this.subTrees.length=0,this.polygons.splice(0,this.polygons.length,...s)}return this.split(0,t!=null?t:Fi,n!=null?n:_i),this.processTree(),this.needsRebuild=!1,this}processTree(){if(!this.isEmpty()){this.box||(this.box=new ee);let n=this.polygons[0].triangle.a;f.copy(this.box.min,n),f.copy(this.box.max,n);for(let s of this.polygons)this.box.expandByPoint(s.triangle.a),this.box.expandByPoint(s.triangle.b),this.box.expandByPoint(s.triangle.c);this.expandParentBox()}for(let t of this.subTrees)t.processTree()}expandParentBox(){if(this.parent){if(!this.box)throw new Error("Octree has no box");if(!this.parent.box)throw new Error("Octree's parent has no box");this.parent.box.expandByPoint(this.box.min),this.parent.box.expandByPoint(this.box.max),this.parent.expandParentBox()}}getPolygonsIntersectingPolygon(t,n=[]){if(!this.box)throw new Error("Octree has no box");this.polygons.length>0&&this.box.intersectsTriangle(t.triangle)&&(_t(t,n,this.polygons),_t(t,n,this.replacedPolygons));for(let s of this.subTrees)s.getPolygonsIntersectingPolygon(t,n);return n}getRayPolygons(t,n){if(n)for(let s of this.replacedPolygons)n.add(s);else n=new Set(this.replacedPolygons);for(let s of this.polygons)s.valid&&s.originalValid&&n.add(s);for(let s of this.subTrees)s.box.intersectsRay(t)&&s.getRayPolygons(t,n);return n}rayIntersect(t,n=[]){if(f.squaredLength(t.direction)===0)return[];for(let s of this.getRayPolygons(t)){let a=Fe(t,s.triangle,Ir);if(a){let i=f.distance(a,t.origin);n.push({distance:i,polygon:s,position:f.add(f.create(),a,t.origin)})}}return n.length&&n.sort(Li),n}handlePolyIntersection(t,n,s){let a=Fe(t,n.triangle,Ir);if(a){let i=f.distance(a,t.origin);(!s||i<s.distance)&&(s={distance:i,polygon:n,position:f.add(f.create(),a,t.origin)})}return s}marchingClosestRayIntersection(t){let n=null;for(let s of this.replacedPolygons)n=this.handlePolyIntersection(t,s,n);for(let s of this.polygons)s.valid&&s.originalValid&&(n=this.handlePolyIntersection(t,s,n));if(this.subTrees.length>0){let s=new Array,a=0;for(let i of this.subTrees){let c=null;if(i.box.rayIntersection(t,j)){c=f.squaredDistance(t.origin,j);let o=0;for(;o<a&&c>=s[o][1];o++);s.splice(o,0,[i,c]),a++}}for(let[i,c]of s){let o=i.marchingClosestRayIntersection(t);o&&(!n||n.distance>o.distance)&&(n=o)}}return n}closestRayIntersection(t){return this.parent===null?this.marchingClosestRayIntersection(t):this.parent.closestRayIntersection(t)}getIntersectingPolygons(t=[]){for(let n of this.polygonArrays)for(let s of n)s.valid&&s.intersects&&t.push(s);return t}getPolygons(t=[]){for(let n of this.polygonArrays)for(let s of n)s.valid&&t.indexOf(s)===-1&&t.push(s);return t}*levelPolygonsGen(){for(let t of this.polygons)t.valid&&(yield t)}get levelPolygons(){return this.levelPolygonsGen()}*treePolygonsGen(){for(let t of this.levelPolygons)yield t;for(let t of this.subTrees)for(let n of t.treePolygons)yield n}get treePolygons(){return this.treePolygonsGen()}*lowerLevelsGen(){for(let t of this.subTrees)yield t}get lowerLevels(){return this.lowerLevelsGen()}invert(){for(let t of this.polygonArrays)for(let n of t)n.valid&&n.flip(this.materials)}replacePolygon(t,n){if(Array.isArray(n)||(n=[n]),this.polygons.length>0){let s=this.polygons.indexOf(t);s>-1&&(t.originalValid?this.replacedPolygons.push(t):t.setInvalid(),this.polygons.splice(s,1,...n))}for(let s of this.subTrees)s.replacePolygon(t,n)}deletePolygonsByStateRules(t,n=!0){for(let s of this.polygonArrays)if(s.length!==0)for(let a of s.slice()){if(!a.valid||!a.intersects)continue;let i=!1;for(let c of t)if(c.array){let o=c.rule;if(o.includes(a.state)&&(a.previousState!==0&&o.includes(a.previousState)||a.previousState===0)){i=!0;let l=new Set;for(let h of o)l.add(h);l.delete(a.state);for(let h of a.previousStates)if(o.includes(h))l.delete(h);else{i=!1;break}if(i)if(l.size>0)i=!1;else break}}else if(a.checkAllStates(c.rule)){i=!0;break}if(i){let c=s.indexOf(a);c>-1&&(a.setInvalid(),s.splice(c,1)),n&&a.delete()}}}deletePolygonsByIntersection(t,n=!0){for(let s of this.polygonArrays)if(s.length!==0){for(let a of s.slice())if(a.valid&&a.intersects===t){let i=s.indexOf(a);i>-1&&(a.setInvalid(),s.splice(i,1)),n&&a.delete()}}}isPolygonIntersecting(t){if(!this.box)throw new Error("Octree has no box");return this.box.intersectsTriangle(t.triangle)}markIntersectingPolygons(t){for(let n of this.polygonArrays)for(let s of n)s.intersects=t.isPolygonIntersecting(s)}resetPolygons(t=!0){for(let n of this.polygonArrays)for(let s of n)s.reset(t)}handleIntersectingPolygons(t,n,s){if(n&&!s)throw new Error("targetOctreeBuffer must be set if using winding number");if(this.polygons.length>0){let a=this.polygons.filter(c=>c.valid&&c.intersects&&c.state===0),i;for(;i=a.pop();){if(i.state!==0||!i.valid)continue;let c=t.getPolygonsIntersectingPolygon(i);for(let o of c){let l=Nt(i,o.plane,this.materials);if(l.length>1){for(let h of l){let x=h.polygon;x.intersects=i.intersects,x.newPolygon=!0,a.push(x)}this.replacePolygon(i,l.map(h=>h.polygon));break}else{let h=l[0];if(i.id!==h.polygon.id){h.polygon.intersects=i.intersects,h.polygon.newPolygon=!0,a.push(h.polygon),this.replacePolygon(i,h.polygon);break}else(h.type===H.CoplanarFront||h.type===H.CoplanarBack)&&(i.setState(h.type),i.coplanar=!0)}}}for(let c of this.polygons){if(!c.valid||!c.intersects)continue;if(!t.box)throw new Error("Octree has no box");let o=!1;if(t.box.containsPoint(c.midpoint))if(n)o=St(s,c.midpoint,c.coplanar);else{let l=f.copy(Ae,c.midpoint);f.copy(de.origin,l),f.copy(qe,c.plane.unsafeNormal),f.copy(de.direction,c.plane.unsafeNormal);let h=t.closestRayIntersection(de);if(h&&f.dot(qe,h.polygon.plane.unsafeNormal)>0)o=!0;else if(c.coplanar){for(let x of mr)if(f.add(de.origin,l,x),f.copy(qe,c.plane.unsafeNormal),f.copy(de.direction,c.plane.unsafeNormal),h=t.closestRayIntersection(de),h&&f.dot(qe,h.polygon.plane.unsafeNormal)>0){o=!0;break}}}c.setState(o?1:2)}}for(let a of this.subTrees)a.handleIntersectingPolygons(t,n,s)}delete(t=!0){if(this.polygons.length>0&&t){for(let n of this.polygons)n.delete();this.polygons.length=0}if(this.replacedPolygons.length>0&&t){for(let n of this.replacedPolygons)n.delete();this.replacedPolygons.length=0}if(this.polygonArrays&&(this.polygonArrays.length=0),this.subTrees.length){for(let n of this.subTrees)n.delete(t);this.subTrees.length=0}this.box=void 0,this.parent=null,this.level=0}dispose(t=!0){this.delete(t)}countEncodingBytes(t,n,s,a,i=0){var h;n.set(this,i),i+=5,this.box&&(i+=24);let c=new Map;for(let x of this.polygons){if(!x.valid||!x.originalValid)continue;let v=x.shared;if(v<0||v>C.maxMaterialID)throw new Error(`Invalid material ID (${v}) for polygon. Valid range: 0-${C.maxMaterialID}`);let p=((h=c.get(v))!=null?h:0)+1;c.set(v,p)}let o=new Map;for(let[x,v]of c){o.set(x,i);let p=He(t,x);i+=8+v*(12+p)*3}s.set(this,c),a.set(this,o);let l=this.subTrees.length;if(l>0){if(l!==8)throw new Error(`Unexpected sub-tree count. Expected 8, got ${l}`);for(let x of this.subTrees)i=x.countEncodingBytes(t,n,s,a,i)}return i}encodeBytes(t,n,s,a,i){let c=s.get(this),o=a.get(this),l=i.get(this),h=o.size;t.setUint32(c,h),c+=4;let x=this.box!==void 0,v=(x?1:0)|(this.subTrees.length>0?2:0)|(this.needsRebuild?4:0);if(t.setUint8(c,v),c++,x){let p=this.box;Se(p.min,2,t,c),c+=12,Se(p.max,2,t,c)}for(let[p,m]of o){let d=l.get(p);t.setUint32(d,p),d+=4,t.setUint32(d,m),d+=4,l.set(p,d)}for(let p of this.polygons){let m=p.shared,d=l.get(m),y=n.get(m);d=We(p.vertices[0],y,t,d),d=We(p.vertices[1],y,t,d),d=We(p.vertices[2],y,t,d),l.set(m,d)}for(let p of this.subTrees)p.encodeBytes(t,n,s,a,i)}encode(t,n){let s=new Map,a=new Map,i=new Map,c=this.countEncodingBytes(t,s,a,i),o=new ArrayBuffer(c),l=new DataView(o);return this.encodeBytes(l,t,s,a,i),n.push(o),o}static decodeBytes(t,n,s,a,i){if(n+5>s)throw new Error("Invalid octree; expected octree header, but there are not enough bytes left for it");let c=new C(i,void 0,a),o=t.getUint32(n);n+=4;let l=t.getUint8(n);n++;let h=(l&1)>0,x=(l&2)>0;if(c.needsRebuild=(l&4)>0,h){if(n+24>s)throw new Error("Invalid octree; expected octree bounding box in header, but there are not enough bytes left for it");let v=we(2,t,n);n+=12;let p=we(2,t,n);n+=12,c.box=new ee(v,p)}for(let v=0;v<o;v++){if(n+6>s)throw new Error("Invalid material section; expected material section header, but there are not enough bytes left for it");let p=t.getUint32(n);n+=4;let m=t.getUint32(n);n+=4;let d=He(i,p),y=12+d,g=m*y*3;if(g===0)throw new Error("Invalid material section; expected at least one polygon, got none");let O=n+g;if(O>s)throw new Error("Invalid material section; expected material section polygon data, but there are not enough bytes left for it");let M=i===null?void 0:i.get(p);for(;n<O;){let u=Je(M,t,n);n+=y;let S=Je(M,t,n);n+=y;let P=Je(M,t,n);n+=y;let G=new Q([u,S,P],p);G.originalValid=!0,c.polygons.push(G)}}if(x)for(let v=0;v<8;v++){let p;[p,n]=C.decodeBytes(t,n,s,c,i),c.subTrees.push(p)}return[c,n]}static decode(t,n){let[s,a]=C.decodeBytes(new DataView(t),0,t.byteLength,null,n);return s}getPolygonCloneCallback(t,n){for(let s of this.polygonArrays)for(let a of s)a.valid&&t(a.clone(),n)}deleteReplacedPolygons(){if(this.replacedPolygons.length>0){for(let t of this.replacedPolygons)t.delete();this.replacedPolygons.length=0}for(let t of this.subTrees)t.deleteReplacedPolygons()}markPolygonsAsOriginal(){for(let t of this.polygonArrays)for(let n of t)n.originalValid=!0}applyMatrix(t,n,s=!0,a=!1){if(this.box&&(this.box=void 0),s){if(!a)for(let i of this.materials.values()){if(i){for(let c of i)if(c.transformable===1){a=!0;break}}if(a)break}a&&!n&&(n=$.normalFromMat4(Ve,t))}for(let i of this.polygons)i.valid&&i.applyMatrixNoAuto(this.materials.get(i.shared),t,n);for(let i of this.subTrees)i.applyMatrix(t,n,!1,a);s&&this.processTree()}setPolygonIndex(t){if(t!==void 0)for(let n of this.polygonArrays)for(let s of n)s.shared=t}getTriangles(t=[]){for(let n of this.getPolygons())t.push(n.triangle);return t}getRayTriangles(t,n=[]){for(let s of this.getRayPolygons(t))n.push(s.triangle);return n}static union(t,n,s){var o;let a=he(t.materials,n.materials);(t.needsRebuild||!t.box)&&t.buildTree(s==null?void 0:s.maxLevel,s==null?void 0:s.polygonsPerTree),(n.needsRebuild||!n.box)&&n.buildTree(s==null?void 0:s.maxLevel,s==null?void 0:s.polygonsPerTree);let i=new C(a),c=new le;return t.box.intersectsBox(n.box)&&(t.resetPolygons(!1),n.resetPolygons(!1),t.markIntersectingPolygons(n),n.markIntersectingPolygons(t),C.handleIntersectingOctrees(t,n,(o=s==null?void 0:s.useWindingNumber)!=null?o:Tr),t.deleteReplacedPolygons(),n.deleteReplacedPolygons(),t.deletePolygonsByStateRules(fe.union.a),n.deletePolygonsByStateRules(fe.union.b)),t.getPolygonCloneCallback(i.addPolygon.bind(i),c),n.getPolygonCloneCallback(i.addPolygon.bind(i),c),c.clear(),i.markPolygonsAsOriginal(),i}static subtract(t,n,s){var o;let a=he(t.materials,n.materials);(t.needsRebuild||!t.box)&&t.buildTree(s==null?void 0:s.maxLevel,s==null?void 0:s.polygonsPerTree),(n.needsRebuild||!n.box)&&n.buildTree(s==null?void 0:s.maxLevel,s==null?void 0:s.polygonsPerTree);let i=new C(a),c=new le;return t.box.intersectsBox(n.box)?(t.resetPolygons(!1),n.resetPolygons(!1),t.markIntersectingPolygons(n),n.markIntersectingPolygons(t),C.handleIntersectingOctrees(t,n,(o=s==null?void 0:s.useWindingNumber)!=null?o:Tr),t.deleteReplacedPolygons(),n.deleteReplacedPolygons(),t.deletePolygonsByStateRules(fe.subtract.a),n.deletePolygonsByStateRules(fe.subtract.b),n.deletePolygonsByIntersection(!1),n.invert(),t.getPolygonCloneCallback(i.addPolygon.bind(i),c),n.getPolygonCloneCallback(i.addPolygon.bind(i),c)):t.getPolygonCloneCallback(i.addPolygon.bind(i),c),c.clear(),i.markPolygonsAsOriginal(),i}static intersect(t,n,s){var o;let a=he(t.materials,n.materials);(t.needsRebuild||!t.box)&&t.buildTree(s==null?void 0:s.maxLevel,s==null?void 0:s.polygonsPerTree),(n.needsRebuild||!n.box)&&n.buildTree(s==null?void 0:s.maxLevel,s==null?void 0:s.polygonsPerTree);let i=new C(a),c=new le;return t.box.intersectsBox(n.box)&&(t.resetPolygons(!1),n.resetPolygons(!1),t.markIntersectingPolygons(n),n.markIntersectingPolygons(t),C.handleIntersectingOctrees(t,n,(o=s==null?void 0:s.useWindingNumber)!=null?o:Tr),t.deleteReplacedPolygons(),n.deleteReplacedPolygons(),t.deletePolygonsByStateRules(fe.intersect.a),n.deletePolygonsByStateRules(fe.intersect.b),t.deletePolygonsByIntersection(!1),n.deletePolygonsByIntersection(!1),t.getPolygonCloneCallback(i.addPolygon.bind(i),c),n.getPolygonCloneCallback(i.addPolygon.bind(i),c)),c.clear(),i.markPolygonsAsOriginal(),i}static unionArray(t,n){return Lt(C.union,t,n)}static subtractArray(t,n){let s=t.length;if(s===0)throw new Error("Unable to find any result octree");return s===1?t[0]:s===2?C.subtract(t[0],t[1],n):C.subtract(t[0],C.unionArray(t.slice(1),n),n)}static intersectArray(t,n){return Lt(C.intersect,t,n)}static operation(t,n){let s;switch(t.op){case"union":case"subtract":case"intersect":{let a=Ze(t.objA,n),i=Ze(t.objB,n);switch(t.op){case"union":s=C.union(a,i,n);break;case"subtract":s=C.subtract(a,i,n);break;default:s=C.intersect(a,i,n)}ge(a,i);break}case"unionArray":case"subtractArray":case"intersectArray":{let a=new Array;for(let i of t.objs)a.push(Ze(i,n));switch(t.op){case"unionArray":s=C.unionArray(a,n);break;case"subtractArray":s=C.subtractArray(a,n);break;default:s=C.intersectArray(a,n)}ge(...a);break}default:throw new Error(`Unknown operation: ${t.op}`)}return s}static handleIntersectingOctrees(t,n,s,a=!0,i,c){s&&(a&&!i&&(i=dr(t.getPolygons())),c||(c=dr(n.getPolygons()))),t.handleIntersectingPolygons(n,s,c),a&&n.handleIntersectingPolygons(t,s,i),i!==void 0&&(i=void 0,c=void 0)}},U=C;U.maxSectionID=Dt,U.maxMaterialID=Dt,U.async={union(t,n,s){let a=he(t.materials,n.materials);return Gr("union",C.union,t,n,a,s)},subtract(t,n,s){let a=he(t.materials,n.materials);return Gr("subtract",C.subtract,t,n,a,s)},intersect(t,n,s){let a=he(t.materials,n.materials);return Gr("intersect",C.intersect,t,n,a,s)},unionArray(t,n){return Yt(C.async.union,C.async.unionArray,t,n)},subtractArray(t,n){return Ke(this,null,function*(){let s=t.length;if(s===0)throw new Error("Unable to find any result octree");return s===1?t[0]:s===2?yield C.async.subtract(t[0],t[1],n):yield C.async.subtract(t[0],yield C.async.unionArray(t.slice(1),n),n)})},intersectArray(t,n){return Yt(C.async.intersect,C.async.intersectArray,t,n)},operation(t,n){return new Promise((s,a)=>{try{switch(t.op){case"union":case"subtract":case"intersect":{let i,c,o=[];t.objA&&o.push(Ft(t.objA,0,n)),t.objB&&o.push(Ft(t.objB,1,n)),Promise.allSettled(o).then(l=>{for(let x of l)if(x.status==="fulfilled"){let[v,p]=x.value;p===0?i=v:p===1&&(c=v)}let h;switch(t.op){case"union":h=C.async.union(i,c,n);break;case"subtract":h=C.async.subtract(i,c,n);break;default:h=C.async.intersect(i,c,n)}h.then(x=>{s(x),ge(i,c)}).catch(x=>a(x))});break}case"unionArray":case"subtractArray":case"intersectArray":{let i=new Array;for(let o of t.objs)i.push(Ze(o,n));let c;switch(t.op){case"unionArray":c=C.async.unionArray(i,n);break;case"subtractArray":c=C.async.subtractArray(i,n);break;default:c=C.async.intersectArray(i,n)}ge(...i),c.then(o=>s(o));break}default:throw new Error(`Unknown operation: ${t.op}`)}}catch(i){a(i)}})}};function Li(e,r){return e.distance-r.distance}function Ze(e,r){if(e instanceof U)return e;if(e.op)return U.operation(e,r);throw new Error("Invalid OctreeCSG operation object")}function Ft(e,r,t){return new Promise((n,s)=>{try{if(e instanceof U)n([e,r]);else if(e.op)U.async.operation(e,t).then(a=>{n([a,r])});else throw new Error("Invalid OctreeCSG operation object")}catch(a){s(a)}})}function ge(...e){for(let r of e)r.delete()}function _t(e,r,t){for(let n of t)n.originalValid&&n.valid&&n.intersects&&Ct(e.triangle,n.triangle)&&r.push(n)}function Lt(e,r,t){let n=r.slice();for(;n.length>1;){let s=n.length,a=new Array,i=0;for(;i+1<s;i+=2){let c=n[i],o=n[i+1],l=e(c,o,t);ge(c,o),a.push(l)}i<s&&a.push(n[i]),n=a}if(n.length===0)throw new Error("Unable to find any result octree");return n[0]}function Gr(e,r,t,n,s,a){return Ke(this,null,function*(){if(globalThis.globalOctreeCSGJobDispatcher)try{return yield globalThis.globalOctreeCSGJobDispatcher.dispatch({op:e,objA:t,objB:n},s,a)}catch(c){let o=!0;if(c instanceof ne&&c.failReason===0&&(console.warn("Queued job failed due to worker creation failure. Retrying synchronously"),o=!1),o)throw c}let i=r(t,n,a);return ge(t,n),i})}function Yt(e,r,t,n){var a;let s=(a=n==null?void 0:n.batchSize)!=null?a:Di;return new Promise((i,c)=>{try{let o=s>4&&s<t.length,l,h=!1,x=[];if(o){let v=[],p=0;for(;p<t.length;)v.push(t.slice(p,p+s)),p+=s;let m;for(;m=v.shift();)x.push(r(m,n));h=!0,t.length=0}else{let v=[],p=t.length;for(let y=0;y<p;y++)v.push(t[y]);l=v.shift();let m,d=v.length;for(let y=0;y<d;y+=2){if(y+1>=d){m=v[y];break}x.push(e(v[y],v[y+1],n))}m&&(x.push(e(l,m,n)),h=!0)}Promise.allSettled(x).then(v=>{let p=new Array;for(let m of v)m.status==="fulfilled"&&p.push(m.value);h||p.unshift(l),p.length<=0?c("Unable to find any result octree"):p.length===1?i(p[0]):p.length>3?r(p,n).then(m=>{i(m)}).catch(m=>c(m)):e(p[0],p[1],n).then(m=>{p.length===3?e(m,p[2],n).then(d=>{i(d)}).catch(d=>c(d)):i(m)}).catch(m=>c(m))})}catch(o){c(o)}})}function Bt(e,r){switch(e.op){case"union":case"subtract":case"intersect":return{op:e.op,objA:Er(e.objA,r),objB:Er(e.objB,r)};case"unionArray":case"subtractArray":case"intersectArray":{let t=new Array;for(let n of e.objs)t.push(Er(n,r));return{op:e.op,objs:t}}default:throw new Error(`Unknown operation: ${e.op}`)}}function Er(e,r){return e instanceof ArrayBuffer?U.decode(e,r):Bt(e,r)}function Xe(e,r){e(`[Worker ${self.name}] ${r}`)}globalThis.onmessage=function(e){switch(e.data.type){case"operation":{Xe(console.debug,"Job started");try{let r=e.data.materials,t=e.data.options,n=U.operation(Bt(e.data.operation,r),t),s=new Array,a=n.encode(r,s);postMessage({success:!0,jobIndex:e.data.jobIndex,buffer:a,materials:r})}catch(r){Xe(console.error,r),postMessage({success:!1,jobIndex:e.data.jobIndex,error:r})}Xe(console.debug,"Job finished");break}default:Xe(console.error,`Unknown worker request type: ${e.data.type}`)}};postMessage("initialized");})();
//# sourceMappingURL=OctreeCSG-ea.worker.min.js.map
